<?php

namespace CleantalkSP\SpbctWP\Helpers;

use PHPUnit\Framework\TestCase;

/**
 * The class contains methods for checking right ip getting
 */
class HelperGetIPRemoteAddrTest extends TestCase
{
    const REMOTE_ADDR = '127.0.0.1';
    const X_FORWARDED_FOR = '127.0.0.2';

    /**
     * @server REMOTE_ADDR=127.0.0.1
     * @server HTTP_X_Forwarded_For=127.0.0.2
     */
    public function test_find_ip_auto()
    {
        global $spbc;
        $spbc->settings['secfw__get_ip'] = 1;

        IP::getInstance()->ips_stored = [];
        \CleantalkSP\Common\Helpers\HTTP::getInstance()->http_headers = [];

        $this->assertEquals(self::X_FORWARDED_FOR, IP::get());
    }

    /**
     * @server REMOTE_ADDR=127.0.0.1
     * @server HTTP_X_Forwarded_For=127.0.0.2
     */
    public function test_find_ip()
    {
        global $spbc;
        $spbc->settings['secfw__get_ip'] = 2;

        IP::getInstance()->ips_stored = [];
        \CleantalkSP\Common\Helpers\HTTP::getInstance()->http_headers = [];

        $this->assertEquals(self::REMOTE_ADDR, IP::get());
    }
}