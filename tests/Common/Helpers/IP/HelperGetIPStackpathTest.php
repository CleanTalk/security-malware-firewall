<?php

namespace CleantalkSP\Common\Helpers;

use PHPUnit\Framework\TestCase;

/**
 * The class contains methods for checking right ip getting
 */
class HelperGetIPStackpathTest extends TestCase
{
    const REMOTE_ADDR = '127.0.0.1';
    const X_SP_FORWARDED_IP = '127.0.0.7';

    protected function setUp()
    {
        $_SERVER['REMOTE_ADDR'] = self::REMOTE_ADDR;
        $_SERVER['HTTP_X_Sp_Forwarded_Ip'] = self::X_SP_FORWARDED_IP;
        $_SERVER['HTTP_X_Sp_Edge_Host'] = self::X_SP_FORWARDED_IP;
    }

    public function test_find_ip()
    {
        global $spbc;
        $spbc->settings['secfw__get_ip'] = 1;

        $this->assertEquals(self::X_SP_FORWARDED_IP, IP::get());
    }
}