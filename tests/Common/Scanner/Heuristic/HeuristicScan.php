<?php

use CleantalkSP\Common\Scanner\HeuristicAnalyser\Controller;
use CleantalkSP\Common\Scanner\HeuristicAnalyser\Structures\FileInfo;
use PHPUnit\Framework\TestCase;

class HeuristicScan extends TestCase
{
    //todo move to common lib
//    public function testEmpty()
//    {
//        unset ($content);
//        $current_dir = __DIR__ . DIRECTORY_SEPARATOR;
//        $heuristic_scanner = new Controller();
//        $content = '';
//        $file_to_check = new FileInfo(null, $content);
//        $result = $heuristic_scanner->scanFile($file_to_check, $current_dir);
//
//        $this->assertInstanceOf('CleantalkSP\Common\Scanner\HeuristicAnalyser\Structures\Verdict', $result);
//        $this->assertEquals($result->error_msg, 'FILE_SIZE_ZERO');
//        unset ($content);
//
//    }

    public function testLarge()
    {
        unset ($content);
        $current_dir = __DIR__ . DIRECTORY_SEPARATOR;
        $heuristic_scanner = new Controller();
        $content = str_repeat('-', 1024*8*1024*2);
        $file_to_check = new FileInfo(null, $content);
        $result = $heuristic_scanner->scanFile($file_to_check, $current_dir);

        $this->assertInstanceOf('CleantalkSP\Common\Scanner\HeuristicAnalyser\Structures\Verdict', $result);
        $this->assertEquals( 'FILE_SIZE_TOO_LARGE', $result->error_msg);
        unset ($content);
    }
}
