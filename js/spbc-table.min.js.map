{"version":3,"file":"spbc-table.min.js","sources":["spbc-table.js"],"sourcesContent":["spbc_bulk_action = null;\r\n\r\n/**\r\n * Reloads scanner accordion and set all the listeners\r\n */\r\nfunction spbc_reload_accordion(){\r\n\tspbc_sendAJAXRequest(\r\n\t\t{action: 'spbc_scanner_tab__reload_accordion'},\r\n\t\t{\r\n\t\t\tnotJson: true,\r\n\t\t\tcallback: function(result, data, params, obj){\r\n\t\t\t\tjQuery(obj).accordion('destroy');\r\n\t\t\t\tjQuery(obj).html(result);\r\n\t\t\t\tjQuery(obj).accordion({\r\n\t\t\t\t\theader: 'h3',\r\n\t\t\t\t\theightStyle: 'content',\r\n\t\t\t\t\tcollapsible: true,\r\n\t\t\t\t\tactive: false,\r\n\t\t\t\t});\r\n\t\t\t\tspbc_tbl__bulk_actions__listen();\r\n\t\t\t\tspbc_tbl__row_actions__listen();\r\n\t\t\t\tspbc_tbl__pagination__listen();\r\n\t\t\t\tspbc_tbl__sort__listen();\r\n\t\t\t\tspbcStartShowHide();\r\n\t\t\t},\r\n\t\t},\r\n\t\tjQuery('#spbc_scan_accordion')\r\n\t);\r\n}\r\n\r\n// TABLE BULK ACTIONS\r\nfunction spbc_tbl__bulk_actions__listen(){\r\n\r\n\tjQuery('.tbl-bulk_actions-all--apply')\r\n\t\t.off('click')\r\n\t\t.on('click', function(){\r\n\r\n\t\tvar self = jQuery(this);\r\n\t\tvar allowed_bulk_actions = ['approve','disapprove','send','check_analysis_status'];\r\n\t\tvar action = self.siblings('select').children()[self.siblings('select').first()[0].selectedIndex].value;\r\n\t\tconsole.log(self);\r\n\t\tif( allowed_bulk_actions.indexOf( action ) !== -1 ){\r\n\r\n\t\t\tif(!confirm(spbcTable.warning_bulk))\r\n\t\t\t\treturn;\r\n\r\n\t\t\tconsole.log('spbc_tbl__bulk_action_all__listen click');\r\n\t\t\tvar data = {\r\n\t\t\t\taction: 'spbc_tbl-action--bulk',\r\n\t\t\t\tadd_action: action,\r\n\t\t\t\tstatus: self.parents('.tbl-root').attr('type'),\r\n\t\t\t};\r\n\t\t\tvar params = {\r\n\t\t\t\tbutton: this,\r\n\t\t\t\tspinner: self.children('.tbl-preloader--small'),\r\n\t\t\t\terrorOutput: function(msg){ spbcModal.open().putError( msg ); },\r\n\t\t\t\tcallback: spbc_reload_accordion,\r\n\t\t\t\terrorOutput: function( error_text, comment ){\r\n\t\t\t\t\tif( comment ){\r\n\t\t\t\t\t\terror_text = error_text + '<br>Additional information:<br>' + comment;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tspbcModal.open().putError( error_text );\r\n\t\t\t\t},\r\n\t\t\t};\r\n\r\n\t\t\tspbc_sendAJAXRequest(data, params);\r\n\r\n\t\t}else{\r\n\t\t\talert('This action is not supported for all files yet =(')\r\n\t\t}\r\n\t});\r\n\r\n\tjQuery('.tbl-bulk_actions--apply')\r\n\t\t.off('click')\r\n\t\t.on('click', function(){\r\n\r\n\t\tif(!spbc_bulk_action && !confirm(spbcTable.warning_bulk))\r\n\t\t\treturn;\r\n\r\n\t\tvar self = spbc_bulk_action || jQuery(this);\r\n\t\tspbc_bulk_action = self;\r\n\t\tvar action = self.siblings('select').children()[self.siblings('select').first()[0].selectedIndex].value;\r\n\t\tif( action !== '-1' && self.parents('.tbl-root').find('.cb-select').is(':checked') ){\r\n\t\t\tself.children('.tbl-preloader--small').show();\r\n\t\t\tif(self.parents('.tbl-root').find('.cb-select:checked').first().parents('tr').find('.tbl-row_action--'+action)[0]){\r\n\t\t\t\tself.parents('.tbl-root').find('.cb-select:checked').first().parents('tr').find('.tbl-row_action--'+action).click();\r\n\t\t\t\tself.parents('.tbl-root').find('.cb-select:checked').first().prop('checked', false);\r\n\t\t\t}else{\r\n\t\t\t\tself.parents('.tbl-root').find('.cb-select:checked').first().prop('checked', false);\r\n\t\t\t\tself.click();\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tself.children('.tbl-preloader--small').hide();\r\n\t\t\tspbc_bulk_action = null;\r\n\t\t\tspbc_reload_accordion();\r\n\t\t}\r\n\t});\r\n}\t\r\n\r\n// TABLE ROW ACTIONS\r\nfunction spbc_tbl__row_actions__listen(){\r\n\tjQuery('.tbl-row_action--ajax')\r\n\t\t.off('click')\r\n\t\t.on('click', function(){\r\n\t\tconsole.log('spbc_tbl__row_actions__listen click');\r\n\t\tvar self = jQuery(this);\r\n\t\tvar data = {\r\n\t\t\taction: 'spbc_tbl-action--row',\r\n\t\t\tadd_action: self.attr('row-action'),\r\n\t\t\tid: self.parents('.row-actions').attr('uid'),\r\n\t\t\tcols: self.parents('.row-actions').attr('cols_amount'),\r\n\t\t};\r\n\t\tvar params = {\r\n\t\t\tcallback: spbc_tbl__row_actions__callback,\r\n\t\t\terrorOutput: function(msg){ spbcModal.open().putError( msg ); },\r\n\t\t\tspinner: self.parents('.row-actions').children('.tbl-preloader--tiny'),\r\n\t\t};\r\n\t\tif(!spbc_bulk_action){\r\n\t\t\tvar confirmation = spbcTable['warning_'+self.attr('row-action')] || spbcTable.warning_default;\r\n\t\t\tif(confirm(confirmation))\r\n\t\t\t\tspbc_sendAJAXRequest(data, params, self.parents('tr'));\r\n\t\t}\r\n\t\tif(spbc_bulk_action){\r\n\t\t\tspbc_sendAJAXRequest(data, params, self.parents('tr'));\r\n\t\t}\r\n\t});\r\n}\r\n\r\n\t// Callback for TABLE ROW ACTIONS\r\nfunction spbc_tbl__row_actions__callback(result, data, params, obj){\r\n\tif(result.color)    {obj.css({background: result.background, color: result.color});}\r\n\tif(result.html)     {\r\n\t\tobj.html(result.html); setTimeout(function(){obj.fadeOut(300);}, 1500);\r\n\t\tif( ! spbc_bulk_action)\r\n\t\t\tspbc_reload_accordion();\r\n\t}\r\n\tif(result.temp_html){\r\n\t\tvar tmp=obj.html(); \r\n\t\tobj.html(result.temp_html);\r\n\t\tsetTimeout(function(){\r\n\t\t\tobj.html(tmp).css({background: 'inherit'}).find('.column-primary .row-actions .tbl-row_action--'+data.add_action).remove();\r\n\t\t\tspbc_tbl__bulk_actions__listen();\r\n\t\t\tspbc_tbl__row_actions__listen();\r\n\t\t\tspbcStartShowHide();\r\n\t\t},5000);\r\n\t}\r\n\tif(spbc_bulk_action)\r\n\t\tspbc_bulk_action.click();\r\n}\r\n\r\n// TABLE PAGINATION ACTIONS\r\nfunction spbc_tbl__pagination__listen(){\r\n\tvar data = {action: 'spbc_tbl-pagination',};\r\n\tvar params = {callback: spbc_tbl__pagination__callback, notJson: true,};\r\n\tjQuery('.tbl-pagination--button').on('click', function(){\r\n\t\tjQuery(this).parents('.tbl-root').find('.tbl-pagination--button').attr('disabled', 'disabled');\r\n\t});\r\n\tjQuery('.tbl-pagination--go').on('click', function(){\r\n\t\tvar self = jQuery(this);\r\n\t\tvar obj = self.parents('.tbl-root');\r\n\t\tdata.page = self.siblings('.tbl-pagination--curr_page').val();\r\n\t\tdata.type = obj.attr('type');\r\n\t\tparams.spinner = self.siblings('.tbl-preloader--small');\r\n\t\tspbc_sendAJAXRequest(data, params, obj);\r\n\t});\r\n\tjQuery('.tbl-pagination--prev').on('click', function(){\r\n\t\tvar self = jQuery(this);\r\n\t\tvar obj = self.parents('.tbl-root');\r\n\t\tdata.page = self.parents('.tbl-pagination--wrapper').attr('prev_page');\r\n\t\tdata.type = obj.attr('type');\r\n\t\tparams.spinner = self.siblings('.tbl-preloader--small');\r\n\t\tspbc_sendAJAXRequest(data, params, obj);\r\n\t});\r\n\tjQuery('.tbl-pagination--next').on('click', function(){\r\n\t\tvar self = jQuery(this);\r\n\t\tvar obj = self.parents('.tbl-root');\r\n\t\tdata.page = self.parents('.tbl-pagination--wrapper').attr('next_page');\r\n\t\tdata.type = obj.attr('type');\r\n\t\tparams.spinner = self.siblings('.tbl-preloader--small');\r\n\t\tspbc_sendAJAXRequest(data, params, obj);\r\n\t});\r\n\tjQuery('.tbl-pagination--end').on('click', function(){\r\n\t\tvar self = jQuery(this);\r\n\t\tvar obj = self.parents('.tbl-root');\r\n\t\tdata.page = self.parents('.tbl-pagination--wrapper').attr('last_page');\r\n\t\tdata.type = obj.attr('type');\r\n\t\tparams.spinner = self.siblings('.tbl-preloader--small');\r\n\t\tspbc_sendAJAXRequest(data, params, obj);\r\n\t});\r\n\tjQuery('.tbl-pagination--start').on('click', function(){\r\n\t\tvar self = jQuery(this);\r\n\t\tvar obj = self.parents('.tbl-root');\r\n\t\tdata.page = 1;\r\n\t\tdata.type = obj.attr('type');\r\n\t\tparams.spinner = self.siblings('.tbl-preloader--small');\r\n\t\tspbc_sendAJAXRequest(data, params, obj);\r\n\t});\r\n}\r\n\r\nfunction spbc_scanner__switch_table(obj, table){\r\n\tvar obj = jQuery(obj);\r\n\tconsole.log(obj.parents('.row-actions').attr('uid'));\r\n\tvar data = {action: 'spbc_tbl-switch', type: table, domain: obj.parents('.row-actions').attr('uid'),};\r\n\tvar params = {callback: spbc_tbl__pagination__callback, notJson: true,};\r\n\tspbc_sendAJAXRequest(data, params, obj.parents('.tbl-root'));\r\n}\r\n\r\n\t// Callback for TABLE PAGINATION ACTIONS\r\nfunction spbc_tbl__pagination__callback(result, data, params, obj){\r\n\t\r\n\tjQuery(obj)\r\n\t\t.html(result)\r\n\t\t.find('.tbl-pagination--button').removeAttr('disabled');\r\n\tspbc_tbl__bulk_actions__listen();\r\n\tspbc_tbl__row_actions__listen();\r\n\tspbc_tbl__pagination__listen();\r\n\tspbc_tbl__sort__listen();\r\n\tspbcStartShowHide();\r\n}\r\n\r\n// TABLE SORT ACTIONS\r\nfunction spbc_tbl__sort__listen(){\r\n\t\r\n\tvar params = {callback: spbc_tbl__sort__callback, notJson: true,};\r\n\tjQuery('.tbl-column-sortable').on('click', function(){\r\n\t\tvar self = jQuery(this);\r\n\t\tvar obj = self.parents('.tbl-root');\r\n\t\tvar data = {\r\n\t\t\taction:   'spbc_tbl-sort',\r\n\t\t\torder_by: self.attr('id'),\r\n\t\t\torder:    self.attr('sort_direction'),\r\n\t\t\ttype:     obj.attr('type'),\r\n\t\t};\r\n\t\tspbc_sendAJAXRequest(data, params, obj);\r\n\t});\r\n}\r\n\r\n\t// Callback for TABLE SORT ACTIONS\r\nfunction spbc_tbl__sort__callback(result, data, params, obj){\r\n\tjQuery(obj).html(result);\r\n\tspbc_tbl__bulk_actions__listen();\r\n\tspbc_tbl__row_actions__listen();\r\n\tspbc_tbl__pagination__listen();\r\n\tspbc_tbl__sort__listen();\r\n}\r\n\r\njQuery(document).ready(function(){\r\n\t\r\n\t// Table. Row actions handler\r\n\tspbc_tbl__bulk_actions__listen();\r\n\tspbc_tbl__row_actions__listen();\r\n\tspbc_tbl__pagination__listen();\r\n\tspbc_tbl__sort__listen();\r\n});"],"names":["spbc_reload_accordion","spbc_sendAJAXRequest","action","notJson","callback","result","data","params","obj","jQuery","accordion","html","header","heightStyle","collapsible","active","spbc_tbl__bulk_actions__listen","spbc_tbl__row_actions__listen","spbc_tbl__pagination__listen","spbc_tbl__sort__listen","spbcStartShowHide","off","on","self","this","siblings","children","first","selectedIndex","value","console","log","indexOf","confirm","spbcTable","warning_bulk","add_action","status","parents","attr","button","spinner","errorOutput","error_text","comment","spbcModal","open","putError","alert","spbc_bulk_action","find","is","show","click","prop","hide","confirmation","id","cols","spbc_tbl__row_actions__callback","msg","warning_default","tmp","color","css","background","setTimeout","fadeOut","temp_html","remove","spbc_tbl__pagination__callback","page","val","type","spbc_scanner__switch_table","table","domain","removeAttr","spbc_tbl__sort__callback","order_by","order","document","ready"],"mappings":"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"}