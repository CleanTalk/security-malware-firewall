{"version":3,"file":"spbc-admin.min.js","sources":["spbc-admin.js"],"sourcesContent":["function spbcGetGoogleQrCode() {\n\tvar data = {};\n\tvar res = {};\n\tdata.security = spbcSettings.ajax_nonce;\n\tdata.action = 'spbc_get_google_qr_code';\n\n\tjQuery.ajax({\n\t\ttype: \"POST\",\n\t\tasync: false,\n\t\turl: spbcSettings.ajaxurl,\n\t\tdata: data,\n\t\tsuccess: function(result){\n\t\t\tres = result;\n\t\t},\n\t});\n\treturn res;\n}\n\nfunction spbcCheckGoogleCode() {\n\tvar data = {};\n\tdata.security = spbcSettings.ajax_nonce;\n\tdata.action = 'spbc_check_google_code';\n\tdata.code = jQuery('#spbct-google-qr-code input').val();\n\n\tjQuery.ajax({\n\t\ttype: \"POST\",\n\t\tasync: false,\n\t\turl: spbcSettings.ajaxurl,\n\t\tdata: data,\n\t\tsuccess: function(result){\n\t\t\tif(result.success) {\n\t\t\t\tjQuery('#spbct-google-qr-code').dialog( \"close\" );\n\t\t\t\tdocument.location.reload();\n\t\t\t} else {\n\t\t\t\talert(result.data);\n\t\t\t}\n\t\t},\n\t});\n}\n\nfunction spbcDisableG2fa( element ) {\n\tvar data = {};\n\tdata.security = spbcSettings.ajax_nonce;\n\tdata.action = 'spbc_disable_google_2fa';\n    data.user_id = jQuery(element).data('user-id');\n\n\tjQuery.ajax({\n\t\ttype: \"POST\",\n\t\tasync: false,\n\t\turl: spbcSettings.ajaxurl,\n\t\tdata: data,\n\t\tsuccess: function(result){\n\t\t\tif(result.success) {\n\t\t\t\tdocument.location.reload();\n\t\t\t} else {\n\t\t\t\talert(result.data);\n\t\t\t}\n\t\t},\n\t});\n}\n\nfunction spbcCheckVulnerability(list, type = 'install') {\n\n\tlet data = {};\n\tdata.security = spbcSettings.ajax_nonce;\n\tdata.action = type === 'install' ? 'spbc_check_vulnerability_install' : 'spbc_check_vulnerability_list';\n    data.list = list;\n\n\tjQuery.ajax({\n\t\ttype: \"POST\",\n\t\tasync: false,\n\t\turl: spbcSettings.ajaxurl,\n\t\tdata: data,\n\t\tsuccess: function(result){\n\t\t\tif(result.success) {\n\t\t\t\tif (type === 'install') {\n\t\t\t\t\tspbcCheckVulnerabilityInstallRender(result.list, result.msg)\n\t\t\t\t}\n\t\t\t\tif (type === 'list') {\n\t\t\t\t\tspbcCheckVulnerabilityListRender(result.list, result.msg)\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.log(result);\n\t\t\t}\n\t\t},\n\t});\n}\n\nfunction spbcCheckVulnerabilityListRender(list, msg) {\n\tlet card;\n\tlet badge;\n\n\tlist.forEach(el => {\n\t\tbadge = document.createElement('div');\n\t\tbadge.classList.add('notice', 'notice-error', 'error-message');\n\t\tbadge.innerHTML = '<p>' + msg + '</p>';\n\t\tcard = document.querySelector('.themes .theme[data-slug=' + el + ']');\n\t\tif (card) {\n\t\t\tcard.appendChild(badge);\n\t\t}\n\t});\n}\n\nfunction spbcCheckVulnerabilityInstallRender(list, msg) {\n\tlet card;\n\n\tlet badge = document.createElement('div');\n\tbadge.classList.add('notice');\n\tbadge.innerHTML = '<p>' + msg + '</p>';\n\n\tlist.forEach(el => {\n\t\tcard = document.querySelector('.theme-id-container .theme-actions a[data-slug=' + el + ']')\n\t\tif (card) {\n\t\t\tcard.parentNode.parentNode.parentNode.appendChild(badge);\n\t\t}\n\t});\n}\n\njQuery(document).ready(function(){\n\n\tif (window.location.href.indexOf(\"themes.php\") > -1 && spbcSettings.vulnerabilityShowList) {\n\t\tlet slugs_state = [];\n\t\tlet slugs = [];\n\t\tlet slugs_nodes;\n\t\tlet version;\n\n\t\tsetInterval(function() {\n\t\t\tslugs_nodes = document.querySelectorAll('.themes .theme[data-slug]');\n\n\t\t\tif (slugs_nodes.length > 0) {\n\t\t\t\tslugs = [];\n\t\t\t\tslugs_nodes.forEach(function(el) {\n\t\t\t\t\tversion = el.querySelector('img').src ? el.querySelector('img').src.match(/ver=([\\d\\.]+)/)[1] : null;\n\t\t\t\t\tslugs.push(el.dataset.slug, version);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (JSON.stringify(slugs) != JSON.stringify(slugs_state)) {\n\t\t\t\tslugs_state = slugs;\n\t\t\t\tspbcCheckVulnerability(slugs, 'list');\n\t\t\t}\n\t\t}, 500);\n    }\n\n\tif (window.location.href.indexOf(\"theme-install.php\") > -1 && spbcSettings.vulnerabilityShowInstall) {\n\t\tlet slugs_state = [];\n\t\tlet slugs = [];\n\t\tlet slugs_nodes;\n\n\t\tsetInterval(function() {\n\t\t\tslugs_nodes = document.querySelectorAll('.theme-id-container .theme-actions a[data-slug]');\n\n\t\t\tif (slugs_nodes.length > 0) {\n\t\t\t\tslugs = [];\n\t\t\t\tslugs_nodes.forEach(function(el) {\n\t\t\t\t\tslugs.push(el.dataset.slug);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (JSON.stringify(slugs) != JSON.stringify(slugs_state)) {\n\t\t\t\tslugs_state = slugs;\n\t\t\t\tspbcCheckVulnerability(slugs);\n\t\t\t}\n\t\t}, 500);\n    }\n\n\t// Auto update banner close handler\n\tjQuery('.spbc_update_notice').on('click', 'button', function(){\n\t\tspbc_setCookie('spbc_update_banner_closed', 1, 86400 * 30);\n\t});\n\n\t// Enable G2FA from user profile page\n\tjQuery(document).on('click', '#spbc-g2fa-enable', function(e){\n\n\t\te.preventDefault();\n\t\tvar spbcGoogleQrCode = spbcGetGoogleQrCode();\n\n\t\tif( spbcGoogleQrCode.success ) {\n\t\t\tvar qr_code_div = jQuery('#spbct-google-qr-code-img');\n\t\t\tqr_code_div.html(spbcGoogleQrCode.data.img + '<p>' + spbcGoogleQrCode.data.code + '</p>');\n\t\t\tjQuery('#spbct-google-qr-code input').val('');\n\t\t\tjQuery('#spbct-google-qr-code').dialog({\n\t\t\t\tmodal: true,\n\t\t\t\ttitle: 'Google authenticator activation',\n\t\t\t\tbuttons: {\n\t\t\t\t\tCancel: function() {\n\t\t\t\t\t\tjQuery( this ).dialog( \"close\" );\n\t\t\t\t\t},\n\t\t\t\t\tOk: function() {\n\t\t\t\t\t\tspbcCheckGoogleCode();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdraggable: false,\n\t\t\t\tresizable: false,\n\t\t\t});\n\t\t} else {\n\t\t\talert(spbcGetGoogleQrCode.data);\n\t\t}\n\n\t});\n\n\t// Disable G2FA from user profile page\n\tjQuery(document).on('click', '#spbc-g2fa-disable', function(e){\n\n\t\te.preventDefault();\n\t\tif( confirm( 'Are you sure?' ) ) {\n\t\t\tspbcDisableG2fa( this );\n\t\t}\n\n\t});\n\n\tvar refresh_user_online_counter = function( result, data, params ){\n\t\tsetTimeout(function () {\n\t\t\tif( result !== null ){\n\t\t\t\tjQuery('.spbc-admin_bar--user_counter').html(result.count);\n\t\t\t\tif( result.count <= 3 ) {\n\t\t\t\t\tjQuery('#wp-admin-bar-spbc_admin_bar__online_admins').show();\n\t\t\t\t\tjQuery('.spbc-admin_bar--online_admins').html(result.users.join(', '));\n\t\t\t\t}else{\n\t\t\t\t\tjQuery('#wp-admin-bar-spbc_admin_bar__online_admins').hide();\n\t\t\t\t}\n\n\t\t\t}\n\t\t\tspbc_sendAJAXRequest( data, params );\n\t\t}, 15000 );\n\t};\n\n\tif( +spbcSettings.admin_bar__admins_online_counter === 1 ) {\n\t\trefresh_user_online_counter(null, {action: 'spbc_get_authorized_admins'}, {callback: refresh_user_online_counter});\n\t}\n\n\t// Dismiss admin banner\n\tjQuery('body').on('click', '.spbct-notice-dismiss-link', function(e){\n\t\tjQuery(e.target).siblings('.notice-dismiss').click();\n\t});\n\tjQuery('body').on('click', '.spbc-notice .notice-dismiss', function(e){\n\t\tconst bannerId = jQuery(e.target).parent('.notice').attr('id');\n\t\tif( bannerId ) {\n\t\t\tspbc_sendAJAXRequest({'action' : 'spbc_dismiss_banner', 'banner_id' : bannerId }, {});\n\t\t\tjQuery(e.target).parent('.notice').after('<div id=\"spbct-notice-dismiss-success\" class=\"notice notice-success is-dismissible\"><p>'+spbcSettings.spbctNoticeDismissSuccess+'</p></div>');\n\t\t\tsetTimeout(function () {\n\t\t\t\tjQuery('#spbct-notice-dismiss-success').fadeOut();\n\t\t\t}, 2000);\n\t\t}\n\t});\n\n\tif (+spbcSettings.needToWhitelist === 1) {\n\t\tspbc_sendAJAXRequest( { 'action' : 'spbc_private_list_add' }, { 'callback' : null } );\n\t}\n});\n\nfunction spbcSummaryShowCDNCheckerTable()\n{\n\tevent.preventDefault()\n\tlet table = document.getElementById('spbc_stats_cdn_checker_table')\n\tif (typeof (table) !== 'undefined') {\n\t\tif (table.style.display === 'block') {\n\t\t\ttable.style.display = 'none'\n\t\t} else {\n\t\t\ttable.style.display = 'block'\n\t\t}\n\t}\n}\n"],"names":["spbcGetGoogleQrCode","data","res","security","spbcSettings","ajax_nonce","action","jQuery","ajax","type","async","url","ajaxurl","success","result","spbcCheckGoogleCode","code","val","dialog","document","location","reload","alert","spbcDisableG2fa","element","user_id","spbcCheckVulnerability","list","let","spbcCheckVulnerabilityInstallRender","msg","spbcCheckVulnerabilityListRender","console","log","card","badge","forEach","el","createElement","classList","add","innerHTML","querySelector","appendChild","parentNode","spbcSummaryShowCDNCheckerTable","event","preventDefault","table","getElementById","style","display","ready","window","href","indexOf","vulnerabilityShowList","slugs_state","slugs","slugs_nodes","version","setInterval","querySelectorAll","length","src","match","push","dataset","slug","JSON","stringify","vulnerabilityShowInstall","on","spbc_setCookie","e","spbcGoogleQrCode","html","img","modal","title","buttons","Cancel","this","Ok","draggable","resizable","confirm","refresh_user_online_counter","params","setTimeout","count","show","users","join","hide","spbc_sendAJAXRequest","admin_bar__admins_online_counter","callback","target","siblings","click","bannerId","parent","attr","banner_id","after","spbctNoticeDismissSuccess","fadeOut","needToWhitelist"],"mappings":"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"}