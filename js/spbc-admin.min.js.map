{"version":3,"file":"spbc-admin.min.js","sources":["spbc-admin.js"],"sourcesContent":["/**\r\n * Get Google Qr Code\r\n *\r\n * @return {object}\r\n */\r\nfunction spbcGetGoogleQrCode() {\r\n    let data = {};\r\n    let res = {};\r\n    data.security = spbcSettings.ajax_nonce;\r\n    data.action = 'spbc_get_google_qr_code';\r\n\r\n    jQuery.ajax({\r\n        type: 'POST',\r\n        async: false,\r\n        url: spbcSettings.ajaxurl,\r\n        data: data,\r\n        success: function(result) {\r\n            res = result;\r\n        },\r\n    });\r\n    return res;\r\n}\r\n\r\n/**\r\n * Check Google Code\r\n */\r\nfunction spbcCheckGoogleCode() {\r\n    let data = {};\r\n    data.security = spbcSettings.ajax_nonce;\r\n    data.action = 'spbc_check_google_code';\r\n    data.code = jQuery('#spbct-google-qr-code input').val();\r\n\r\n    jQuery.ajax({\r\n        type: 'POST',\r\n        async: false,\r\n        url: spbcSettings.ajaxurl,\r\n        data: data,\r\n        success: function(result) {\r\n            if (result.success) {\r\n                jQuery('#spbct-google-qr-code').dialog( 'close' );\r\n                document.location.reload();\r\n            } else {\r\n                alert(result.data);\r\n            }\r\n        },\r\n    });\r\n}\r\n\r\n/**\r\n * Disable Google 2fa\r\n *\r\n * @param {string} element\r\n */\r\nfunction spbcDisableG2fa( element ) {\r\n    let data = {};\r\n    data.security = spbcSettings.ajax_nonce;\r\n    data.action = 'spbc_disable_google_2fa';\r\n    data.user_id = jQuery(element).data('user-id');\r\n\r\n    jQuery.ajax({\r\n        type: 'POST',\r\n        async: false,\r\n        url: spbcSettings.ajaxurl,\r\n        data: data,\r\n        success: function(result) {\r\n            if (result.success) {\r\n                document.location.reload();\r\n            } else {\r\n                alert(result.data);\r\n            }\r\n        },\r\n    });\r\n}\r\n\r\n/**\r\n * Check Vulnerability\r\n *\r\n * @param {array} list\r\n * @param {string} type\r\n */\r\nfunction spbcCheckVulnerability(list, type = 'install') {\r\n    let data = {};\r\n    data.security = spbcSettings.ajax_nonce;\r\n    data.action = type === 'install' ? 'spbc_check_vulnerability_install' : 'spbc_check_vulnerability_list';\r\n    data.list = list;\r\n\r\n    jQuery.ajax({\r\n        type: 'POST',\r\n        async: false,\r\n        url: spbcSettings.ajaxurl,\r\n        data: data,\r\n        success: function(result) {\r\n            if (result.success) {\r\n                if (type === 'install') {\r\n                    spbcCheckVulnerabilityInstallRender(result.list, result.msg);\r\n                }\r\n                if (type === 'list') {\r\n                    spbcCheckVulnerabilityListRender(result.list);\r\n                }\r\n            } else {\r\n                console.log(result);\r\n            }\r\n        },\r\n    });\r\n}\r\n\r\n/**\r\n * Check Vulnerability List Render\r\n *\r\n * @param {object} list\r\n * @param {string} msg\r\n */\r\nfunction spbcCheckVulnerabilityListRender(list) {\r\n    let card;\r\n    let badge;\r\n\r\n    list.forEach((el) => {\r\n        badge = document.createElement('div');\r\n        badge.classList.add('notice', 'notice-error', 'error-message', 'spbc-vulnerable-notice');\r\n        badge.innerHTML = el.msg;\r\n        card = document.querySelector('.themes .theme[data-slug=' + el.slug + ']');\r\n        if (card) {\r\n            card.appendChild(badge);\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Check Vulnerability Install Render\r\n *\r\n * @param {object} list\r\n * @param {string} msg\r\n */\r\nfunction spbcCheckVulnerabilityInstallRender(list, msg) {\r\n    let card;\r\n\r\n    let badge = document.createElement('div');\r\n    badge.classList.add('notice');\r\n    badge.innerHTML = '<p>' + msg + '</p>';\r\n\r\n    list.forEach((el) => {\r\n        card = document.querySelector('.theme-id-container .theme-actions a[data-slug=' + el + ']');\r\n        if (card) {\r\n            card.parentNode.parentNode.parentNode.appendChild(badge);\r\n        }\r\n    });\r\n}\r\n\r\njQuery(document).ready(function() {\r\n    if (window.location.href.indexOf('themes.php') > -1 && spbcSettings.vulnerabilityShowList) {\r\n        let slugsState = [];\r\n        let slugs = [];\r\n        let slugsNodes;\r\n        let version;\r\n\r\n        setInterval(function() {\r\n            slugsNodes = document.querySelectorAll('.themes .theme[data-slug]');\r\n\r\n            if (slugsNodes.length > 0) {\r\n                slugs = [];\r\n                slugsNodes.forEach(function(el) {\r\n                    version = el.querySelector('img').src ?\r\n                        el.querySelector('img').src.match(/ver=([\\d\\.]+)/)[1] :\r\n                        null;\r\n                    slugs.push({'slug': el.dataset.slug, 'version': version});\r\n                });\r\n            }\r\n\r\n            if (JSON.stringify(slugs) != JSON.stringify(slugsState)) {\r\n                slugsState = slugs;\r\n                spbcCheckVulnerability(slugs, 'list');\r\n            }\r\n        }, 500);\r\n    }\r\n\r\n    if (window.location.href.indexOf('theme-install.php') > -1 && spbcSettings.vulnerabilityShowInstall) {\r\n        let slugsState = [];\r\n        let slugs = [];\r\n        let slugsNodes;\r\n\r\n        setInterval(function() {\r\n            slugsNodes = document.querySelectorAll('.theme-id-container .theme-actions a[data-slug]');\r\n\r\n            if (slugsNodes.length > 0) {\r\n                slugs = [];\r\n                slugsNodes.forEach(function(el) {\r\n                    slugs.push(el.dataset.slug);\r\n                });\r\n            }\r\n\r\n            if (JSON.stringify(slugs) != JSON.stringify(slugsState)) {\r\n                slugsState = slugs;\r\n                spbcCheckVulnerability(slugs);\r\n            }\r\n        }, 500);\r\n    }\r\n\r\n    // Auto update banner close handler\r\n    jQuery('.spbc_update_notice').on('click', 'button', function() {\r\n        spbcSetCookie('spbc_update_banner_closed', 1, 86400 * 30);\r\n    });\r\n\r\n    // Enable G2FA from user profile page\r\n    jQuery(document).on('click', '#spbc-g2fa-enable', function(e) {\r\n        e.preventDefault();\r\n        let spbcGoogleQrCode = spbcGetGoogleQrCode();\r\n\r\n        if ( spbcGoogleQrCode.success ) {\r\n            let qrCodeDiv = jQuery('#spbct-google-qr-code-img');\r\n            qrCodeDiv.html(spbcGoogleQrCode.data.img + '<p>' + spbcGoogleQrCode.data.code + '</p>');\r\n            jQuery('#spbct-google-qr-code input').val('');\r\n            jQuery('#spbct-google-qr-code').dialog({\r\n                modal: true,\r\n                title: 'Google authenticator activation',\r\n                buttons: {\r\n                    Cancel: function() {\r\n                        jQuery( this ).dialog( 'close' );\r\n                    },\r\n                    Ok: function() {\r\n                        spbcCheckGoogleCode();\r\n                    },\r\n                },\r\n                draggable: false,\r\n                resizable: false,\r\n            });\r\n        } else {\r\n            alert(spbcGetGoogleQrCode.data);\r\n        }\r\n    });\r\n\r\n    // Disable G2FA from user profile page\r\n    jQuery(document).on('click', '#spbc-g2fa-disable', function(e) {\r\n        e.preventDefault();\r\n        if ( confirm( 'Are you sure?' ) ) {\r\n            spbcDisableG2fa( this );\r\n        }\r\n    });\r\n\r\n    let refreshUserOnlineCounter = function( result, data, params ) {\r\n        setTimeout(function() {\r\n            if ( result !== null ) {\r\n                jQuery('.spbc-admin_bar--user_counter').html(result.count);\r\n                if ( result.count <= 3 ) {\r\n                    jQuery('#wp-admin-bar-spbc_admin_bar__online_admins').show();\r\n                    jQuery('.spbc-admin_bar--online_admins').html(result.users.join(', '));\r\n                } else {\r\n                    jQuery('#wp-admin-bar-spbc_admin_bar__online_admins').hide();\r\n                }\r\n            }\r\n            spbcSendAJAXRequest( data, params );\r\n        }, 15000 );\r\n    };\r\n\r\n    if ( +spbcSettings.admin_bar__admins_online_counter === 1 ) {\r\n        refreshUserOnlineCounter(null, {action: 'spbc_get_authorized_admins'}, {callback: refreshUserOnlineCounter});\r\n    }\r\n\r\n    // Dismiss admin banner\r\n    jQuery('body').on('click', '.spbct-notice-dismiss-link', function(e) {\r\n        jQuery(e.target).siblings('.notice-dismiss').click();\r\n    });\r\n    jQuery('body').on('click', '.spbc-notice .notice-dismiss', function(e) {\r\n        const bannerId = jQuery(e.target).parent('.notice').attr('id');\r\n        if ( bannerId ) {\r\n            let elem = '<div id=\"spbct-notice-dismiss-success\" class=\"notice notice-success is-dismissible\"><p>'+\r\n                spbcSettings.spbctNoticeDismissSuccess+\r\n                '</p></div>';\r\n            spbcSendAJAXRequest({'action': 'spbc_dismiss_banner', 'banner_id': bannerId}, {});\r\n            jQuery(e.target)\r\n                .parent('.notice')\r\n                .after(elem);\r\n            setTimeout(function() {\r\n                jQuery('#spbct-notice-dismiss-success').fadeOut();\r\n            }, 2000);\r\n        }\r\n    });\r\n\r\n    if (+spbcSettings.needToWhitelist === 1) {\r\n        spbcSendAJAXRequest( {'action': 'spbc_private_list_add'}, {'callback': null} );\r\n    }\r\n\r\n    if ( +spbcSettings.critical > 0) {\r\n        let ringContainer = document.createElement('div');\r\n        ringContainer.className = 'spbc_ring-container';\r\n        ringContainer.style.top = '0px';\r\n        ringContainer.style.right = '70px';\r\n        let ringRing = document.createElement('div');\r\n        ringRing.className = 'spbc_ringring';\r\n        let circle = document.createElement('div');\r\n        circle.className = 'spbc_circle';\r\n\r\n        ringContainer.appendChild(ringRing);\r\n        ringContainer.appendChild(circle);\r\n\r\n        let settings = document.querySelector('#menu-settings');\r\n        if (settings) {\r\n            settings.appendChild(ringContainer);\r\n        }\r\n    }\r\n});\r\n\r\n/**\r\n * Summary Show CDN Checker Table\r\n */\r\nfunction spbcSummaryShowCDNCheckerTable() {/* eslint-disable-line no-unused-vars */\r\n    event.preventDefault();\r\n    let table = document.getElementById('spbc_stats_cdn_checker_table');\r\n    if (typeof (table) !== 'undefined') {\r\n        if (table.style.display === 'block') {\r\n            table.style.display = 'none';\r\n        } else {\r\n            table.style.display = 'block';\r\n        }\r\n    }\r\n}\r\n"],"names":["spbcGetGoogleQrCode","let","data","res","security","spbcSettings","ajax_nonce","action","jQuery","ajax","type","async","url","ajaxurl","success","result","spbcCheckGoogleCode","code","val","dialog","document","location","reload","alert","spbcDisableG2fa","element","user_id","spbcCheckVulnerability","list","spbcCheckVulnerabilityInstallRender","msg","spbcCheckVulnerabilityListRender","console","log","card","badge","forEach","createElement","classList","add","innerHTML","el","querySelector","slug","appendChild","parentNode","spbcSummaryShowCDNCheckerTable","event","preventDefault","table","getElementById","style","display","ready","window","href","indexOf","vulnerabilityShowList","slugsState","slugs","slugsNodes","version","setInterval","querySelectorAll","length","src","match","push","dataset","JSON","stringify","vulnerabilityShowInstall","on","spbcSetCookie","e","spbcGoogleQrCode","html","img","modal","title","buttons","Cancel","this","Ok","draggable","resizable","confirm","refreshUserOnlineCounter","params","setTimeout","count","show","users","join","hide","spbcSendAJAXRequest","ringContainer","circle","settings","admin_bar__admins_online_counter","callback","target","siblings","click","elem","bannerId","parent","attr","spbctNoticeDismissSuccess","banner_id","after","fadeOut","needToWhitelist","critical","className","top","right","ringRing"],"mappings":"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"}