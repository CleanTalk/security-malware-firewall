{"version":3,"file":"spbc-admin.min.js","sources":["spbc-admin.js"],"sourcesContent":["/**\n * Get Google Qr Code\n *\n * @return {object}\n */\nfunction spbcGetGoogleQrCode() {\n    let data = {};\n    let res = {};\n    data.security = spbcSettings.ajax_nonce;\n    data.action = 'spbc_get_google_qr_code';\n\n    jQuery.ajax({\n        type: 'POST',\n        async: false,\n        url: spbcSettings.ajaxurl,\n        data: data,\n        success: function(result) {\n            res = result;\n        },\n    });\n    return res;\n}\n\n/**\n * Check Google Code\n */\nfunction spbcCheckGoogleCode() {\n    let data = {};\n    data.security = spbcSettings.ajax_nonce;\n    data.action = 'spbc_check_google_code';\n    data.code = jQuery('#spbct-google-qr-code input').val();\n\n    jQuery.ajax({\n        type: 'POST',\n        async: false,\n        url: spbcSettings.ajaxurl,\n        data: data,\n        success: function(result) {\n            if (result.success) {\n                jQuery('#spbct-google-qr-code').dialog( 'close' );\n                document.location.reload();\n            } else {\n                alert(result.data);\n            }\n        },\n    });\n}\n\n/**\n * Disable Google 2fa\n *\n * @param {string} element\n */\nfunction spbcDisableG2fa( element ) {\n    let data = {};\n    data.security = spbcSettings.ajax_nonce;\n    data.action = 'spbc_disable_google_2fa';\n    data.user_id = jQuery(element).data('user-id');\n\n    jQuery.ajax({\n        type: 'POST',\n        async: false,\n        url: spbcSettings.ajaxurl,\n        data: data,\n        success: function(result) {\n            if (result.success) {\n                document.location.reload();\n            } else {\n                alert(result.data);\n            }\n        },\n    });\n}\n\n/**\n * Check Vulnerability\n *\n * @param {array} list\n * @param {string} type\n */\nfunction spbcCheckVulnerability(list, type = 'install') {\n    let data = {};\n    data.security = spbcSettings.ajax_nonce;\n    data.action = type === 'install' ? 'spbc_check_vulnerability_install' : 'spbc_check_vulnerability_list';\n    data.list = list;\n\n    jQuery.ajax({\n        type: 'POST',\n        async: false,\n        url: spbcSettings.ajaxurl,\n        data: data,\n        success: function(result) {\n            if (result.success) {\n                if (type === 'install') {\n                    spbcCheckVulnerabilityInstallRender(result.list, result.msg);\n                }\n                if (type === 'list') {\n                    spbcCheckVulnerabilityListRender(result.list);\n                }\n            } else {\n                console.log(result);\n            }\n        },\n    });\n}\n\n/**\n * Check Vulnerability List Render\n *\n * @param {object} list\n * @param {string} msg\n */\nfunction spbcCheckVulnerabilityListRender(list) {\n    let card;\n    let badge;\n\n    list.forEach((el) => {\n        badge = document.createElement('div');\n        badge.classList.add('notice', 'notice-error', 'error-message', 'spbc-vulnerable-notice');\n        badge.innerHTML = el.msg;\n        card = document.querySelector('.themes .theme[data-slug=' + el.slug + ']');\n        if (card) {\n            card.appendChild(badge);\n        }\n    });\n}\n\n/**\n * Check Vulnerability Install Render\n *\n * @param {object} list\n * @param {string} msg\n */\nfunction spbcCheckVulnerabilityInstallRender(list, msg) {\n    let card;\n\n    let badge = document.createElement('div');\n    badge.classList.add('notice');\n    badge.innerHTML = '<p>' + msg + '</p>';\n\n    list.forEach((el) => {\n        card = document.querySelector('.theme-id-container .theme-actions a[data-slug=' + el + ']');\n        if (card) {\n            card.parentNode.parentNode.parentNode.appendChild(badge);\n        }\n    });\n}\n\njQuery(document).ready(function() {\n    if (window.location.href.indexOf('themes.php') > -1 && spbcSettings.vulnerabilityShowList) {\n        let slugsState = [];\n        let slugs = [];\n        let slugsNodes;\n        let version;\n\n        setInterval(function() {\n            slugsNodes = document.querySelectorAll('.themes .theme[data-slug]');\n\n            if (slugsNodes.length > 0) {\n                slugs = [];\n                slugsNodes.forEach(function(el) {\n                    version = el.querySelector('img').src ?\n                        el.querySelector('img').src.match(/ver=([\\d\\.]+)/)[1] :\n                        null;\n                    slugs.push({'slug': el.dataset.slug, 'version': version});\n                });\n            }\n\n            if (JSON.stringify(slugs) != JSON.stringify(slugsState)) {\n                slugsState = slugs;\n                spbcCheckVulnerability(slugs, 'list');\n            }\n        }, 500);\n    }\n\n    if (window.location.href.indexOf('theme-install.php') > -1 && spbcSettings.vulnerabilityShowInstall) {\n        let slugsState = [];\n        let slugs = [];\n        let slugsNodes;\n\n        setInterval(function() {\n            slugsNodes = document.querySelectorAll('.theme-id-container .theme-actions a[data-slug]');\n\n            if (slugsNodes.length > 0) {\n                slugs = [];\n                slugsNodes.forEach(function(el) {\n                    slugs.push(el.dataset.slug);\n                });\n            }\n\n            if (JSON.stringify(slugs) != JSON.stringify(slugsState)) {\n                slugsState = slugs;\n                spbcCheckVulnerability(slugs);\n            }\n        }, 500);\n    }\n\n    // Auto update banner close handler\n    jQuery('.spbc_update_notice').on('click', 'button', function() {\n        spbcSetCookie('spbc_update_banner_closed', 1, 86400 * 30);\n    });\n\n    // Enable G2FA from user profile page\n    jQuery(document).on('click', '#spbc-g2fa-enable', function(e) {\n        e.preventDefault();\n        let spbcGoogleQrCode = spbcGetGoogleQrCode();\n\n        if ( spbcGoogleQrCode.success ) {\n            let qrCodeDiv = jQuery('#spbct-google-qr-code-img');\n            qrCodeDiv.html(spbcGoogleQrCode.data.img + '<p>' + spbcGoogleQrCode.data.code + '</p>');\n            jQuery('#spbct-google-qr-code input').val('');\n            jQuery('#spbct-google-qr-code').dialog({\n                modal: true,\n                title: 'Google authenticator activation',\n                buttons: {\n                    Cancel: function() {\n                        jQuery( this ).dialog( 'close' );\n                    },\n                    Ok: function() {\n                        spbcCheckGoogleCode();\n                    },\n                },\n                draggable: false,\n                resizable: false,\n            });\n        } else {\n            alert(spbcGetGoogleQrCode.data);\n        }\n    });\n\n    // Disable G2FA from user profile page\n    jQuery(document).on('click', '#spbc-g2fa-disable', function(e) {\n        e.preventDefault();\n        if ( confirm( 'Are you sure?' ) ) {\n            spbcDisableG2fa( this );\n        }\n    });\n\n    let refreshUserOnlineCounter = function( result, data, params ) {\n        setTimeout(function() {\n            if ( result !== null ) {\n                jQuery('.spbc-admin_bar--user_counter').html(result.count);\n                if ( result.count <= 3 ) {\n                    jQuery('#wp-admin-bar-spbc_admin_bar__online_admins').show();\n                    jQuery('.spbc-admin_bar--online_admins').html(result.users.join(', '));\n                } else {\n                    jQuery('#wp-admin-bar-spbc_admin_bar__online_admins').hide();\n                }\n            }\n            spbcSendAJAXRequest( data, params );\n        }, 15000 );\n    };\n\n    if ( +spbcSettings.admin_bar__admins_online_counter === 1 ) {\n        refreshUserOnlineCounter(null, {action: 'spbc_get_authorized_admins'}, {callback: refreshUserOnlineCounter});\n    }\n\n    // Dismiss admin banner\n    jQuery('body').on('click', '.spbct-notice-dismiss-link', function(e) {\n        jQuery(e.target).siblings('.notice-dismiss').click();\n    });\n    jQuery('body').on('click', '.spbc-notice .notice-dismiss', function(e) {\n        const bannerId = jQuery(e.target).parent('.notice').attr('id');\n        if ( bannerId ) {\n            let elem = '<div id=\"spbct-notice-dismiss-success\" class=\"notice notice-success is-dismissible\"><p>'+\n                spbcSettings.spbctNoticeDismissSuccess+\n                '</p></div>';\n            spbcSendAJAXRequest({'action': 'spbc_dismiss_banner', 'banner_id': bannerId}, {});\n            jQuery(e.target)\n                .parent('.notice')\n                .after(elem);\n            setTimeout(function() {\n                jQuery('#spbct-notice-dismiss-success').fadeOut();\n            }, 2000);\n        }\n    });\n\n    if (+spbcSettings.needToWhitelist === 1) {\n        spbcSendAJAXRequest( {'action': 'spbc_private_list_add'}, {'callback': null} );\n    }\n\n    if ( +spbcSettings.critical > 0) {\n        let ringContainer = document.createElement('div');\n        ringContainer.className = 'spbc_ring-container';\n        ringContainer.style.top = '0px';\n        ringContainer.style.right = '70px';\n        let ringRing = document.createElement('div');\n        ringRing.className = 'spbc_ringring';\n        let circle = document.createElement('div');\n        circle.className = 'spbc_circle';\n\n        ringContainer.appendChild(ringRing);\n        ringContainer.appendChild(circle);\n\n        let settings = document.querySelector('#menu-settings');\n        if (settings) {\n            settings.appendChild(ringContainer);\n        }\n    }\n});\n\n/**\n * Summary Show CDN Checker Table\n */\nfunction spbcSummaryShowCDNCheckerTable() {/* eslint-disable-line no-unused-vars */\n    event.preventDefault();\n    let table = document.getElementById('spbc_stats_cdn_checker_table');\n    if (typeof (table) !== 'undefined') {\n        if (table.style.display === 'block') {\n            table.style.display = 'none';\n        } else {\n            table.style.display = 'block';\n        }\n    }\n}\n"],"names":["spbcGetGoogleQrCode","let","data","res","security","spbcSettings","ajax_nonce","action","jQuery","ajax","type","async","url","ajaxurl","success","result","spbcCheckGoogleCode","code","val","dialog","document","location","reload","alert","spbcDisableG2fa","element","user_id","spbcCheckVulnerability","list","spbcCheckVulnerabilityInstallRender","msg","spbcCheckVulnerabilityListRender","console","log","card","badge","forEach","createElement","classList","add","innerHTML","el","querySelector","slug","appendChild","parentNode","spbcSummaryShowCDNCheckerTable","event","preventDefault","table","getElementById","style","display","ready","window","href","indexOf","vulnerabilityShowList","slugsState","slugs","slugsNodes","version","setInterval","querySelectorAll","length","src","match","push","dataset","JSON","stringify","vulnerabilityShowInstall","on","spbcSetCookie","e","spbcGoogleQrCode","html","img","modal","title","buttons","Cancel","this","Ok","draggable","resizable","confirm","refreshUserOnlineCounter","params","setTimeout","count","show","users","join","hide","spbcSendAJAXRequest","ringContainer","circle","settings","admin_bar__admins_online_counter","callback","target","siblings","click","elem","bannerId","parent","attr","spbctNoticeDismissSuccess","banner_id","after","fadeOut","needToWhitelist","critical","className","top","right","ringRing"],"mappings":"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"}