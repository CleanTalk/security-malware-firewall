{"version":3,"file":"spbc-upload.min.js","sources":["spbc-upload.js"],"sourcesContent":["let spbcErrorMsgCount = 0;\n\njQuery(document).ready(function() {\n    // Count error messages each 100ms\n    setTimeout(spbcCheckNewFiles, 1000);\n});\n\n/**\n * Check blocked file and display error message about it\n */\nfunction spbcCheckNewFiles() {\n    // If their more messages than were, fire AJAX request to get data\n    if (spbcErrorMsgCount < spbcGetErrorMsgs().length) {\n        spbcErrorMsgCount = spbcGetErrorMsgs().length;\n        spbcGetLatestBlockedFile();\n        spbcErrorMsgCount = spbcErrorMsgCount - 1;\n        // If their fewer messages than were, recount\n    } else if (spbcErrorMsgCount > spbcGetErrorMsgs().length) {\n        spbcErrorMsgCount = spbcGetErrorMsgs().length;\n    }\n    setTimeout(spbcCheckNewFiles, 1000);\n}\n\n/**\n * Array of the appear errors notices on the page\n *\n * @return {{length}|*|jQuery|HTMLElement|*[]}\n */\nfunction spbcGetErrorMsgs() {\n    let mediaError = jQuery('#media-upload-error .error');\n    let uploadError = jQuery('.upload-error-message');\n    if (mediaError.length) {\n        return mediaError;\n    } else if (uploadError.length) {\n        return uploadError;\n    } else {\n        return [];\n    }\n}\n\n/**\n * Fires AJAX request to get more info about the block\n */\nfunction spbcGetLatestBlockedFile() {\n    let data = {action: 'spbc_check_file_block', timestamp: spbcTimestamp()};\n    let params = {callback: spbcCheckFileBlockCallback};\n    let obj = spbcGetErrorMsgs().first();\n    spbcSendAJAXRequest(data, params, obj);\n}\n\n/**\n * Callback. Sets correct error message with details\n *\n * @param {obj|string} result\n * @param {obj} data\n * @param {obj} params\n * @param {obj} obj\n */\nfunction spbcCheckFileBlockCallback(result, data, params, obj) {\n    if (result.blocked) {\n        let pattern = result.pattern.CRITICAL || result.pattern.DANGER || result.pattern.SUSPICIOUS;\n        obj.html(result.warning + '<br>' + result.pattern_title + ' ' + pattern);\n    }\n}\n"],"names":["let","spbcErrorMsgCount","spbcCheckNewFiles","spbcGetErrorMsgs","length","spbcGetLatestBlockedFile","setTimeout","mediaError","jQuery","uploadError","data","action","timestamp","spbcTimestamp","params","callback","spbcCheckFileBlockCallback","obj","first","spbcSendAJAXRequest","result","pattern","blocked","CRITICAL","DANGER","SUSPICIOUS","html","warning","pattern_title","document","ready"],"mappings":"AAAAA,IAAIC,kBAAoB,EAUxB,SAASC,oBAEDD,kBAAoBE,iBAAiB,EAAEC,QACvCH,kBAAoBE,iBAAiB,EAAEC,OACvCC,yBAAyB,EACzBJ,mBAAwC,GAEjCA,kBAAoBE,iBAAiB,EAAEC,SAC9CH,kBAAoBE,iBAAiB,EAAEC,QAE3CE,WAAWJ,kBAAmB,GAAI,CACtC,CAOA,SAASC,mBACLH,IAAIO,EAAaC,OAAO,4BAA4B,EAChDC,EAAcD,OAAO,uBAAuB,EAChD,OAAID,EAAWH,OACJG,EACAE,EAAYL,OACZK,EAEA,EAEf,CAKA,SAASJ,2BACLL,IAAIU,EAAO,CAACC,OAAQ,wBAAyBC,UAAWC,cAAc,CAAC,EACnEC,EAAS,CAACC,SAAUC,0BAA0B,EAC9CC,EAAMd,iBAAiB,EAAEe,MAAM,EACnCC,oBAAoBT,EAAMI,EAAQG,CAAG,CACzC,CAUA,SAASD,2BAA2BI,EAAQV,EAAMI,EAAQG,GACtD,IACQI,EADJD,EAAOE,UACHD,EAAUD,EAAOC,QAAQE,UAAYH,EAAOC,QAAQG,QAAUJ,EAAOC,QAAQI,WACjFR,EAAIS,KAAKN,EAAOO,QAAU,OAASP,EAAOQ,cAAgB,IAAMP,CAAO,EAE/E,CA7DAb,OAAOqB,QAAQ,EAAEC,MAAM,WAEnBxB,WAAWJ,kBAAmB,GAAI,CACtC,CAAC"}