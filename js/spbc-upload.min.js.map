{"version":3,"sources":["spbc-upload.js"],"names":["spbc_error_msg_count","spbc_check_new_files","spbc_get_error_msgs","length","spbc_get_latest_blocked_file","spbc_timer","setTimeout","jQuery","data","action","timestamp","spbc_timestamp","params","callback","spbc_check_file_block__callback","obj","first","spbc_sendAJAXRequest","result","blocked","pattern","CRITICAL","DANGER","SUSPICIOUS","html","warning","pattern_title","document","ready"],"mappings":"AAAA,IAAIA,qBAAuB,EAS3B,SAASC,uBAELD,qBAAuBE,sBAAsBC,QAC/CH,qBAAuBE,sBAAsBC,OAC7CC,gCAEQJ,qBAAuBE,sBAAsBC,SACrDH,qBAAuBE,sBAAsBC,QAE9CE,WAAaC,WAAWL,qBAAsB,KAG/C,SAASC,sBACR,OAAGK,OAAO,8BAA8BJ,OAChCI,OAAO,8BACPA,OAAO,yBAAyBJ,OAChCI,OAAO,yBAEP,GAIT,SAASH,+BACR,IAAII,EAAO,CAACC,OAAQ,wBAAyBC,UAAWC,kBACvDC,EAAS,CAACC,SAAUC,iCACpBC,EAAMb,sBAAsBc,QAC7BC,qBAAqBT,EAAMI,EAAQG,GAIpC,SAASD,gCAAgCI,EAAQV,EAAMI,EAAQG,GAC9D,GAAGG,EAAOC,QAAQ,CACjB,IAAIC,EAAUF,EAAOE,QAAQC,UAAYH,EAAOE,QAAQE,QAAUJ,EAAOE,QAAQG,WACjFR,EAAIS,KAAKN,EAAOO,QAAU,OAASP,EAAOQ,cAAgB,IAAMN,IAxClEb,OAAOoB,UAAUC,MAAM,WAGLtB,WAAWL,qBAAsB","file":"spbc-upload.min.js","sourcesContent":["var spbc_error_msg_count = 0;\r\n\r\njQuery(document).ready(function(){\r\n\t\r\n\t// Count error messages each 100ms\r\n\tvar spbc_timer = setTimeout(spbc_check_new_files, 1000);\r\n\t\r\n});\r\n\r\nfunction spbc_check_new_files(){\t\r\n\t// If there more messages than were, fire AJAX request to get data\r\n\tif(spbc_error_msg_count < spbc_get_error_msgs().length){\r\n\t\tspbc_error_msg_count = spbc_get_error_msgs().length;\r\n\t\tspbc_get_latest_blocked_file();\r\n\t// If there less messages than were, recount\r\n\t}else if(spbc_error_msg_count > spbc_get_error_msgs().length){\r\n\t\tspbc_error_msg_count = spbc_get_error_msgs().length;\r\n\t}\r\n\tspbc_timer = setTimeout(spbc_check_new_files, 1000);\r\n}\r\n\r\nfunction spbc_get_error_msgs(){\r\n\tif(jQuery('#media-upload-error .error').length)\r\n\t\treturn jQuery('#media-upload-error .error');\r\n\telse if(jQuery('.upload-error-message').length)\r\n\t\treturn jQuery('.upload-error-message');\r\n\telse\r\n\t\treturn [];\r\n}\r\n\r\n//Fires AJAX request to get more info about the block\r\nfunction spbc_get_latest_blocked_file(){\r\n\tvar data = {action: 'spbc_check_file_block', timestamp: spbc_timestamp()},\r\n\t\tparams = {callback: spbc_check_file_block__callback},\r\n\t\tobj = spbc_get_error_msgs().first();\r\n\tspbc_sendAJAXRequest(data, params, obj);\r\n}\r\n\r\n// Callback. Sets correct error message with details\r\nfunction spbc_check_file_block__callback(result, data, params, obj){\r\n\tif(result.blocked){\r\n\t\tvar pattern = result.pattern.CRITICAL || result.pattern.DANGER || result.pattern.SUSPICIOUS;\r\n\t\tobj.html(result.warning + '<br>' + result.pattern_title + ' ' + pattern);\r\n\t}\r\n\treturn;\r\n}"]}