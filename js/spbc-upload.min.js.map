{"version":3,"file":"spbc-upload.min.js","sources":["spbc-upload.js"],"sourcesContent":["var spbc_error_msg_count = 0;\n\njQuery(document).ready(function () {\n\n    // Count error messages each 100ms\n    var spbc_timer = setTimeout(spbc_check_new_files, 1000);\n\n});\n\nfunction spbc_check_new_files() {\n    // If there more messages than were, fire AJAX request to get data\n    if (spbc_error_msg_count < spbc_get_error_msgs().length) {\n        spbc_error_msg_count = spbc_get_error_msgs().length;\n        spbc_get_latest_blocked_file();\n        spbc_error_msg_count = spbc_error_msg_count - 1;\n        // If there less messages than were, recount\n    } else if (spbc_error_msg_count > spbc_get_error_msgs().length) {\n        spbc_error_msg_count = spbc_get_error_msgs().length;\n    }\n    spbc_timer = setTimeout(spbc_check_new_files, 1000);\n}\n\nfunction spbc_get_error_msgs() {\n    let media_error = jQuery(\"#media-upload-error .error\")\n    let upload_error = jQuery(\".upload-error-message\")\n    if (media_error.length)\n        return media_error;\n    else if (upload_error.length)\n        return upload_error;\n    else\n        return [];\n}\n\n//Fires AJAX request to get more info about the block\nfunction spbc_get_latest_blocked_file() {\n    var data = {action: \"spbc_check_file_block\", timestamp: spbc_timestamp()},\n        params = {callback: spbc_check_file_block__callback},\n        obj = spbc_get_error_msgs().first();\n    spbc_sendAJAXRequest(data, params, obj);\n}\n\n// Callback. Sets correct error message with details\nfunction spbc_check_file_block__callback(result, data, params, obj) {\n    if (result.blocked) {\n        var pattern = result.pattern.CRITICAL || result.pattern.DANGER || result.pattern.SUSPICIOUS;\n        obj.html(result.warning + \"<br>\" + result.pattern_title + \" \" + pattern);\n    }\n}"],"names":["spbc_error_msg_count","spbc_check_new_files","spbc_get_error_msgs","length","spbc_get_latest_blocked_file","spbc_timer","setTimeout","let","media_error","jQuery","upload_error","data","action","timestamp","spbc_timestamp","params","callback","spbc_check_file_block__callback","obj","first","spbc_sendAJAXRequest","result","pattern","blocked","CRITICAL","DANGER","SUSPICIOUS","html","warning","pattern_title","document","ready"],"mappings":"AAAA,IAAIA,qBAAuB,EAS3B,SAASC,uBAEDD,qBAAuBE,oBAAoB,EAAEC,QAC7CH,qBAAuBE,oBAAoB,EAAEC,OAC7CC,6BAA6B,EAC7BJ,sBAA8C,GAEvCA,qBAAuBE,oBAAoB,EAAEC,SACpDH,qBAAuBE,oBAAoB,EAAEC,QAEjDE,WAAaC,WAAWL,qBAAsB,GAAI,CACtD,CAEA,SAASC,sBACLK,IAAIC,EAAcC,OAAO,4BAA4B,EACjDC,EAAeD,OAAO,uBAAuB,EACjD,OAAID,EAAYL,OACLK,EACFE,EAAaP,OACXO,EAEA,EACf,CAGA,SAASN,+BACL,IAAIO,EAAO,CAACC,OAAQ,wBAAyBC,UAAWC,eAAe,CAAC,EACpEC,EAAS,CAACC,SAAUC,+BAA+B,EACnDC,EAAMhB,oBAAoB,EAAEiB,MAAM,EACtCC,qBAAqBT,EAAMI,EAAQG,CAAG,CAC1C,CAGA,SAASD,gCAAgCI,EAAQV,EAAMI,EAAQG,GAC3D,IACQI,EADJD,EAAOE,UACHD,EAAUD,EAAOC,QAAQE,UAAYH,EAAOC,QAAQG,QAAUJ,EAAOC,QAAQI,WACjFR,EAAIS,KAAKN,EAAOO,QAAU,OAASP,EAAOQ,cAAgB,IAAMP,CAAO,EAE/E,CA7CAb,OAAOqB,QAAQ,EAAEC,MAAM,WAGFzB,WAAWL,qBAAsB,GAAI,CAE1D,CAAC"}