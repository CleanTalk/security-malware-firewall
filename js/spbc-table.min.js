let spbcBulkAction=null;function spbcReloadAccordion(){spbcSendAJAXRequest({action:"spbc_scanner_tab__reload_accordion"},{notJson:!0,callback:function(t,e,n,a){jQuery(a).accordion("destroy"),jQuery(a).html(t),jQuery(a).accordion({header:"h3",heightStyle:"content",collapsible:!0,active:!1}),spbcTblBulkActionsListen(),spbcTblRowActionsListen(),spbcTblPaginationListen(),spbcTblSortListen(),spbcStartShowHide()}},jQuery("#spbc_scan_accordion"))}function spbcTblBulkActionsListen(){jQuery(".tbl-bulk_actions-all--apply").off("click").on("click",function(){if(spbcScanner.active)alert(spbcTableLocalize.scannerIsActive);else{var t=jQuery(this);let n=t.siblings("select").children()[t.siblings("select").first()[0].selectedIndex].value;if(-1!==["approve","disapprove","send","check_analysis_status","approve_page","disapprove_page","cure","delete_from_analysis_log"].indexOf(n)){if(confirm(spbcTable.warning_bulk)){var e={action:"spbc_tbl-action--bulk",add_action:n,status:t.parents(".tbl-root").attr("type")};if("cure"===n){var a=t.closest("#spbc_tbl__scanner_cure_log").find(".cb-select");let n=[];a.each(function(t,e){e=jQuery(e).val();n.push(e)}),e.selectedIds=n}if("delete_from_analysis_log"===n){a=t.closest("#spbc_tbl__scanner_analysis_log").find(".cb-select");let n=[];a.each(function(t,e){e=jQuery(e).val();n.push(e)}),e.file_ids=n}a={button:this,spinner:t.children(".tbl-preloader--small"),callback:function(t){var e;spbcReloadAccordion(),"check_analysis_status"===n&&void 0!==t&&(e="<p> Analysis status updated. Total: "+t.counters.total+", updated: "+t.counters.updated+", skipped: "+t.counters.skipped+", failed: "+t.counters.failed+", queued: "+t.counters.queued+"</p>",spbcModal.open().put(e)),"send"===n&&void 0!==t&&(e="<p> Files have been sent: "+t.files_sent_counter+"</p>",spbcModal.open().put(e))},errorOutput:function(t,e){e&&(t=t+"<br>Additional information:<br>"+e),spbcModal.open().putError(t)},timeout:6e4};spbcSendAJAXRequest(e,a)}}else alert("This action is not supported for all files yet =(")}}),jQuery(".tbl-bulk_actions--apply").off("click").on("click",function(t){if(spbcBulkAction||confirm(spbcTable.warning_bulk)){var a=spbcBulkAction||jQuery(this);let n=(spbcBulkAction=a).siblings("select").children()[a.siblings("select").first()[0].selectedIndex].value;if("cure"===n)spbcScannerCureSelected(jQuery(this));else if("delete_from_analysis_log"===n)spbcScannerAnalysisLogDeleteFromLog(jQuery(this));else if("allow"===n||"ban"===n){let e="ban"===n?"deny":n;var s=a.parents(".tbl-root").find(".cb-select:checked"),s=(s&&(a.children(".tbl-preloader--small").show(),s.each(function(){var t=jQuery(this).parents("tr").find(".tbl-row_action--"+n).data("ip");spbcSecLogsFilterIp(t,e,!0),jQuery(this).prop("checked",!1)})),a.children(".tbl-preloader--small").hide(),"allow"===n?"Allowed":"Banned"),s="<p> Success. Selected IPs have been "+s+". Changes will be applied within 10 minutes.</p>";spbcModal.open().put(s),void setTimeout(spbcReloadAccordion,1900)}else"-1"!==n&&a.parents(".tbl-root").find(".cb-select").is(":checked")?(a.children(".tbl-preloader--small").show(),a.parents(".tbl-root").find(".cb-select:checked").first().parents("tr").find(".tbl-row_action--"+n)[0]?(a.parents(".tbl-root").find(".cb-select:checked").first().parents("tr").find(".tbl-row_action--"+n).click(),a.parents(".tbl-root").find(".cb-select:checked").first().prop("checked",!1)):(a.parents(".tbl-root").find(".cb-select:checked").first().prop("checked",!1),a.click())):(a.children(".tbl-preloader--small").hide(),spbcBulkAction=null,"check_analysis_status"!==n&&"disapprove"!==n||spbcModal.open().put("<p> All available files are updated.</p>"),"send"===n&&spbcModal.open().put("<p> All available files are sent.</p>"),setTimeout(spbcReloadAccordion,1900))}})}function spbcScannerCureSelected(e){var t=e.closest("#spbc_tbl__scanner_cure_log").find(".cb-select:checked");let n=[];0===t.length&&alert("Please, select elements."),t.each(function(t,e){e=jQuery(e).val();n.push(e)});t={action:"spbc_cure_selected",security:spbcSettings.ajax_nonce,selectedIds:n};jQuery.ajax({type:"POST",url:spbcSettings.ajaxurl,data:t,beforeSend:function(){e.closest("#spbc_tbl__scanner_cure_log").find(".tbl-button---white_blue .tbl-preloader--in_button").show()},success:function(t){e.closest("#spbc_tbl__scanner_cure_log").find(".tbl-button---white_blue .tbl-preloader--in_button").hide(),t.success?(spbcModal.open().put(t.data),document.addEventListener("spbcModalClosed",function(t){document.location.reload()})):spbcModal.open().putError(t.data)}})}function spbcTblRowActionsListen(){jQuery(".tbl-row_action--ajax").off("click").on("click",function(){if(console.log("spbcTblRowActionsListen click"),spbcScanner.active)alert(spbcTableLocalize.scannerIsActive);else{let e=jQuery(this),n={action:"spbc_tbl-action--row",add_action:e.attr("row-action"),id:e.parents(".row-actions").attr("uid"),cols:e.parents(".row-actions").attr("cols_amount"),page_url:e.parent().attr("uid"),page_id:e.parent().attr("page_id")},a={callback:spbcTblRowActionsCallback,errorOutput:function(t){spbcModal.open().putError(t)},spinner:e.parent().siblings(".tbl-preloader--tiny")};var t,s;spbcBulkAction||(t=e.parent().parent()[0].firstChild.innerHTML,s=spbcTable["warning_"+e.attr("row-action")]||spbcTable.warning_default,"copy_file_info"===n.add_action||"check_analysis_status"===n.add_action?spbcSendAJAXRequest(n,a,e.parents("tr")):spbcModal.open().confirm(s,t,t=>{t&&spbcSendAJAXRequest(n,a,e.parents("tr"))})),spbcBulkAction&&spbcSendAJAXRequest(n,a,e.parents("tr"))}})}function spbcTblRowActionsCallback(e,n,t,a){if(e.color&&a.css({background:e.background,color:e.color}),e.html&&(a.parent().parent().parent().prepend(e.html),setTimeout(function(){a.fadeOut(300)},1500),spbcBulkAction||setTimeout(spbcReloadAccordion,1900)),"copy_file_info"===n.add_action&&(!0===e.success&&e.data.file_info?window.prompt("Copy the file info below and send it to support@cleantalk.org: ",e.data.file_info):(s=void 0!==e.data.error?e.data.error:"Unknown copy_file_info error",spbcModal.open().putError(s))),e.temp_html){let t=a.html();if(a.html(e.temp_html),void 0!==e.updated_template){var s=e.updated_template_type,e=e.updated_template,c=jQuery(e).find(".wp-list-table tbody tr").length,l=jQuery('[aria-controls="spbc_scan_accordion_tab_'+s+'"]');if(0<l.length){var i=jQuery("#spbc_tbl__scanner_"+s);jQuery(".spbc_bad_type_count."+s+"_counter").text(c);let n=i.find(".wp-list-table tbody tr").length;i.remove(),jQuery("#spbc_scan_accordion_tab_"+s).append(e),jQuery(jQuery("#spbc_scan_accordion_tab_"+s).find(".wp-list-table tbody tr")).each(function(t,e){++t>n&&jQuery(e).css("outline","1px solid green")}),l.click()}else"analysis_log"===s&&(i='<h3 class="ui-accordion-header ui-corner-top ui-state-default ui-accordion-icons ui-accordion-header-collapsed ui-corner-all" role="tab" id="ui-id-2" aria-controls="spbc_scan_accordion_tab_analysis_log" aria-selected="false" aria-expanded="false" tabindex="-1"><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span><a href="#">Analysis Log (<span class="spbc_bad_type_count analysis_log_counter">'+c+"</span>)</a></h3>",s='<div id="spbc_scan_accordion_tab_analysis_log" class="ui-accordion-content ui-corner-bottom ui-helper-reset ui-widget-content" aria-labelledby="ui-id-2" role="tabpanel" aria-hidden="true" style="display: none;"><p class="spbc_hint">Files sent for analysis.</p><div id="spbc_tbl__scanner_analysis_log" type="analysis_log" class="tbl-root">'+e+"</div>",jQuery("#spbc_scan_accordion_tab_critical").after(i+s),l.click())}setTimeout(function(){a.html(t).css({background:"inherit"}).find(".column-primary .row-actions .tbl-row_action--"+n.add_action).remove(),spbcTblBulkActionsListen(),spbcTblRowActionsListen(),spbcStartShowHide()},5e3)}spbcBulkAction&&spbcBulkAction.click()}function spbcTblPaginationListen(){let n={action:"spbc_tbl-pagination"},a={callback:spbcTblPaginationCallback,notJson:!0};jQuery(".tbl-pagination--button").on("click",function(){jQuery(this).parents(".tbl-root").find(".tbl-pagination--button").attr("disabled","disabled")}),jQuery(".tbl-pagination--go").on("click",function(){var t=jQuery(this),e=t.parents(".tbl-root");n.page=t.siblings(".tbl-pagination--curr_page").val(),n.type=e.attr("type"),a.spinner=t.siblings(".tbl-preloader--small"),spbcSendAJAXRequest(n,a,e)}),jQuery(".tbl-pagination--prev").on("click",function(){var t=jQuery(this),e=t.parents(".tbl-root");n.page=t.parents(".tbl-pagination--wrapper").attr("prev_page"),n.type=e.attr("type"),a.spinner=t.siblings(".tbl-preloader--small"),spbcSendAJAXRequest(n,a,e)}),jQuery(".tbl-pagination--next").on("click",function(){var t=jQuery(this),e=t.parents(".tbl-root");n.page=t.parents(".tbl-pagination--wrapper").attr("next_page"),n.type=e.attr("type"),a.spinner=t.siblings(".tbl-preloader--small"),spbcSendAJAXRequest(n,a,e)}),jQuery(".tbl-pagination--end").on("click",function(){var t=jQuery(this),e=t.parents(".tbl-root");n.page=t.parents(".tbl-pagination--wrapper").attr("last_page"),n.type=e.attr("type"),a.spinner=t.siblings(".tbl-preloader--small"),spbcSendAJAXRequest(n,a,e)}),jQuery(".tbl-pagination--start").on("click",function(){var t=jQuery(this),e=t.parents(".tbl-root");n.page=1,n.type=e.attr("type"),a.spinner=t.siblings(".tbl-preloader--small"),spbcSendAJAXRequest(n,a,e)})}function spbcTblPaginationCallback(t,e,n,a){jQuery(a).html(t).find(".tbl-pagination--button").removeAttr("disabled"),spbcTblBulkActionsListen(),spbcTblRowActionsListen(),spbcTblPaginationListen(),spbcTblSortListen(),spbcStartShowHide()}function spbcTblSortListen(){let a={callback:spbcTblSortCallback,notJson:!0};jQuery(".tbl-column-sortable").on("click",function(t){var e,n;t.target.classList.contains("tbl-sorting_indicator")&&(n="links"==(e=(t=jQuery(this)).parents(".tbl-root")).attr("type")?jQuery("#spbc_tbl__scanner__outbound_links b").html():"",t={action:"spbc_tbl-sort",order_by:t.attr("id"),order:t.attr("sort_direction"),type:e.attr("type"),domain:n},spbcSendAJAXRequest(t,a,e))})}function spbcTblSortCallback(t,e,n,a){jQuery(a).html(t),spbcTblBulkActionsListen(),spbcTblRowActionsListen(),spbcTblPaginationListen(),spbcTblSortListen()}function spbcScannerSwitchTable(t,e){var t=jQuery(t),n=t.parents(".row-actions").attr("uid");spbcSendAJAXRequest({action:"spbc_tbl-switch",type:e,domain:n},{callback:spbcTblPaginationCallback,notJson:!0},t.parents(".tbl-root"))}function spbcShowHideRows(t,e){e=jQuery("."+e+"_block_"+t);e.hasClass("mob_table_active")?e.removeClass("mob_table_active"):e.addClass("mob_table_active")}jQuery(document).ready(function(){spbcTblBulkActionsListen(),spbcTblRowActionsListen(),spbcTblPaginationListen(),spbcTblSortListen()});
//# sourceMappingURL=spbc-table.min.js.map
