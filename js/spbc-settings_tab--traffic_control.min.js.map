{"version":3,"file":"spbc-settings_tab--traffic_control.min.js","sources":["spbc-settings_tab--traffic_control.js"],"sourcesContent":["/**\r\n * Callback for displaying Firewall logs\r\n *\r\n * @param {obj} result\r\n * @param {obj} data\r\n * @param {obj} params\r\n */\r\nfunction spbcTcShowMoreCallback(result, data, params) {\r\n    if (data.full_refresh) {\r\n        jQuery(params.wrapper).html(result);\r\n        spbcTblRowActionsListen();\r\n        spbcTblPaginationListen();\r\n        spbcTblSortListen();\r\n        spbcStartShowHide();\r\n    } else if (result.size > 0) {\r\n        jQuery(params.wrapper).html(result.html);\r\n        spbcTblRowActionsListen();\r\n        spbcStartShowHide();\r\n    } else {\r\n        // Hide \"More logs\" button, show \"Control Panel\" button\r\n        jQuery(params.button).hide();\r\n        jQuery(params.button).siblings('.spbc__show_more_logs').css('display', 'inline-block');\r\n    }\r\n}\r\n\r\n/**\r\n * Listener for `Show more` button in the TC log\r\n */\r\nfunction spbcTcShowMoreListen() {\r\n    jQuery('#spbc_show_more_fw_logs_button').on('click', function() {\r\n        if (spbcSettingsFWLogs.clicks < 2) {\r\n            spbcSettingsFWLogs.clicks++;\r\n            let data = {\r\n                action: 'spbc_show_more_security_firewall_logs',\r\n                amount: spbcSettingsFWLogs.amount * (+spbcSettingsFWLogs.clicks+1),\r\n            };\r\n            let params = {\r\n                button: this,\r\n                spinner: this.nextElementSibling,\r\n                wrapper: jQuery('#spbc_tbl__traffic_control_logs').find('tbody'),\r\n                callback: spbcTcShowMoreCallback,\r\n            };\r\n            spbcSendAJAXRequest( data, params );\r\n        } else {\r\n            // Hide \"More logs\" button, show \"Control Panel\" button\r\n            jQuery(this).hide();\r\n            jQuery(this).siblings('.spbc__show_more_logs').css('display', 'inline-block');\r\n        }\r\n    });\r\n}\r\n\r\njQuery(document).ready(function() {\r\n    spbcTblRowActionsListen(); // Table. Row actions handler\r\n    spbcTblPaginationListen(); // Table. Pagination handler\r\n    spbcTblSortListen(); // Table. Sort handler\r\n\r\n    // Start to hide long values in a table\r\n    spbcStartShowHide();\r\n\r\n    // FIREWALL LOGS EVENTS\r\n\r\n    // Handler for show more FIREWALL LOGS\r\n    spbcTcShowMoreListen();\r\n\r\n    // Timer for FireWall logs\r\n    setTimeout(function spbcРeartbeat() {\r\n        // Do refresh only if traffic control is enabled and tab is active\r\n        if ( +spbcSettingsFWLogs.moderate && jQuery('.spbc_tab_nav-traffic_control').hasClass('spbc_tab_nav--active')) {\r\n            let data = {\r\n                action: 'spbc_show_more_security_firewall_logs',\r\n                full_refresh: true,\r\n            };\r\n            let params = {\r\n                wrapper: jQuery('#spbc_tbl__traffic_control_logs'),\r\n                callback: spbcTcShowMoreCallback,\r\n                notJson: true,\r\n            };\r\n            spbcSendAJAXRequest( data, params );\r\n        }\r\n        setTimeout(spbcРeartbeat, 60000);\r\n    }, 60000);\r\n});\r\n\r\n/**\r\n * @param {string} ip\r\n * @return {boolean}\r\n */\r\nfunction spbcTcAllowIp(ip) { // eslint-disable-line no-unused-vars\r\n    spbcTcFilterIp( ip, 'allow');\r\n    return false;\r\n}\r\n\r\n/**\r\n * @param {string} ip\r\n * @return {boolean}\r\n */\r\nfunction spbcTcBanIp(ip) { // eslint-disable-line no-unused-vars\r\n    spbcTcFilterIp( ip, 'deny');\r\n    return false;\r\n}\r\n\r\n/**\r\n * @param {string} ip\r\n * @param {string} status 'allow'|'deny'\r\n * @return {boolean}\r\n */\r\nfunction spbcTcFilterIp(ip, status) {\r\n    const data = {\r\n        action: 'spbc_tc__filter_ip',\r\n        ip: ip,\r\n        status: status,\r\n    };\r\n    const params = {\r\n        callback: spbcTcAllowIpCallback,\r\n    };\r\n    spbcSendAJAXRequest( data, params );\r\n    return false;\r\n}\r\n\r\n/**\r\n * @param {obj} data\r\n */\r\nfunction spbcTcAllowIpCallback(data) {\r\n    if (data.success) {\r\n        alert('Success.');\r\n    } else {\r\n        alert(data.data);\r\n    }\r\n}\r\n"],"names":["spbcTcShowMoreCallback","result","data","params","full_refresh","jQuery","wrapper","html","spbcTblRowActionsListen","spbcTblPaginationListen","spbcTblSortListen","spbcStartShowHide","size","button","hide","siblings","css","spbcTcShowMoreListen","on","spbcSettingsFWLogs","clicks","action","amount","this","spinner","nextElementSibling","find","callback","spbcSendAJAXRequest","spbcTcAllowIp","ip","spbcTcFilterIp","spbcTcBanIp","status","spbcTcAllowIpCallback","success","alert","document","ready","setTimeout","spbcРeartbeat","moderate","hasClass","notJson"],"mappings":"AAOA,SAASA,uBAAuBC,EAAQC,EAAMC,GACtCD,EAAKE,cACLC,OAAOF,EAAOG,OAAO,EAAEC,KAAKN,CAAM,EAClCO,wBAAwB,EACxBC,wBAAwB,EACxBC,kBAAkB,EAClBC,kBAAkB,GACG,EAAdV,EAAOW,MACdP,OAAOF,EAAOG,OAAO,EAAEC,KAAKN,EAAOM,IAAI,EACvCC,wBAAwB,EACxBG,kBAAkB,IAGlBN,OAAOF,EAAOU,MAAM,EAAEC,KAAK,EAC3BT,OAAOF,EAAOU,MAAM,EAAEE,SAAS,uBAAuB,EAAEC,IAAI,UAAW,cAAc,EAE7F,CAKA,SAASC,uBACLZ,OAAO,gCAAgC,EAAEa,GAAG,QAAS,WACjD,IAEQhB,EAIAC,EANJgB,mBAAmBC,OAAS,GAC5BD,mBAAmBC,MAAM,GACrBlB,EAAO,CACPmB,OAAQ,wCACRC,OAAQH,mBAAmBG,QAAU,CAACH,mBAAmBC,OAAO,EACpE,EACIjB,EAAS,CACTU,OAAQU,KACRC,QAASD,KAAKE,mBACdnB,QAASD,OAAO,iCAAiC,EAAEqB,KAAK,OAAO,EAC/DC,SAAU3B,sBACd,EACA4B,oBAAqB1B,EAAMC,CAAO,IAGlCE,OAAOkB,IAAI,EAAET,KAAK,EAClBT,OAAOkB,IAAI,EAAER,SAAS,uBAAuB,EAAEC,IAAI,UAAW,cAAc,EAEpF,CAAC,CACL,CAsCA,SAASa,cAAcC,GAEnB,OADAC,eAAgBD,EAAI,OAAO,EACpB,CAAA,CACX,CAMA,SAASE,YAAYF,GAEjB,OADAC,eAAgBD,EAAI,MAAM,EACnB,CAAA,CACX,CAOA,SAASC,eAAeD,EAAIG,GAUxB,OADAL,oBARa,CACTP,OAAQ,qBACRS,GAAIA,EACJG,OAAQA,CACZ,EACe,CACXN,SAAUO,qBACd,CACkC,EAC3B,CAAA,CACX,CAKA,SAASA,sBAAsBhC,GACvBA,EAAKiC,QACLC,MAAM,UAAU,EAEhBA,MAAMlC,EAAKA,IAAI,CAEvB,CA7EAG,OAAOgC,QAAQ,EAAEC,MAAM,WACnB9B,wBAAwB,EACxBC,wBAAwB,EACxBC,kBAAkB,EAGlBC,kBAAkB,EAKlBM,qBAAqB,EAGrBsB,WAAW,SAASC,IAEhB,IACQtC,EAIAC,EALH,CAACgB,mBAAmBsB,UAAYpC,OAAO,+BAA+B,EAAEqC,SAAS,sBAAsB,IACpGxC,EAAO,CACPmB,OAAQ,wCACRjB,aAAc,CAAA,CAClB,EACID,EAAS,CACTG,QAASD,OAAO,iCAAiC,EACjDsB,SAAU3B,uBACV2C,QAAS,CAAA,CACb,EACAf,oBAAqB1B,EAAMC,CAAO,GAEtCoC,WAAWC,EAAe,GAAK,CACnC,EAAG,GAAK,CACZ,CAAC"}