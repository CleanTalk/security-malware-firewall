{"version":3,"file":"spbc-settings_tab--traffic_control.min.js","sources":["spbc-settings_tab--traffic_control.js"],"sourcesContent":["// Callback for displaying Firewall logs\r\nfunction spbc_tc__show_more__callback(result, data, params){\r\n\tif(data.full_refresh){\r\n\t\tjQuery(params.wrapper).html(result);\r\n\t\tspbc_tbl__row_actions__listen();\r\n\t\tspbc_tbl__pagination__listen();\r\n\t\tspbc_tbl__sort__listen();\r\n\t\tspbcStartShowHide();\r\n\t}else if(result.size > 0){\r\n\t\tjQuery(params.wrapper).html(result.html);\r\n\t\tspbc_tbl__row_actions__listen();\r\n\t\tspbcStartShowHide();\r\n\t}else{\r\n\t\t// Hide \"More logs\" button, show \"Control Panel\" button\r\n\t\tjQuery(params.button).hide();\r\n\t\tjQuery(params.button).siblings('.spbc__show_more_logs').css('display', 'inline-block');\r\n\t}\r\n}\r\n\r\nfunction spbc_tc__show_more__listen(){\t\r\n\tjQuery('#spbc_show_more_fw_logs_button').on('click', function(){\r\n\t\tif(spbcSettingsFWLogs.clicks < 2){\r\n\t\t\tspbcSettingsFWLogs.clicks++;\r\n\t\t\tvar data = {\r\n\t\t\t\taction: 'spbc_show_more_security_firewall_logs',\r\n\t\t\t\tamount: spbcSettingsFWLogs.amount * (+spbcSettingsFWLogs.clicks+1),\r\n\t\t\t};\t\t\t\r\n\t\t\tvar params = {\r\n\t\t\t\tbutton: this,\r\n\t\t\t\tspinner: this.nextElementSibling,\r\n\t\t\t\twrapper: jQuery('#spbc_tbl__traffic_control_logs').find('tbody'),\r\n\t\t\t\tcallback: spbc_tc__show_more__callback,\r\n\t\t\t};\r\n\t\t\tspbc_sendAJAXRequest( data, params );\r\n\t\t}else{\r\n\t\t\t// Hide \"More logs\" button, show \"Control Panel\" button\r\n\t\t\tjQuery(this).hide();\r\n\t\t\tjQuery(this).siblings('.spbc__show_more_logs').css('display', 'inline-block');\r\n\t\t}\r\n\t});\t\r\n}\r\n\r\njQuery(document).ready(function(){\r\n\t\r\n\tspbc_tbl__row_actions__listen(); // Table. Row actions handler\r\n\tspbc_tbl__pagination__listen();  // Table. Pagination handler\r\n\tspbc_tbl__sort__listen();        // Table. Sort handler\r\n\t\r\n\t// Start to hide long values in a table\r\n\tspbcStartShowHide();\r\n\t\r\n\t// FIREWALL LOGS EVENTS\r\n\t\r\n\t// Handler for show more FIREWALL LOGS\r\n\tspbc_tc__show_more__listen();\r\n\t\r\n\t// Timer for FireWall logs\r\n\tvar spbcFireWallLogsUpdateTimer = setTimeout(function spbc_heartbeat(){\t\t\r\n\t\t// Do refresh only if traffic control is enabled and tab is active\r\n\t\tif( +spbcSettingsFWLogs.moderate && jQuery('.spbc_tab_nav-traffic_control').hasClass('spbc_tab_nav--active')){\r\n\t\t\tvar data = {\r\n\t\t\t\taction: 'spbc_show_more_security_firewall_logs',\r\n\t\t\t\tfull_refresh: true,\r\n\t\t\t};\r\n\t\t\tvar params = {\r\n\t\t\t\twrapper: jQuery('#spbc_tbl__traffic_control_logs'),\r\n\t\t\t\tcallback: spbc_tc__show_more__callback,\r\n\t\t\t\tnotJson: true,\r\n\t\t\t};\r\n\t\t\tspbc_sendAJAXRequest( data, params );\r\n\t\t}\r\n\t\tsetTimeout(spbc_heartbeat, 60000);\r\n\t}, 60000);\t\r\n});\r\n\r\nfunction spbc_tc__allow_ip(ip) {\r\n\tspbc_tc__filter_ip( ip, 'allow')\r\n\treturn false;\r\n}\r\n\r\nfunction spbc_tc__ban_ip(ip) {\r\n\tspbc_tc__filter_ip( ip, 'deny')\r\n\treturn false;\r\n}\r\n\r\nfunction spbc_tc__filter_ip( ip, status) {\r\n\tconst data = {\r\n\t\taction: 'spbc_tc__filter_ip',\r\n\t\tip: ip,\r\n\t\tstatus: status\r\n\t};\r\n\tconst params = {\r\n\t\tcallback: spbc_tc__allow_ip__callback,\r\n\t};\r\n\tspbc_sendAJAXRequest( data, params );\r\n\treturn false;\r\n}\r\n\r\nfunction spbc_tc__allow_ip__callback(data) {\r\n\tif (data.success) {\r\n\t\talert('Success.');\r\n\t} else {\r\n\t\talert(data.data);\r\n\t}\r\n}"],"names":["spbc_tc__show_more__callback","result","data","params","full_refresh","jQuery","wrapper","html","spbc_tbl__row_actions__listen","spbc_tbl__pagination__listen","spbc_tbl__sort__listen","spbcStartShowHide","size","button","hide","siblings","css","spbc_tc__show_more__listen","on","spbcSettingsFWLogs","clicks","action","amount","this","spinner","nextElementSibling","find","callback","spbc_sendAJAXRequest","spbc_tc__allow_ip","ip","spbc_tc__filter_ip","spbc_tc__ban_ip","status","spbc_tc__allow_ip__callback","success","alert","document","ready","setTimeout","spbc_heartbeat","moderate","hasClass","notJson"],"mappings":"AACA,SAASA,6BAA6BC,EAAQC,EAAMC,GAChDD,EAAKE,cACPC,OAAOF,EAAOG,OAAO,EAAEC,KAAKN,CAAM,EAClCO,8BAA8B,EAC9BC,6BAA6B,EAC7BC,uBAAuB,EACvBC,kBAAkB,GACI,EAAdV,EAAOW,MACfP,OAAOF,EAAOG,OAAO,EAAEC,KAAKN,EAAOM,IAAI,EACvCC,8BAA8B,EAC9BG,kBAAkB,IAGlBN,OAAOF,EAAOU,MAAM,EAAEC,KAAK,EAC3BT,OAAOF,EAAOU,MAAM,EAAEE,SAAS,uBAAuB,EAAEC,IAAI,UAAW,cAAc,EAEvF,CAEA,SAASC,6BACRZ,OAAO,gCAAgC,EAAEa,GAAG,QAAS,WACpD,IAEKhB,EAIAC,EANFgB,mBAAmBC,OAAS,GAC9BD,mBAAmBC,MAAM,GACrBlB,EAAO,CACVmB,OAAQ,wCACRC,OAAQH,mBAAmBG,QAAU,CAACH,mBAAmBC,OAAO,EACjE,EACIjB,EAAS,CACZU,OAAQU,KACRC,QAASD,KAAKE,mBACdnB,QAASD,OAAO,iCAAiC,EAAEqB,KAAK,OAAO,EAC/DC,SAAU3B,4BACX,EACA4B,qBAAsB1B,EAAMC,CAAO,IAGnCE,OAAOkB,IAAI,EAAET,KAAK,EAClBT,OAAOkB,IAAI,EAAER,SAAS,uBAAuB,EAAEC,IAAI,UAAW,cAAc,EAE9E,CAAC,CACF,CAmCA,SAASa,kBAAkBC,GAE1B,OADAC,mBAAoBD,EAAI,OAAO,EACxB,CAAA,CACR,CAEA,SAASE,gBAAgBF,GAExB,OADAC,mBAAoBD,EAAI,MAAM,EACvB,CAAA,CACR,CAEA,SAASC,mBAAoBD,EAAIG,GAUhC,OADAL,qBARa,CACZP,OAAQ,qBACRS,GAAIA,EACJG,OAAQA,CACT,EACe,CACdN,SAAUO,2BACX,CACmC,EAC5B,CAAA,CACR,CAEA,SAASA,4BAA4BhC,GAChCA,EAAKiC,QACRC,MAAM,UAAU,EAEhBA,MAAMlC,EAAKA,IAAI,CAEjB,CA9DAG,OAAOgC,QAAQ,EAAEC,MAAM,WAEtB9B,8BAA8B,EAC9BC,6BAA6B,EAC7BC,uBAAuB,EAGvBC,kBAAkB,EAKlBM,2BAA2B,EAGOsB,WAAW,SAASC,IAErD,IAKKrC,EALD,CAACgB,mBAAmBsB,UAAYpC,OAAO,+BAA+B,EAAEqC,SAAS,sBAAsB,IAKtGvC,EAAS,CACZG,QAASD,OAAO,iCAAiC,EACjDsB,SAAU3B,6BACV2C,QAAS,CAAA,CACV,EACAf,qBATW,CACVP,OAAQ,wCACRjB,aAAc,CAAA,CACf,EAM4BD,CAAO,GAEpCoC,WAAWC,EAAgB,GAAK,CACjC,EAAG,GAAK,CACT,CAAC"}