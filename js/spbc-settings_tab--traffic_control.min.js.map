{"version":3,"file":"spbc-settings_tab--traffic_control.min.js","sources":["spbc-settings_tab--traffic_control.js"],"sourcesContent":["/**\n * Callback for displaying Firewall logs\n *\n * @param {obj} result\n * @param {obj} data\n * @param {obj} params\n */\nfunction spbcTcShowMoreCallback(result, data, params) {\n    if (data.full_refresh) {\n        jQuery(params.wrapper).html(result);\n        spbcTblRowActionsListen();\n        spbcTblPaginationListen();\n        spbcTblSortListen();\n        spbcStartShowHide();\n    } else if (result.size > 0) {\n        jQuery(params.wrapper).html(result.html);\n        spbcTblRowActionsListen();\n        spbcStartShowHide();\n    } else {\n        // Hide \"More logs\" button, show \"Control Panel\" button\n        jQuery(params.button).hide();\n        jQuery(params.button).siblings('.spbc__show_more_logs').css('display', 'inline-block');\n    }\n}\n\n/**\n * Listener for `Show more` button in the TC log\n */\nfunction spbcTcShowMoreListen() {\n    jQuery('#spbc_show_more_fw_logs_button').on('click', function() {\n        if (spbcSettingsFWLogs.clicks < 2) {\n            spbcSettingsFWLogs.clicks++;\n            let data = {\n                action: 'spbc_show_more_security_firewall_logs',\n                amount: spbcSettingsFWLogs.amount * (+spbcSettingsFWLogs.clicks+1),\n            };\n            let params = {\n                button: this,\n                spinner: this.nextElementSibling,\n                wrapper: jQuery('#spbc_tbl__traffic_control_logs').find('tbody'),\n                callback: spbcTcShowMoreCallback,\n            };\n            spbcSendAJAXRequest( data, params );\n        } else {\n            // Hide \"More logs\" button, show \"Control Panel\" button\n            jQuery(this).hide();\n            jQuery(this).siblings('.spbc__show_more_logs').css('display', 'inline-block');\n        }\n    });\n}\n\njQuery(document).ready(function() {\n    spbcTblRowActionsListen(); // Table. Row actions handler\n    spbcTblPaginationListen(); // Table. Pagination handler\n    spbcTblSortListen(); // Table. Sort handler\n\n    // Start to hide long values in a table\n    spbcStartShowHide();\n\n    // FIREWALL LOGS EVENTS\n\n    // Handler for show more FIREWALL LOGS\n    spbcTcShowMoreListen();\n\n    // Timer for FireWall logs\n    setTimeout(function spbcРeartbeat() {\n        // Do refresh only if traffic control is enabled and tab is active\n        if ( +spbcSettingsFWLogs.moderate && jQuery('.spbc_tab_nav-traffic_control').hasClass('spbc_tab_nav--active')) {\n            let data = {\n                action: 'spbc_show_more_security_firewall_logs',\n                full_refresh: true,\n            };\n            let params = {\n                wrapper: jQuery('#spbc_tbl__traffic_control_logs'),\n                callback: spbcTcShowMoreCallback,\n                notJson: true,\n            };\n            spbcSendAJAXRequest( data, params );\n        }\n        setTimeout(spbcРeartbeat, 60000);\n    }, 60000);\n});\n\n/**\n * @param {string} ip\n * @return {boolean}\n */\nfunction spbcTcAllowIp(ip) { // eslint-disable-line no-unused-vars\n    spbcTcFilterIp( ip, 'allow');\n    return false;\n}\n\n/**\n * @param {string} ip\n * @return {boolean}\n */\nfunction spbcTcBanIp(ip) { // eslint-disable-line no-unused-vars\n    spbcTcFilterIp( ip, 'deny');\n    return false;\n}\n\n/**\n * @param {string} ip\n * @param {string} status 'allow'|'deny'\n * @return {boolean}\n */\nfunction spbcTcFilterIp(ip, status) {\n    const data = {\n        action: 'spbc_tc__filter_ip',\n        ip: ip,\n        status: status,\n    };\n    const params = {\n        callback: spbcTcAllowIpCallback,\n    };\n    spbcSendAJAXRequest( data, params );\n    return false;\n}\n\n/**\n * @param {obj} data\n */\nfunction spbcTcAllowIpCallback(data) {\n    if (data.success) {\n        alert('Success.');\n    } else {\n        alert(data.data);\n    }\n}\n"],"names":["spbcTcShowMoreCallback","result","data","params","full_refresh","jQuery","wrapper","html","spbcTblRowActionsListen","spbcTblPaginationListen","spbcTblSortListen","spbcStartShowHide","size","button","hide","siblings","css","spbcTcShowMoreListen","on","spbcSettingsFWLogs","clicks","action","amount","this","spinner","nextElementSibling","find","callback","spbcSendAJAXRequest","spbcTcAllowIp","ip","spbcTcFilterIp","spbcTcBanIp","status","spbcTcAllowIpCallback","success","alert","document","ready","setTimeout","spbcРeartbeat","moderate","hasClass","notJson"],"mappings":"AAOA,SAASA,uBAAuBC,EAAQC,EAAMC,GACtCD,EAAKE,cACLC,OAAOF,EAAOG,OAAO,EAAEC,KAAKN,CAAM,EAClCO,wBAAwB,EACxBC,wBAAwB,EACxBC,kBAAkB,EAClBC,kBAAkB,GACG,EAAdV,EAAOW,MACdP,OAAOF,EAAOG,OAAO,EAAEC,KAAKN,EAAOM,IAAI,EACvCC,wBAAwB,EACxBG,kBAAkB,IAGlBN,OAAOF,EAAOU,MAAM,EAAEC,KAAK,EAC3BT,OAAOF,EAAOU,MAAM,EAAEE,SAAS,uBAAuB,EAAEC,IAAI,UAAW,cAAc,EAE7F,CAKA,SAASC,uBACLZ,OAAO,gCAAgC,EAAEa,GAAG,QAAS,WACjD,IAEQhB,EAIAC,EANJgB,mBAAmBC,OAAS,GAC5BD,mBAAmBC,MAAM,GACrBlB,EAAO,CACPmB,OAAQ,wCACRC,OAAQH,mBAAmBG,QAAU,CAACH,mBAAmBC,OAAO,EACpE,EACIjB,EAAS,CACTU,OAAQU,KACRC,QAASD,KAAKE,mBACdnB,QAASD,OAAO,iCAAiC,EAAEqB,KAAK,OAAO,EAC/DC,SAAU3B,sBACd,EACA4B,oBAAqB1B,EAAMC,CAAO,IAGlCE,OAAOkB,IAAI,EAAET,KAAK,EAClBT,OAAOkB,IAAI,EAAER,SAAS,uBAAuB,EAAEC,IAAI,UAAW,cAAc,EAEpF,CAAC,CACL,CAsCA,SAASa,cAAcC,GAEnB,OADAC,eAAgBD,EAAI,OAAO,EACpB,CAAA,CACX,CAMA,SAASE,YAAYF,GAEjB,OADAC,eAAgBD,EAAI,MAAM,EACnB,CAAA,CACX,CAOA,SAASC,eAAeD,EAAIG,GAUxB,OADAL,oBARa,CACTP,OAAQ,qBACRS,GAAIA,EACJG,OAAQA,CACZ,EACe,CACXN,SAAUO,qBACd,CACkC,EAC3B,CAAA,CACX,CAKA,SAASA,sBAAsBhC,GACvBA,EAAKiC,QACLC,MAAM,UAAU,EAEhBA,MAAMlC,EAAKA,IAAI,CAEvB,CA7EAG,OAAOgC,QAAQ,EAAEC,MAAM,WACnB9B,wBAAwB,EACxBC,wBAAwB,EACxBC,kBAAkB,EAGlBC,kBAAkB,EAKlBM,qBAAqB,EAGrBsB,WAAW,SAASC,IAEhB,IACQtC,EAIAC,EALH,CAACgB,mBAAmBsB,UAAYpC,OAAO,+BAA+B,EAAEqC,SAAS,sBAAsB,IACpGxC,EAAO,CACPmB,OAAQ,wCACRjB,aAAc,CAAA,CAClB,EACID,EAAS,CACTG,QAASD,OAAO,iCAAiC,EACjDsB,SAAU3B,uBACV2C,QAAS,CAAA,CACb,EACAf,oBAAqB1B,EAAMC,CAAO,GAEtCoC,WAAWC,EAAe,GAAK,CACnC,EAAG,GAAK,CACZ,CAAC"}