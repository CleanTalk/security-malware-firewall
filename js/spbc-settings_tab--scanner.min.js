function spbcPopupTipShow(e){var o=e.attr("spbc_tip_title")||null,t=e.attr("spbc_tip_text")||null;function n(e){void 0!==e&&0!=jQuery(e.target).parent(".spbc_popup_tip--wrapper").length&&!jQuery(e.target).hasClass("spbc_popup_tip--icon---cancel")||(jQuery(".spbc_popup_tip--wrapper").hide(),jQuery(document).off("click",n))}n(),e.after("<div class='spbc_popup_tip--wrapper'></div>");var s=jQuery(".spbc_popup_tip--wrapper");s.empty().append("<div class='spbc_popup_tip--angle'></div>").css({top:e.position().top-2,left:e.position().left+25}),s.append("<i class='spbc_popup_tip--icon---cancel icon-cancel'></i>").append("<h3 class='spbc_popup_tip--title'>"+o+"</h3>").append("<p class='spbc_popup_tip--text'>"+t+"</p>"),jQuery(document).on("click",n),e.parents("tr").on("mouseout",n)}function spbcScannerButtonFileViewEvent(e){var e=jQuery(e),o={action:"spbc_scanner_file_view",file_id:e.parents(".row-actions").attr("uid")},e={spinner:e.parent().siblings(".tbl-preloader--tiny"),callback:spbcScannerButtonViewCallback,errorOutput:function(e){spbcModal.open().putError(e)}};spbcSendAJAXRequest(o,e)}function spbcScannerAnalysisLogDeleteFromLog(e){let t=[];var o=jQuery(e);let n;if(jQuery(e).hasClass("tbl-row_action"))t.push(o.parents(".row-actions").attr("uid")),n=o.parent().siblings(".tbl-preloader--tiny");else{e=o.closest("#spbc_tbl__scanner_analysis_log").find(".cb-select:checked");if(0===e.length)return void alert("Please, select elements.");e.each(function(e,o){o=jQuery(o).val();t.push(o)}),n=o.children(".tbl-preloader--small")}e={action:"spbc_scanner_analysis_log_delete_from_log",file_ids:t},o={spinner:n,callback:function(){window.location.reload()}};spbcSendAJAXRequest(e,o)}function spbcScannerButtonPageViewEvent(e){var e=jQuery(e),o={action:"spbc_scanner_page_view",page_url:e.parents(".row-actions").attr("uid")},e={spinner:e.parent().siblings(".tbl-preloader--tiny"),callback:spbcScannerButtonViewCallback,errorOutput:function(e){spbcModal.open().putError(e)}},t=jQuery("#wpwrap"),n=jQuery("#spbc_dialog"),s=(n.dialog({modal:!0,title:"Loading..",position:{my:"center top",at:"center top+100px",of:window},width:t.width()/100*90,show:{effect:"blind",duration:500},draggable:!1,resizable:!1,closeText:"X",classes:{"ui-dialog":"spbc---top"},open:function(e,o){e.target.style.overflow="auto",jQuery("#spbc_dialog").height(document.documentElement.clientHeight/100*25)},beforeClose:function(e,o){document.body.style.overflow="auto",jQuery("#spbc_dialog").empty()}}),n.append('<img id="spbc_file_view_preloader" alt="Wait for downloading" class="spbc_preloader" src="../../wp-content/plugins/security-malware-firewall/images/preloader2.gif" style="display: block; position: absolute; ">'),jQuery("#spbc_file_view_preloader")),t=4e-4*t.width();s.height(128*t),s.width(128*t),s.css({left:n.width()/2-128*t/2}),s.css({top:n.height()/2-128*t/2}),spbcSendAJAXRequest(o,e)}function spbcScannerButtonViewCallback(e){var o,t=jQuery("#spbc_dialog"),n=(t.empty(),jQuery("#spbc_file_view_preloader").css({display:"none"}),'<div class="spbc_view_file_row_wrapper"><span class="spbc_view_file_row_num">%s</span>');for(o in n+='<p class="spbc_view_file_row">%s</p><br /></div>',e.file)t.append(n.printf(o,e.file[o]));var s=19*Object.keys(e.file).length<76?76:19*Object.keys(e.file).length,a=document.documentElement.clientHeight/100*75;let c=s<a?"hidden":"scroll",r="scroll"==c?a:s;t.css({height:r,overflow:c}),t.dialog({modal:!0,title:"Loaded: "+e.file_path,position:{my:"center top",at:"center top+100px",of:window},width:jQuery("#wpwrap").width()/100*90,show:{effect:"blind",duration:500},draggable:!0,resizable:!1,height:r,closeText:"X",classes:{"ui-dialog":"spbc---top"},open:function(e,o){e.target.style.overflow=c,jQuery("#spbc_dialog").height(r),jQuery(".ui-widget-overlay").on("click",function(){jQuery("#spbc_dialog").dialog("close")})},beforeClose:function(e,o){document.body.style.overflow="auto",jQuery("#spbc_dialog").empty()}}),console.log("FILE_VIEWED")}function spbcScannerButtonFileViewBadEvent(e){var e=jQuery(e),o={action:"spbc_scanner_file_view",file_id:e.parents(".row-actions").attr("uid")},e={spinner:e.parent().siblings(".tbl-preloader--tiny"),callback:spbcScannerButtonViewBadFileCallback,errorOutput:function(e){spbcModal.open().putError(e)}};spbcSendAJAXRequest(o,e)}function spbcScannerButtonPageViewBadEvent(e){var e=jQuery(e),o={action:"spbc_scanner_page_view",page_url:e.parent().attr("uid")},e={spinner:e.parent().siblings(".tbl-preloader--tiny"),callback:spbcScannerButtonViewBadCallback,errorOutput:function(e){spbcModal.open().putError(e)}};spbcSendAJAXRequest(o,e)}function spbcScannerButtonViewBadFileCallback(o,e,t){console.log("FILE_VIEWED_BAD_CODE_FILE"),jQuery("#spbc_dialog").empty();var n,s,a,c='<div class="spbc_view_file_row_wrapper"><span class="spbc_view_file_row_num">%s</span>',r=(c+='<p class="spbc_view_file_row">%s</p><br /></div>','<div class="spbc_view_file_row_wrapper" style="background: rgba(200,40,40,0.8);">'),i=(r=r+'<span class="spbc_view_file_row_num">%s</span>'+'<p class="spbc_view_file_row">%s</p><br /></div>',[]),l=[];for(s in o.weak_spots=JSON.parse(o.weak_spots),o.weak_spots)i[s]=Object.keys(o.weak_spots[s]);for(key in n=Object.keys(i).sort())l[n[key]]=i[n[key]];for(a in l){var p,u="spbc-dialog-row-header-"+a.toLowerCase(),d='<span id="'+u+'" style="text-align: center"><b>',_=(d+=a+" weakspots:</b></span>",jQuery("#spbc_dialog")),d=(_.append(c.printf("",d)),_.append(c.printf("<b>...</b>","<b>...</b>")),_.find("#"+u));for(p in d.parent().parent().css("text-align","center"),d.parent().parent().css("border","1px dotted"),d.parent().parent().css("background","darkgrey"),i[a]){p=[...new Set(p)].sort();var b,f=+i[a][p];for(let e=f-2;e<=2+f;e++)void 0!==o.file[e]&&(b=f===e?'<div class="spbc_view_file_row_wrapper" style="background: rgba(200,40,40,0.8);"><span class="spbc_view_file_row_num">%s</span><p class="spbc_view_file_row">%s</p><br /></div>':c,_.append(b.printf(e,o.file[e])));_.append(c.printf("<b>...</b>","<b>...</b>"))}}jQuery("#spbc_dialog div").last().remove();var r=19*jQuery("#spbc_dialog div").length<76?76:19*jQuery("#spbc_dialog div").length,g=document.documentElement.clientHeight/100*75;let w=r<g?"no_scroll":"scroll",y="scroll"==w?g:r;jQuery("#spbc_dialog").dialog({modal:!0,title:o.file_path,position:{my:"center top",at:"center top+100px",of:window},width:jQuery("#wpwrap").width()/100*90,show:{effect:"blind",duration:500},draggable:!0,resizable:!1,closeText:"X",classes:{"ui-dialog":"spbc---top"},open:function(e,o){e.target.style.overflow=w,jQuery("#spbc_dialog").height(y),jQuery(".ui-widget-overlay").on("click",function(){jQuery("#spbc_dialog").dialog("close")})},beforeClose:function(e,o){document.body.style.overflow="auto",jQuery("#spbc_dialog").empty()}})}function spbcScannerButtonViewBadCallback(s,e,o){console.log("FILE_VIEWED_BAD_CODE");let t=()=>{};if(1==s.success){console.log(s);var a,c='<div class="spbc_view_file_row_wrapper"><span class="spbc_view_file_row_num">%s</span><p class="spbc_view_file_row" style="word-break: break-all">%s</p><br /></div>';let n=[];for(a in s.weak_spots=JSON.parse(s.weak_spots),s.weak_spots)n=n.concat(Object.keys(s.weak_spots[a]));n=[...new Set(n)].sort();var r,i=new Map(Object.entries(s.weak_spots.CRITICAL));for(r in n)if(0!=r||!i.get(n[r]).toLowerCase().includes("doctype")){var l=+n[r];for(let t=l-2;t<=2+l;t++)if(void 0!==s.file[t]){var p=l===t;let e,o;e=p?'<div class="spbc_view_file_row_wrapper" style="background: rgb(200,120,120);"><span class="spbc_view_file_row_num">%s</span><p class="spbc_view_file_row" style="word-break: break-all">%s</p><br /></div>':c,o=p&&!s.file[t].includes("iframe")?e.printf(t,i.get(n[r])):e.printf(t,s.file[t]),jQuery("#spbc_dialog").append(o)}jQuery("#spbc_dialog").append(c.printf("","")),jQuery("#spbc_dialog div").last().remove()}}else jQuery("#spbc_dialog").append('<div style="margin:40px;text-align:center;">%s</div>'.printf(s.content)),t=()=>{document.location.reload()};var n=19*jQuery("#spbc_dialog div").length<76?76:19*jQuery("#spbc_dialog div").length,u=document.documentElement.clientHeight/100*75;let d=n<u?"no_scroll":"scroll";jQuery("#spbc_dialog").dialog({modal:!0,title:s.file_path,position:{my:"center top",at:"center top+100px",of:window},width:jQuery("#wpwrap").width()/100*90,show:{effect:"blind",duration:500},draggable:!0,resizable:!1,closeText:"X",classes:{"ui-dialog":"spbc---top"},open:function(e,o){e.target.style.overflow=d,jQuery("#spbc_dialog").height("auto"),jQuery(".ui-widget-overlay").on("click",function(){jQuery("#spbc_dialog").dialog("close")})},beforeClose:function(e,o){document.body.style.overflow="auto",jQuery("#spbc_dialog").empty()},close:t})}function spbcScannerButtonFileCompareEvent(e){var e=jQuery(e),o={action:"spbc_scanner_file_compare",file_id:e.parents(".row-actions").attr("uid")},e={spinner:e.parent().siblings(".tbl-preloader--tiny"),callback:spbcScannerButtonFileCompareCallback,errorOutput:function(e){spbcModal.open().putError(e)}};spbcSendAJAXRequest(o,e)}function spbcScannerButtonFileCompareCallback(t,e,o){console.log("FILE_COMPARED");var n='<div class="spbc_compare_file_row_wrapper">',s='<div class="spbc_compare_file_row_wrapper" style="background: rgba(200,40,40,0.8);">',a=(s=s+'<p class="spbc_compare_file_row">%s</p><span class="spbc_compare_file_row_num">%s</span>'+'<p class="spbc_compare_file_row">%s</p><br /></div>',(n=n+'<p class="spbc_compare_file_row">%s</p><span class="spbc_compare_file_row_num">%s</span>'+'<p class="spbc_compare_file_row">%s</p><br /></div>').printf('<span class="spbc_compare_file_headings">Modified</span>',"Line",'<span class="spbc_compare_file_headings">Original</span>'));jQuery("#spbc_dialog").append(a);for(let o=1;void 0!==t.file[o]||void 0!==t.file_original[o];o++)if(void 0===t.file[o]&&(t.file[o]=""),void 0===t.file_original[o]&&(t.file_original[o]=""),-1!=t.difference.indexOf(o)){for(let e=o-2;e<=o+2;e++)void 0!==t.file[e]&&void 0!==t.file_original[o]&&jQuery("#spbc_dialog").append((o===e?s:n).printf(t.file[e]||"",e,t.file_original[e]||""));jQuery("#spbc_dialog").append(n.printf("","",""))}var a=19*jQuery("#spbc_dialog div").length+19,c=document.documentElement.clientHeight/100*75;let r=a<c?"no_scroll":"scroll",i="scroll"==r?c:a;jQuery("#spbc_dialog").dialog({modal:!0,title:t.file_path,position:{my:"center top",at:"center top+100px",of:window},width:jQuery("#wpwrap").width()/100*90,height:i,show:{effect:"blind",duration:500},draggable:!0,resizable:!0,closeText:"X",classes:{"ui-dialog":"spbc---top"},open:function(e,o){document.body.style.overflow="hidden",e.target.style.overflow=r,jQuery("#spbc_dialog").height(i)},beforeClose:function(e,o){document.body.style.overflow="auto",jQuery("#spbc_dialog").empty()}})}function spbcScannerReloadScanInfo(){jQuery(".spbc_hint__last_scan_title").text(spbcScaner.look_below_for_scan_res);spbcSendAJAXRequest({action:"spbc_scanner__last_scan_info"},{callback:e=>{document.getElementById("spbc_scanner__last_scan_info").innerText=e.data}})}function spbcScannerButtonCureFileAjaxHandler(e){e={action:"spbc_file_cure_ajax_action",file_fast_hash:jQuery(e).parents(".row-actions").attr("uid"),security:spbcSettings.ajax_nonce};jQuery.ajax({type:"POST",async:!0,url:spbcSettings.ajaxurl,data:e,success:function(e){e.success?(spbcModal.open().put(e.data),document.addEventListener("spbcModalClosed",function(e){document.location.reload()})):spbcModal.open().putError(e.data)}})}function spbcScannerButtonRestoreFromBackupAjaxHandler(e){e={action:"spbc_restore_file_from_backup_ajax_action",file_fast_hash:jQuery(e).parents(".row-actions").attr("uid"),security:spbcSettings.ajax_nonce};jQuery.ajax({type:"POST",async:!0,url:spbcSettings.ajaxurl,data:e,success:function(e){e.success?(spbcModal.open().put(e.data),document.addEventListener("spbcModalClosed",function(e){document.location.reload()})):spbcModal.open().putError(e.data)}})}function spbcScannerButtonClearScanResults(){confirm("Do you confirm to clear the scan results?")&&(console.log("CLEAR"),spbcSendAJAXRequest({action:"spbc_scanner_clear"},{type:"GET",successCallback:function(){document.location=document.location},complete:null,errorOutput:null,context:this,timeout:4e4,success:function(){document.location.reload()}}))}jQuery(document).ready(function(){spbcTblBulkActionsListen(),spbcTblRowActionsListen(),spbcTblPaginationListen(),spbcTblSortListen(),spbcStartShowHide(),jQuery("#spbc_scaner_progress_bar").progressbar({value:0,create:function(e,o){e.target.style.position="relative",e.target.style.marginBottom="12px"},change:function(e,o){jQuery(".spbc_progressbar_counter span").text(jQuery(e.target).progressbar("option","value")+" %")}}),jQuery("#spbc_scan_accordion").accordion({header:"h3",heightStyle:"content",collapsible:!0,active:!1,activate:function(e,o){0===o.oldPanel.length&&0===o.oldHeader.length&&jQuery("#spbc_scan_accordion").accordion("option","classes.ui-accordion-content","ui-corner-bottom spbc-overflow--visible")},beforeActivate:function(e,o){1===o.oldPanel.length&&1===o.oldHeader.length&&jQuery("#spbc_scan_accordion").accordion("option","classes.ui-accordion-content","ui-corner-bottom")}}),window.spbcScanner=new SpbcMalwareScanner({settings:spbcScaner.settings,states:spbcScaner.states,button:jQuery("#spbc_perform_scan"),spinner:jQuery("#spbc_perform_scan").next(),callback:null,progress_overall:jQuery("#spbc_scaner_progress_overall"),progressbar:jQuery("#spbc_scaner_progress_bar"),progressbar_text:jQuery(".spbc_progressbar_counter span"),wrapper:document.getElementsByClassName("spbc_unchecked_file_list"),warnings:{long_scan:jQuery(".spbc_hint_warning__long_scan"),outdated:jQuery(".spbc_hint_warning__outdated")}}),jQuery(document).on("click",".spbc_popup_tip--icon---show",function(){spbcPopupTipShow(jQuery(this))}),jQuery("#spbc_perform_scan").on("click",function(){jQuery("#spbcscan-results-log-module").remove(),spbcScanner.actionControl(),jQuery(".spbc_log-wrapper .panel-body").length||jQuery(".spbc_log-wrapper").append('<div class="panel-body"></div>'),jQuery(".spbc_log-wrapper").resizable({handles:"n, s",containment:"document"})}),jQuery("#spbcscan-results-log-module").resizable({handles:"n, s",containment:"document"}),jQuery("#spbc_scanner_clear").on("click",function(){confirm("Do you confirm to clear the scan results?")&&(console.log("CLEAR"),spbcSendAJAXRequest({action:"spbc_scanner_clear"},{type:"GET",successCallback:function(){document.location=document.location},complete:null,errorOutput:null,context:this,timeout:4e4,success:function(){document.location.reload()}}))}),jQuery("#spbc_scanner_save_to_pdf").on("click",function(){jQuery.ajax({url:spbcSettings.ajaxurl,type:"POST",data:{action:"spbc_scanner_save_to_pdf",security:spbcSettings.ajax_nonce,no_cache:Math.random()},xhrFields:{responseType:"blob"},success:function(n){jQuery.ajax({url:spbcSettings.ajaxurl,type:"POST",data:{action:"spbc_scanner_get_pdf_file_name",security:spbcSettings.ajax_nonce,no_cache:Math.random()},xhrFields:{responseType:"text"},success:function(e){var o=new Blob([n]),t=document.createElement("a");t.href=window.URL.createObjectURL(o),t.download=e.data,t.click()}})}})})});
//# sourceMappingURL=spbc-settings_tab--scanner.min.js.map
