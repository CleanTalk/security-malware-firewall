function spbc_popup_tip___show(e){var t=e.attr("spbc_tip_title")||null,s=e.attr("spbc_tip_text")||null;function o(e){void 0!==e&&(0!=jQuery(e.target).parent(".spbc_popup_tip--wrapper").length&&!jQuery(e.target).hasClass("spbc_popup_tip--icon---cancel")||jQuery(e.target).hasClass("spbc_popup_tip--icon---show"))||(jQuery(".spbc_popup_tip--wrapper").hide(),jQuery(document).off("click",o))}o(),e.after("<div class='spbc_popup_tip--wrapper'></div>");var n=jQuery(".spbc_popup_tip--wrapper");n.empty().append("<div class='spbc_popup_tip--angle'></div>").css({top:e.position().top-2,left:e.position().left+25}),n.append("<i class='spbc_popup_tip--icon---cancel icon-cancel'></i>").append("<h3 class='spbc_popup_tip--title'>"+t+"</h3>").append("<p class='spbc_popup_tip--text'>"+s+"</p>"),jQuery(document).on("click",o),e.parents("tr").on("mouseout",o)}function spbc_scanner_button_file_view_event(e){var e=jQuery(e),t={action:"spbc_scanner_file_view",file_id:e.parents(".row-actions").attr("uid")},e={spinner:e.parent().siblings(".tbl-preloader--tiny"),callback:spbc_scannerButtonView_callback,errorOutput:function(e){spbcModal.open().putError(e)}};spbcSendAJAXRequest(t,e)}function spbc_scanner_analysis_log_delete_from_log(e){let s=[];var t=jQuery(e);let o;if(jQuery(e).hasClass("tbl-row_action"))s.push(t.parents(".row-actions").attr("uid")),o=t.parent().siblings(".tbl-preloader--tiny");else{e=t.closest("#spbc_tbl__scanner_analysis_log").find(".cb-select:checked");if(0===e.length)return void alert("Please, select elements.");e.each(function(e,t){t=jQuery(t).val();s.push(t)}),o=t.children(".tbl-preloader--small")}e={action:"spbc_scanner_analysis_log_delete_from_log",file_ids:s},t={spinner:o,callback:function(){window.location.reload()}};spbcSendAJAXRequest(e,t)}function spbc_scanner_button_page_view_event(e){var e=jQuery(e),t={action:"spbc_scanner_page_view",page_url:e.parents(".row-actions").attr("uid")},e={spinner:e.parent().siblings(".tbl-preloader--tiny"),callback:spbc_scannerButtonView_callback,errorOutput:function(e){spbcModal.open().putError(e)}},s=jQuery("#wpwrap"),o=jQuery("#spbc_dialog"),n=(o.dialog({modal:!0,title:"Loading..",position:{my:"center top",at:"center top+100px",of:window},width:s.width()/100*90,show:{effect:"blind",duration:500},draggable:!1,resizable:!1,closeText:"X",classes:{"ui-dialog":"spbc---top"},open:function(e,t){e.target.style.overflow="auto",jQuery("#spbc_dialog").height(document.documentElement.clientHeight/100*25)},beforeClose:function(e,t){document.body.style.overflow="auto",jQuery("#spbc_dialog").empty()}}),o.append('<img id="spbc_file_view_preloader" alt="Wait for downloading" class="spbc_preloader" src="../../wp-content/plugins/security-malware-firewall/images/preloader2.gif" style="display: block; position: absolute; ">'),jQuery("#spbc_file_view_preloader")),s=4e-4*s.width();n.height(128*s),n.width(128*s),n.css({left:o.width()/2-128*s/2}),n.css({top:o.height()/2-128*s/2}),spbcSendAJAXRequest(t,e)}function spbc_scannerButtonView_callback(e){var t,s=jQuery("#spbc_dialog");s.empty(),jQuery("#spbc_file_view_preloader").css({display:"none"});for(t in e.file)s.append('<div class="spbc_view_file_row_wrapper"><span class="spbc_view_file_row_num">%s</span><p class="spbc_view_file_row">%s</p><br /></div>'.printf(t,e.file[t]));var o=19*Object.keys(e.file).length<76?76:19*Object.keys(e.file).length,n=document.documentElement.clientHeight/100*75;let a=o<n?"hidden":"scroll",c="scroll"==a?n:o;s.css({height:c,overflow:a}),s.dialog({modal:!0,title:"Loaded: "+e.file_path,position:{my:"center top",at:"center top+100px",of:window},width:jQuery("#wpwrap").width()/100*90,show:{effect:"blind",duration:500},draggable:!0,resizable:!1,height:c,closeText:"X",classes:{"ui-dialog":"spbc---top"},open:function(e,t){e.target.style.overflow=a,jQuery("#spbc_dialog").height(c),jQuery(".ui-widget-overlay").on("click",function(){jQuery("#spbc_dialog").dialog("close")})},beforeClose:function(e,t){document.body.style.overflow="auto",jQuery("#spbc_dialog").empty()}}),console.log("FILE_VIEWED")}function spbc_scanner_button_file_view_bad_event(e){var e=jQuery(e),t={action:"spbc_scanner_file_view",file_id:e.parents(".row-actions").attr("uid")},e={spinner:e.parent().siblings(".tbl-preloader--tiny"),callback:spbc_scannerButtonViewBadFile_callback,errorOutput:function(e){spbcModal.open().putError(e)}};spbcSendAJAXRequest(t,e)}function spbc_scanner_button_page_view_bad_event(e){var e=jQuery(e),t={action:"spbc_scanner_page_view",page_url:e.parent().attr("uid")},e={spinner:e.parent().siblings(".tbl-preloader--tiny"),callback:spbc_scannerButtonViewBad_callback,errorOutput:function(e){spbcModal.open().putError(e)}};spbcSendAJAXRequest(t,e)}function spbc_scannerButtonViewBadFile_callback(t,e,s){console.log("FILE_VIEWED_BAD_CODE_FILE"),console.log(arguments),jQuery("#spbc_dialog").empty();var o,n,a,c='<div class="spbc_view_file_row_wrapper"><span class="spbc_view_file_row_num">%s</span><p class="spbc_view_file_row">%s</p><br /></div>',i=[],r=[];for(n in t.weak_spots=JSON.parse(t.weak_spots),t.weak_spots)i[n]=Object.keys(t.weak_spots[n]);for(key in o=Object.keys(i).sort())r[o[key]]=i[o[key]];for(a in r){var l,p="spbc-dialog-row-header-"+a.toLowerCase(),_='<span id="'+p+'" style="text-align: center"><b>'+a+" weakspots:</b></span>",d=jQuery("#spbc_dialog"),_=(d.append(c.printf("",_)),d.append(c.printf("<b>...</b>","<b>...</b>")),d.find("#"+p));for(l in _.parent().parent().css("text-align","center"),_.parent().parent().css("border","1px dotted"),_.parent().parent().css("background","darkgrey"),i[a]){l=[...new Set(l)].sort();var u=+i[a][l];for(let e=u-2;e<=2+u;e++)void 0!==t.file[e]&&d.append((u===e?'<div class="spbc_view_file_row_wrapper" style="background: rgba(200,40,40,0.8);"><span class="spbc_view_file_row_num">%s</span><p class="spbc_view_file_row">%s</p><br /></div>':c).printf(e,t.file[e]));d.append(c.printf("<b>...</b>","<b>...</b>"))}}jQuery("#spbc_dialog div").last().remove();var b=19*jQuery("#spbc_dialog div").length<76?76:19*jQuery("#spbc_dialog div").length,f=document.documentElement.clientHeight/100*75;let g=b<f?"no_scroll":"scroll",y="scroll"==g?f:b;jQuery("#spbc_dialog").dialog({modal:!0,title:t.file_path,position:{my:"center top",at:"center top+100px",of:window},width:jQuery("#wpwrap").width()/100*90,show:{effect:"blind",duration:500},draggable:!0,resizable:!1,closeText:"X",classes:{"ui-dialog":"spbc---top"},open:function(e,t){e.target.style.overflow=g,jQuery("#spbc_dialog").height(y),jQuery(".ui-widget-overlay").on("click",function(){jQuery("#spbc_dialog").dialog("close")})},beforeClose:function(e,t){document.body.style.overflow="auto",jQuery("#spbc_dialog").empty()}})}function spbc_scannerButtonViewBad_callback(n,e,t){console.log("FILE_VIEWED_BAD_CODE"),console.log(arguments);let s=()=>{};if(1==n.success){console.log(n);var a,c='<div class="spbc_view_file_row_wrapper"><span class="spbc_view_file_row_num">%s</span><p class="spbc_view_file_row" style="word-break: break-all">%s</p><br /></div>';let o=[];for(a in n.weak_spots=JSON.parse(n.weak_spots),n.weak_spots)o=o.concat(Object.keys(n.weak_spots[a]));o=[...new Set(o)].sort();var i,r=new Map(Object.entries(n.weak_spots.CRITICAL));for(i in o)if(0!=i||!r.get(o[i]).toLowerCase().includes("doctype")){var l=+o[i];for(let s=l-2;s<=2+l;s++)if(void 0!==n.file[s]){var p=l===s;let e,t;e=p?'<div class="spbc_view_file_row_wrapper" style="background: rgb(200,120,120);"><span class="spbc_view_file_row_num">%s</span><p class="spbc_view_file_row" style="word-break: break-all">%s</p><br /></div>':c,t=p&&!n.file[s].includes("iframe")?e.printf(s,r.get(o[i])):e.printf(s,n.file[s]),jQuery("#spbc_dialog").append(t)}jQuery("#spbc_dialog").append(c.printf("","")),jQuery("#spbc_dialog div").last().remove()}}else jQuery("#spbc_dialog").append('<div style="margin:40px;text-align:center;">%s</div>'.printf(n.content)),s=()=>{document.location.reload()};var o=19*jQuery("#spbc_dialog div").length<76?76:19*jQuery("#spbc_dialog div").length,_=document.documentElement.clientHeight/100*75;let d=o<_?"no_scroll":"scroll";jQuery("#spbc_dialog").dialog({modal:!0,title:n.file_path,position:{my:"center top",at:"center top+100px",of:window},width:jQuery("#wpwrap").width()/100*90,show:{effect:"blind",duration:500},draggable:!0,resizable:!1,closeText:"X",classes:{"ui-dialog":"spbc---top"},open:function(e,t){e.target.style.overflow=d,jQuery("#spbc_dialog").height("auto"),jQuery(".ui-widget-overlay").on("click",function(){jQuery("#spbc_dialog").dialog("close")})},beforeClose:function(e,t){document.body.style.overflow="auto",jQuery("#spbc_dialog").empty()},close:s})}function spbc_scanner_button_file_compare_event(e){var e=jQuery(e),t={action:"spbc_scanner_file_compare",file_id:e.parents(".row-actions").attr("uid")},e={spinner:e.parent().siblings(".tbl-preloader--tiny"),callback:spbc_scannerButtonFileCompare_callback,errorOutput:function(e){spbcModal.open().putError(e)}};spbcSendAJAXRequest(t,e)}function spbc_scannerButtonFileCompare_callback(s,e,t){console.log("FILE_COMPARED");var o='<div class="spbc_compare_file_row_wrapper"><p class="spbc_compare_file_row">%s</p><span class="spbc_compare_file_row_num">%s</span><p class="spbc_compare_file_row">%s</p><br /></div>';jQuery("#spbc_dialog").append(o.printf('<span class="spbc_compare_file_headings">Modified</span>',"Line",'<span class="spbc_compare_file_headings">Original</span>'));for(let t=1;void 0!==s.file[t]||void 0!==s.file_original[t];t++)if(void 0===s.file[t]&&(s.file[t]=""),void 0===s.file_original[t]&&(s.file_original[t]=""),-1!=s.difference.indexOf(t)){for(let e=t-2;e<=t+2;e++)void 0!==s.file[e]&&void 0!==s.file_original[t]&&jQuery("#spbc_dialog").append((t===e?'<div class="spbc_compare_file_row_wrapper" style="background: rgba(200,40,40,0.8);"><p class="spbc_compare_file_row">%s</p><span class="spbc_compare_file_row_num">%s</span><p class="spbc_compare_file_row">%s</p><br /></div>':o).printf(s.file[e]||"",e,s.file_original[e]||""));jQuery("#spbc_dialog").append(o.printf("","",""))}var n=19*jQuery("#spbc_dialog div").length+19,a=document.documentElement.clientHeight/100*75;let c=n<a?"no_scroll":"scroll",i="scroll"==c?a:n;jQuery("#spbc_dialog").dialog({modal:!0,title:s.file_path,position:{my:"center top",at:"center top+100px",of:window},width:jQuery("#wpwrap").width()/100*90,height:i,show:{effect:"blind",duration:500},draggable:!0,resizable:!0,closeText:"X",classes:{"ui-dialog":"spbc---top"},open:function(e,t){document.body.style.overflow="hidden",e.target.style.overflow=c,jQuery("#spbc_dialog").height(i)},beforeClose:function(e,t){document.body.style.overflow="auto",jQuery("#spbc_dialog").empty()}})}function spbc_scanner__reload_scan_info(){jQuery(".spbc_hint__last_scan_title").text(spbcScaner.look_below_for_scan_res);spbcSendAJAXRequest({action:"spbc_scanner__last_scan_info"},{callback:e=>{document.getElementById("spbc_scanner__last_scan_info").innerText=e.data}})}function spbc_scanner_file_monitoring_show_current_snapshot(e){var e=jQuery(e),t=e.parents(".row-actions").attr("uid");const s=e.closest(".column-path").find(".title").text(),o=jQuery("[data-remodal-id=spbc-file-monitoring-modal]");o.remodal().open();e={action:"spbc_file_monitoring_show_snapshots",file_id:t,security:spbcSettings.ajax_nonce};jQuery.ajax({type:"POST",async:!0,url:spbcSettings.ajaxurl,data:e,success:function(e){e.success&&(o.find("#spbc-fm-snapshot-list ul").remove(),o.find("#spbc-fm-snapshot-file-name").text(s),drawSnapshotList(e.data,o),drawCurrentSnapshot(e.data[0].id,o))}})}function drawSnapshotList(e,t){let s="";for(var o of e)s+=`<li data-spanshot-id="${o.id}">${o.created_at}</li>`;e=`<ul>
            ${s}
        </ul>`;t.find("#spbc-fm-snapshot-list").append(e)}function drawCurrentSnapshot(t,s){var e={action:"spbc_file_monitoring_show_current_snapshot",snapshot_id:t,security:spbcSettings.ajax_nonce};jQuery.ajax({type:"POST",async:!0,url:spbcSettings.ajaxurl,data:e,beforeSend:function(){jQuery("#spbc-file-monitoring-modal-preloader").show()},success:function(e){e.success&&(s.find("#spbc-fm-snapshot-view .wrap").remove(),s.find("[data-spanshot-id").removeClass("active"),s.find("[data-spanshot-id="+t+"]").addClass("active"),e=`<div class="wrap">
                        <pre>
                            <code>
                                ${e.data.content}
                            </code>
                        </pre>
                    </div>`,jQuery("#spbc-file-monitoring-modal-preloader").hide(),s.find("#spbc-fm-snapshot-view").append(e),document.querySelectorAll("pre code").forEach(e=>{hljs.highlightElement(e)}))}})}function spbc_scanner_button_cure_file_ajax_handler(e){e={action:"spbc_file_cure_ajax_action",file_fast_hash:jQuery(e).parents(".row-actions").attr("uid"),security:spbcSettings.ajax_nonce};jQuery.ajax({type:"POST",async:!0,url:spbcSettings.ajaxurl,data:e,success:function(e){e.success?(spbcModal.open().put(e.data),document.addEventListener("spbcModalClosed",function(e){document.location.reload()})):spbcModal.open().putError(e.data)}})}function spbc_scanner_button_restore_from_backup_ajax_handler(e){e={action:"spbc_restore_file_from_backup_ajax_action",file_fast_hash:jQuery(e).parents(".row-actions").attr("uid"),security:spbcSettings.ajax_nonce};jQuery.ajax({type:"POST",async:!0,url:spbcSettings.ajaxurl,data:e,success:function(e){e.success?(spbcModal.open().put(e.data),document.addEventListener("spbcModalClosed",function(e){document.location.reload()})):spbcModal.open().putError(e.data)}})}function spbc_scanner_button_clear_scan_results(){confirm("Do you confirm to clear the scan results?")&&(console.log("CLEAR"),spbcSendAJAXRequest({action:"spbc_scanner_clear"},{type:"GET",successCallback:function(){document.location=document.location},complete:null,errorOutput:null,context:this,timeout:4e4,success:function(){document.location.reload()}}))}function spbctAutoAnalysisNoticeAgree(){clearTimeout(spbctAutoAnalysisNoticeClosingTimeout),spbcModal.close()}function spbctAutoAnalysisNoticeDisagree(){clearTimeout(spbctAutoAnalysisNoticeClosingTimeout);var e=document.getElementById("spbc_modal_button_disagree");spbcSendAJAXRequest({action:"spbc_scanner__disable_automatically_analysis"},{button:e,callback:()=>{spbcModal.close()}})}jQuery(document).ready(function(){spbcTblBulkActionsListen(),spbcTblRowActionsListen(),spbcTblPaginationListen(),spbcTblSortListen(),spbcStartShowHide(),jQuery("#spbc_scaner_progress_bar").progressbar({value:0,create:function(e,t){e.target.style.position="relative",e.target.style.marginBottom="12px"},change:function(e,t){jQuery(".spbc_progressbar_counter span").text(jQuery(e.target).progressbar("option","value")+" %")}}),jQuery("#spbc_scan_accordion").accordion({header:"h3",heightStyle:"content",collapsible:!0,active:!1,activate:function(e,t){0===t.oldPanel.length&&0===t.oldHeader.length&&jQuery("#spbc_scan_accordion").accordion("option","classes.ui-accordion-content","ui-corner-bottom spbc-overflow--visible")},beforeActivate:function(e,t){1===t.oldPanel.length&&1===t.oldHeader.length&&jQuery("#spbc_scan_accordion").accordion("option","classes.ui-accordion-content","ui-corner-bottom")}}),window.spbcScanner=new spbcMalwareScanner({settings:spbcScaner.settings,states:spbcScaner.states,button:jQuery("#spbc_perform_scan"),spinner:jQuery("#spbc_perform_scan").next(),callback:null,progress_overall:jQuery("#spbc_scaner_progress_overall"),progressbar:jQuery("#spbc_scaner_progress_bar"),progressbar_text:jQuery(".spbc_progressbar_counter span"),wrapper:document.getElementsByClassName("spbc_unchecked_file_list"),warnings:{long_scan:jQuery(".spbc_hint_warning__long_scan"),outdated:jQuery(".spbc_hint_warning__outdated")}}),jQuery(document).on("click",".spbc_popup_tip--icon---show",function(){spbc_popup_tip___show(jQuery(this))}),jQuery("#spbc_perform_scan").on("click",function(){jQuery("#spbcscan-results-log-module").remove(),spbcScanner.actionControl(),jQuery(".spbc_log-wrapper .panel-body").length||jQuery(".spbc_log-wrapper").append('<div class="panel-body"></div>'),jQuery(".spbc_log-wrapper").resizable({handles:"n, s",containment:"document"})}),jQuery("#spbcscan-results-log-module").resizable({handles:"n, s",containment:"document"}),jQuery("#spbc_scanner_clear").on("click",function(){confirm("Do you confirm to clear the scan results?")&&(console.log("CLEAR"),spbcSendAJAXRequest({action:"spbc_scanner_clear"},{type:"GET",successCallback:function(){document.location=document.location},complete:null,errorOutput:null,context:this,timeout:4e4,success:function(){document.location.reload()}}))}),jQuery("#spbc_scanner_save_to_pdf").on("click",function(){jQuery.ajax({url:spbcSettings.ajaxurl,type:"POST",data:{action:"spbc_scanner_save_to_pdf",security:spbcSettings.ajax_nonce,no_cache:Math.random()},xhrFields:{responseType:"blob"},success:function(o){jQuery.ajax({url:spbcSettings.ajaxurl,type:"POST",data:{action:"spbc_scanner_get_pdf_file_name",security:spbcSettings.ajax_nonce,no_cache:Math.random()},xhrFields:{responseType:"text"},success:function(e){var t=new Blob([o]),s=document.createElement("a");s.href=window.URL.createObjectURL(t),s.download=e.data,s.click()}})}})}),jQuery(document).on("click",".spbc-fm-snapshot-list [data-spanshot-id]",function(){var e=jQuery(this).data("spanshot-id");e!==jQuery(".spbc-fm-snapshot-list [data-spanshot-id].active").data("spanshot-id")&&drawCurrentSnapshot(e,jQuery("[data-remodal-id=spbc-file-monitoring-modal]"))});let e=!1;addEventListener("spbctAutoAnalysisNotice",()=>{e||(e=!0,spbctAutoAnalysisNoticeClosingTimeout=setTimeout(()=>{spbcModal.close()},1e4),spbcModal.open().put('<div><a href="options-general.php?page=spbc&spbc_tab=settings_general#spbc_setting_scanner__heuristic_analysis" target="_blank">Automatically send suspicious files for Cloud analysis</a> option is on `auto` mode.<br>Suspicious files will be sent to the CleanTalk Cloud analysis automatically.<br><br></div><div style="text-align:right"><button class="spbc_manual_link" id="spbc_modal_button_agree" onclick="spbctAutoAnalysisNoticeAgree();">Agree</button> <button class="spbc_manual_link" id="spbc_modal_button_disagree" onclick="spbctAutoAnalysisNoticeDisagree();">I don\'t want to send them to the analysis</button></div>'))})});
//# sourceMappingURL=spbc-settings_tab--scanner.min.js.map
