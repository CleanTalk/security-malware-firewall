{"version":3,"file":"spbc-scanner-plugin.min.js","sources":["spbc-scanner-plugin.js"],"sourcesContent":["'use strict';\n\n/**\n * class SpbcMalwareScanner\n */\nclass SpbcMalwareScanner {/* eslint-disable-line no-unused-vars */\n    first_start = true;\n\n    active = false;\n\n    root = '';\n    settings = [];\n    states = [\n        'get_cms_hashes',\n        'get_modules_hashes',\n        'clean_results',\n        'file_system_analysis',\n        'get_approved_hashes',\n        'get_denied_hashes',\n        'signature_analysis',\n        'heuristic_analysis',\n        'schedule_send_heuristic_suspicious_files',\n        'auto_cure_backup',\n        'auto_cure',\n        'outbound_links',\n        'frontend_analysis',\n        'important_files_listing',\n        'send_results',\n    ];\n    state = null;\n    offset = 0;\n    amount = 0;\n    amount_coefficient = 1;\n    total_scanned = 0;\n    scan_percent = 0;\n    percent_completed = 0;\n\n    paused = false;\n\n    button = null;\n    spinner = null;\n\n    progress_overall = null;\n    progressbar = null;\n    progressbar_text = null;\n\n    timeout = 60000;\n\n    state_timer = 0;\n\n    /**\n     * constructor\n     * @param {array} properties\n     */\n    constructor( properties ) {\n        console.log('init');\n        if (jQuery('#spbcscan-results-log-module').length) {\n            jQuery('.spbc-scan-log-title').removeClass('spbc---hidden');\n        }\n\n        // Crunch for cure backups\n        if ( typeof properties['settings']['auto_cure'] !== 'undefined' ) {\n            properties['settings']['scanner__auto_cure_backup'] = '1';\n        }\n\n        for ( let key in properties ) {\n            if ( typeof this[key] !== 'undefined' ) {\n                this[key] = properties[key];\n            }\n        }\n    };\n\n    /**\n     * Function Action Control\n     */\n    actionControl() {\n        if (this.state === null) {\n            this.start();\n        } else if (this.paused) {\n            this.resume();\n            this.controller();\n        } else {\n            this.pause();\n        }\n    };\n\n    /**\n     * Function Start\n     */\n    start() {\n        this.active = true;\n        this.state_timer = Math.round(new Date().getTime() /1000);\n\n        this.state = this.getNextState( null );\n\n        this.setPercents( 0 );\n        this.scan_percent = 0;\n        this.offset = 0;\n        this.progress_overall.children('span')\n            .removeClass('spbc_bold')\n            .filter('.spbc_overall_scan_status_' + this.state)\n            .addClass('spbc_bold');\n\n        this.progressbar.show(500);\n        this.progress_overall.show(500);\n        this.button.html(spbcScaner.button_scan_pause);\n        this.spinner.css({display: 'inline'});\n\n        setTimeout(() => {\n            this.controller();\n        }, 1000);\n    };\n\n    /**\n     * Function Pause\n     * @param {*} result\n     * @param {*} data\n     * @param {*} opt\n     */\n    pause( result, data, opt ) {\n        console.log('PAUSE');\n        this.button.html(spbcScaner.button_scan_resume);\n        this.spinner.css({display: 'none'});\n        this.paused = true;\n        this.active = false;\n    };\n\n    /**\n     * Function Resume\n     * @param {*} opt\n     */\n    resume( opt ) {\n        console.log('RESUME');\n        this.button.html(spbcScaner.button_scan_pause);\n        this.spinner.css({display: 'inline'});\n        this.paused = false;\n        this.active = true;\n    };\n\n    /**\n     * Function End\n     * @param {bool} reload\n     */\n    end( reload ) {\n        this.progressbar.hide(500);\n        this.progress_overall.hide(500);\n        this.button.html(spbcScaner.button_scan_perform);\n        this.spinner.css({display: 'none'});\n        this.state = null;\n        this.plug = false;\n        this.total_scanned = 0;\n        this.active = false;\n\n        if (reload) {\n            document.location = document.location;\n        } else {\n            spbcSendAJAXRequest(\n                {action: 'spbc_scanner_tab__reload_accordion'},\n                {\n                    notJson: true,\n                    callback: function(result, data, params, obj) {\n                        jQuery(obj).accordion('destroy')\n                            .html(result)\n                            .accordion({\n                                header: 'h3',\n                                heightStyle: 'content',\n                                collapsible: true,\n                                active: false,\n                            });\n                        spbcTblBulkActionsListen();\n                        spbcTblRowActionsListen();\n                        spbcTblPaginationListen();\n                        spbcTblSortListen();\n                        spbcStartShowHide();\n                        spbcScannerReloadScanInfo();\n                    },\n                },\n                jQuery('#spbc_scan_accordion'),\n            );\n\n            if (!jQuery('#spbc_scanner_clear').length) {\n                let clearLink = '<p id=\"spbc_scanner_clear\" ' +\n                    'class=\"spbc_hint spbc_hint-send_security_log spbc_hint--link spbc_hint--top_right\" ' +\n                    'onclick=\"spbcScannerButtonClearScanResults()\">Clear scanner logs</p><br>';\n                jQuery(clearLink).insertBefore('#spbcscan-scanner-caption');\n            }\n        }\n    };\n\n    /**\n     * Function Controller\n     * @param {obj} result\n     */\n    controller( result ) {\n        console.log(this.state);\n\n        // The current stage is over. Switching to the new one\n        if ( typeof result !== 'undefined' && result.end ) {\n            this.state = this.getNextState( this.state );\n\n            // End condition\n            if (typeof this.state === 'undefined') {\n                this.end();\n                return;\n            }\n\n            // Set percent to 0\n            this.setPercents( 0 );\n            this.scan_percent = 0;\n            this.offset = 0;\n\n            // Changing visualizing of the current stage\n            this.progress_overall.children('span')\n                .removeClass('spbc_bold')\n                .filter('.spbc_overall_scan_status_' + this.state)\n                .addClass('spbc_bold');\n        }\n\n        // Break execution if paused\n        if ( this.paused === true ) {\n            return;\n        }\n\n        // // AJAX params\n        let data = {\n            action: 'spbc_scanner_controller_front',\n            method: this.state,\n            offset: this.offset,\n        };\n\n        let params = {\n            type: 'GET',\n            success: this.success,\n            callback: this.successCallback,\n            error: this.error,\n            errorOutput: this.errorOutput,\n            complete: null,\n            context: this,\n            timeout: 120000,\n        };\n\n        switch (this.state) {\n        case 'get_modules_hashes': this.amount = 2; break;\n        case 'clear_table': this.amount = 10000; break;\n        case 'file_system_analysis': this.amount = 700; break;\n        case 'auto_cure': this.amount = 5; break;\n        case 'outbound_links': this.amount = 10; break;\n        case 'frontend_analysis': this.amount = spbcSettings.frontendAnalysisAmount; break;\n        case 'signature_analysis': this.amount = 10; data.status = 'UNKNOWN,MODIFIED,OK,INFECTED,ERROR'; break;\n        case 'heuristic_analysis': this.amount = 4; data.status = 'UNKNOWN,MODIFIED,OK,INFECTED,ERROR'; break;\n        case 'schedule_send_heuristic_suspicious_files': this.amount = 1; break;\n        }\n\n        data.amount = Math.round(this.amount * this.amount_coefficient);\n\n        spbcSendAJAXRequest(\n            data,\n            params,\n            jQuery('#spbc_scan_accordion'),\n        );\n    };\n\n    /**\n     * Set Coefficients\n     * @param {string} state\n     */\n    setCoefficients( state ) {\n        let coefficient = this.amount_coefficient;\n        switch (state) {\n        case 'file_system_analysis': coefficient *= 1.5; break;\n        }\n        this.amount_coefficient = coefficient;\n    };\n\n    /**\n     * Get Next State\n     * @param {string} state\n     * @return {number}\n     */\n    getNextState( state ) {\n        state = state === null ? this.states[0] : this.states[this.states.indexOf( state ) + 1];\n\n        if (typeof this.settings['scanner__' + state] !== 'undefined' && +this.settings['scanner__' + state] === 0) {\n            state = this.getNextState( state );\n        }\n\n        return state;\n    };\n\n    /**\n     * Set Percents\n     * @param {number} percents\n     */\n    setPercents( percents ) {\n        this.percent_completed = Math.floor( percents * 100 ) / 100;\n        this.progressbar.progressbar( 'option', 'value', this.percent_completed );\n        this.progressbar_text.text( spbcScaner['progressbar_' + this.state] + ' - ' + this.percent_completed + '%' );\n    };\n\n    /**\n     * Function Success\n     * @param {obj} response\n     */\n    success( response ) {\n        if ( !! response.error ) {\n            this.error(\n                {status: 200, responseText: response.error},\n                response.error,\n                response.msg,\n            );\n        } else {\n            if ( this.successCallback ) {\n                this.successCallback( response, this.data, this.obj );\n            }\n        }\n    };\n\n    // Processing response from backend\n    /**\n     * Success Callback\n     * @param {obj} result\n     */\n    successCallback( result ) {\n        console.log( result );\n\n        if ( typeof result.total !== 'undefined' ) {\n            this.scan_percent = 100 / result.total;\n        }\n\n        if ( typeof result.processed_items !== 'undefined') {\n            if ( this.state === 'heuristic_analysis' && typeof result.total !== 0 ) {\n                this.logRaw('<h3 class=\"spbc_log-block_header\">Heuristic Analysis</h3>');\n            }\n            if ( this.state === 'signature_analysis' && typeof result.total !== 0 ) {\n                this.logRaw('<h3 class=\"spbc_log-block_header\">Signature Analysis</h3>');\n            }\n\n            this.logFileEntry( result.processed_items );\n        }\n\n        if ( typeof result.stage_data_for_logging !== 'undefined') {\n            this.logStageEntry( result.stage_data_for_logging );\n        }\n\n        // Add link on shuffle salt if cured\n        if (result.cured !== undefined && Number(result.cured) > 0) {\n            this.showLinkForShuffleSalts(result.message);\n        }\n\n        if ( result.end !== true && result.end !== 1 ) {\n            this.setPercents( this.percent_completed + result.processed * this.scan_percent );\n            this.offset = this.offset + result.processed;\n            this.controller( result );\n        } else {\n            console.log( this.state +\n                ' stage took ' +\n                ( Math.round(new Date().getTime() /1000) - this.state_timer ) +\n                ' seconds to complete' );\n            this.state_timer = Math.round(new Date().getTime()/1000);\n            this.setPercents( 100 );\n            this.scan_percent = 0;\n            this.offset = 0;\n            setTimeout(() => {\n                this.controller( result );\n            }, 300);\n        }\n    };\n\n    /**\n     * Function Error\n     * @param {object} xhr\n     * @param {string} status\n     * @param {string} error\n     */\n    error( xhr, status, error ) {\n        let errorOutput = this.errorOutput;\n\n        console.log( '%c APBCT_AJAX_ERROR', 'color: red;' );\n        console.log( status );\n        console.log( error );\n        console.log( xhr );\n\n        if (status == 'error' && (error == '' || error == 'Not found')) {\n            if (!this.tryCount) {\n                this.tryCount = 0;\n                this.retryLimit = 30;\n            }\n            this.tryCount++;\n            console.log('Try #' + this.tryCount);\n            this.setCoefficients(this.state);\n            if (this.tryCount <= this.retryLimit) {\n                this.pause();\n                this.resume();\n                this.controller();\n                return;\n            }\n        }\n\n        if ( xhr.status === 200 ) {\n            if ( status === 'parsererror' ) {\n                errorOutput( 'Unexpected response from server. See console for details.', this.state );\n                console.log( '%c ' + xhr.responseText, 'color: pink;' );\n            } else {\n                let errorString = status;\n                if ( typeof error !== 'undefined' ) {\n                    errorString += ' Additional info: ' + error;\n                }\n                errorOutput( errorString, this.state );\n            }\n        } else if (xhr.status === 500) {\n            errorOutput( 'Internal server error.', this.state);\n        } else {\n            errorOutput('Unexpected response code: ' + xhr.status + '. Error: ' + status, this.state);\n        }\n\n        if ( this.progressbar ) {\n            this.progressbar.fadeOut('slow');\n        }\n\n        this.end();\n    };\n\n    /**\n     * Error Output\n     * @param {string} errorMsg\n     * @param {string} stage\n     */\n    errorOutput( errorMsg, stage ) {\n        spbcModal.open().putError( errorMsg + '<br>Stage: ' + stage);\n    };\n\n    /**\n     * Log Raw\n     * @param {htmlString|Element|Text|Array|jQuery} messageToLog\n     */\n    logRaw(messageToLog) {\n        jQuery('.spbc-scan-log-title').removeClass('spbc---hidden');\n        jQuery('.spbc_log-wrapper').removeClass('spbc---hidden');\n        jQuery('.spbc_log-wrapper .panel-body').prepend( messageToLog );\n    };\n\n    /**\n     * Log File Entry\n     * @param {array} items\n     */\n    logFileEntry(items) {\n        for ( let key in items ) {\n            if ( key ) {\n                this.logRaw(\n                    '<p class=\"spbc_log-line\">' +\n                    this.getSiteUTCShiftedTimeString() + ' - ' +\n                    items[key].path + ' - ' + items[key].module +\n                    '<b>: ' + items[key].status + '</b>' +\n                    '</p>');\n            }\n        }\n    };\n\n    /**\n     * Log Stage Entry\n     * @param {obj} data\n     */\n    logStageEntry(data) {\n        if (typeof jQuery('.panel-body  .spbc_log-line span').first() !== 'undefined' &&\n            typeof jQuery('.panel-body  .spbc_log-line span').first()[0] !== 'undefined' &&\n            jQuery('.panel-body  .spbc_log-line span').first()[0].textContent === data.description\n        ) {\n            return;\n        }\n        this.logRaw( '<p class=\"spbc_log-line\">test ' +\n            this.getSiteUTCShiftedTimeString() + ' - ' + '<b>' +\n            data.title + '</b> ' + '<span>' + data.description + '</span></p>' );\n    };\n\n    /**\n     * Show Link For Shuffle Salts\n     * @param {string} message\n     */\n    showLinkForShuffleSalts(message) {\n        jQuery('#spbc_notice_about_shuffle_link').remove();\n        jQuery(jQuery('.spbc_tab--active .spbc_wrapper_field p')[1])\n            .after(\n                '<div style=\"text-align: center;\" id=\"spbc_notice_about_shuffle_link\">' +\n                '<a href=\"options-general.php?page=spbc&spbc_tab=settings_general#action-shuffle-salts-wrapper\">' +\n                message +\n                '</a>' +\n                '</div>',\n            );\n    }\n\n    /**\n     * Get Site UTC Shifted Time String\n     * @return {string}\n     */\n    getSiteUTCShiftedTimeString() {\n        let utcShiftedTs = false;\n        // gettings current system/browser offset\n        let currentBrowserOffset = new Date().getTimezoneOffset();\n        currentBrowserOffset = currentBrowserOffset * -1 * 1000 * 60;\n        // chek if global ct object is defined\n        if (typeof spbcScaner !== 'undefined' &&\n            typeof spbcScaner.timezone_shift !== 'undefined' &&\n            spbcScaner.timezone_shift !== false) {\n            utcShiftedTs = Date.now() - currentBrowserOffset + (spbcScaner.timezone_shift * 1000);\n        }\n        let ctDate = utcShiftedTs ? new Date(utcShiftedTs) : new Date();\n        // construct date string\n        let shortMonthName = new Intl.DateTimeFormat('en-US', {month: 'short'}).format;\n        let minutes = String(ctDate.getMinutes()).padStart(2, '0');\n        let seconds = String(ctDate.getSeconds()).padStart(2, '0');\n        return shortMonthName(ctDate) + ' ' +\n            ctDate.getDate() + ' ' + ctDate.getFullYear() + ' ' +\n            ctDate.getHours() + ':' + minutes + ':' + seconds;\n    }\n}\n"],"names":["SpbcMalwareScanner","first_start","active","root","settings","states","state","offset","amount","amount_coefficient","total_scanned","scan_percent","percent_completed","paused","button","spinner","progress_overall","progressbar","progressbar_text","timeout","state_timer","constructor","properties","let","key","console","log","jQuery","length","removeClass","this","actionControl","start","resume","controller","pause","Math","round","Date","getTime","getNextState","setPercents","children","filter","addClass","show","html","spbcScaner","button_scan_pause","css","display","setTimeout","result","data","opt","button_scan_resume","end","reload","hide","button_scan_perform","plug","document","location","spbcSendAJAXRequest","action","notJson","callback","params","obj","accordion","header","heightStyle","collapsible","spbcTblBulkActionsListen","spbcTblRowActionsListen","spbcTblPaginationListen","spbcTblSortListen","spbcStartShowHide","spbcScannerReloadScanInfo","insertBefore","method","type","success","successCallback","error","errorOutput","complete","context","spbcSettings","frontendAnalysisAmount","status","setCoefficients","coefficient","indexOf","percents","floor","text","response","responseText","msg","total","processed_items","logRaw","logFileEntry","stage_data_for_logging","logStageEntry","undefined","cured","Number","showLinkForShuffleSalts","message","processed","xhr","tryCount","retryLimit","errorString","fadeOut","errorMsg","stage","spbcModal","open","putError","messageToLog","prepend","items","getSiteUTCShiftedTimeString","path","module","first","textContent","description","title","remove","after","utcShiftedTs","currentBrowserOffset","getTimezoneOffset","ctDate","timezone_shift","now","shortMonthName","Intl","DateTimeFormat","month","format","minutes","String","getMinutes","padStart","seconds","getSeconds","getDate","getFullYear","getHours"],"mappings":"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"}