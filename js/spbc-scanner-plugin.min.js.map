{"version":3,"file":"spbc-scanner-plugin.min.js","sources":["spbc-scanner-plugin.js"],"sourcesContent":["'use strict';\r\n\r\nclass spbcMalwareScanner{\r\n\r\n\tfirst_start = true;\r\n\r\n\tactive = false;\r\n\r\n\troot  = '';\r\n\tsettings = [];\r\n\tstates = [\r\n\t\t'get_cms_hashes',\r\n\t\t'get_modules_hashes',\r\n\t\t'clean_results',\r\n\t\t'file_system_analysis',\r\n\t\t'get_approved_hashes',\r\n\t\t'get_denied_hashes',\r\n\t\t'signature_analysis',\r\n\t\t'heuristic_analysis',\r\n\t\t'schedule_send_heuristic_critical_files',\r\n\t\t'auto_cure_backup',\r\n\t\t'auto_cure',\r\n\t\t'outbound_links',\r\n\t\t'frontend_analysis',\r\n\t\t'important_files_listing',\r\n\t\t'send_results',\r\n\t];\r\n\tstate = null;\r\n\toffset = 0;\r\n\tamount = 0;\r\n\tamount_coefficient = 1;\r\n\ttotal_scanned = 0;\r\n\tscan_percent = 0;\r\n\tpercent_completed = 0;\r\n\r\n\tpaused = false;\r\n\r\n\tbutton = null;\r\n\tspinner = null;\r\n\r\n\tprogress_overall = null;\r\n\tprogressbar = null;\r\n\tprogressbar_text = null;\r\n\r\n\ttimeout = 60000;\r\n\r\n\tstate_timer = 0;\r\n\r\n\tconstructor ( properties ) {\r\n\r\n\t\tconsole.log('init');\r\n\t\tif (jQuery('#spbcscan-results-log-module').length) {\r\n\t\t\tjQuery('.spbc-scan-log-title').removeClass('spbc---hidden')\r\n\t\t}\r\n\r\n\t\t// Crunch for cure backups\r\n\t\tif( typeof properties['settings']['auto_cure'] !== 'undefined' ){\r\n\t\t\tproperties['settings']['scanner__auto_cure_backup'] = '1';\r\n\t\t}\r\n\r\n\t\tfor( let key in properties ){\r\n\t\t\tif( typeof this[key] !== 'undefined' ){\r\n\t\t\t\tthis[key] = properties[key];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tactionControl(){\r\n\r\n\t\tif(this.state === null){\r\n\t\t\tthis.start();\r\n\r\n\t\t}else if(this.paused){\r\n\t\t\tthis.resume();\r\n\t\t\tthis.controller();\r\n\r\n\t\t}else{\r\n\t\t\tthis.pause();\r\n\t\t}\r\n\t};\r\n\r\n\tstart(){\r\n\r\n\t\tthis.active = true;\r\n\t\tthis.state_timer = Math.round(new Date().getTime() /1000);\r\n\r\n\t\tthis.state = this.getNextState( null );\r\n\r\n\t\tthis.setPercents( 0 );\r\n\t\tthis.scan_percent = 0;\r\n\t\tthis.offset = 0;\r\n\t\tthis.progress_overall.children('span')\r\n\t\t\t.removeClass('spbc_bold')\r\n\t\t\t.filter('.spbc_overall_scan_status_' + this.state)\r\n\t\t\t.addClass('spbc_bold');\r\n\r\n\t\tthis.progressbar.show(500);\r\n\t\tthis.progress_overall.show(500);\r\n\t\tthis.button.html(spbcScaner.button_scan_pause);\r\n\t\tthis.spinner.css({display: 'inline'});\r\n\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.controller();\r\n\t\t}, 1000);\r\n\r\n\t};\r\n\r\n\tpause( result, data, opt ){\r\n\t\tconsole.log('PAUSE');\r\n\t\tthis.button.html(spbcScaner.button_scan_resume);\r\n\t\tthis.spinner.css({display: 'none'});\r\n\t\tthis.paused = true;\r\n\t\tthis.active = false;\r\n\t};\r\n\r\n\tresume( opt ){\r\n\t\tconsole.log('RESUME');\r\n\t\tthis.button.html(spbcScaner.button_scan_pause);\r\n\t\tthis.spinner.css({display: 'inline'});\r\n\t\tthis.paused = false;\r\n\t\tthis.active = true;\r\n\t};\r\n\r\n\tend( reload ){\r\n\r\n\t\tthis.progressbar.hide(500);\r\n\t\tthis.progress_overall.hide(500);\r\n\t\tthis.button.html(spbcScaner.button_scan_perform);\r\n\t\tthis.spinner.css({display: 'none'});\r\n\t\tthis.state = null;\r\n\t\tthis.total_links = 0;\r\n\t\tthis.plug = false;\r\n\t\tthis.total_scanned = 0;\r\n\t\tthis.active = false;\r\n\r\n\t\tif(reload){\r\n\t\t\tdocument.location = document.location;\r\n\t\t}else{\r\n\t\t\tspbc_sendAJAXRequest(\r\n\t\t\t\t{action: 'spbc_scanner_tab__reload_accordion'},\r\n\t\t\t\t{\r\n\t\t\t\t\tnotJson: true,\r\n\t\t\t\t\tcallback: function(result, data, params, obj){\r\n\t\t\t\t\t\tjQuery(obj).accordion('destroy')\r\n\t\t\t\t\t\t\t.html(result)\r\n\t\t\t\t\t\t\t.accordion({\r\n\t\t\t\t\t\t\t\theader: 'h3',\r\n\t\t\t\t\t\t\t\theightStyle: 'content',\r\n\t\t\t\t\t\t\t\tcollapsible: true,\r\n\t\t\t\t\t\t\t\tactive: false,\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\tspbc_tbl__bulk_actions__listen();\r\n\t\t\t\t\t\tspbc_tbl__row_actions__listen();\r\n\t\t\t\t\t\tspbc_tbl__pagination__listen();\r\n\t\t\t\t\t\tspbc_tbl__sort__listen();\r\n\t\t\t\t\t\tspbcStartShowHide();\r\n\t\t\t\t\t\tspbc_scanner__reload_scan_info();\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\tjQuery('#spbc_scan_accordion')\r\n\t\t\t);\r\n\r\n\t\t\tif (!jQuery('#spbc_scanner_clear').length) {\r\n\t\t\t\tlet clear_link = '<p id=\"spbc_scanner_clear\" class=\"spbc_hint spbc_hint-send_security_log spbc_hint--link spbc_hint--top_right\" ' +\r\n\t\t\t\t\t'onclick=\"spbc_scanner_button_clear_scan_results()\">Clear scanner logs</p><br>';\r\n\t\t\t\tjQuery(clear_link).insertBefore('#spbcscan-scanner-caption');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tcontroller( result ) {\r\n\r\n\t\tconsole.log(this.state);\r\n\r\n\t\t// The current stage is over. Switching to the new one\r\n\t\tif( typeof result !== 'undefined' && result.end ){\r\n\r\n\t\t\tthis.state = this.getNextState( this.state );\r\n\r\n\t\t\t// End condition\r\n\t\t\tif (typeof this.state === 'undefined'){\r\n\t\t\t\tthis.end();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Set percent to 0\r\n\t\t\tthis.setPercents( 0 );\r\n\t\t\tthis.scan_percent = 0;\r\n\t\t\tthis.offset = 0;\r\n\r\n\t\t\t// Changing visualizing of the current stage\r\n\t\t\tthis.progress_overall.children('span')\r\n\t\t\t\t.removeClass('spbc_bold')\r\n\t\t\t\t.filter('.spbc_overall_scan_status_' + this.state)\r\n\t\t\t\t.addClass('spbc_bold');\r\n\t\t}\r\n\r\n\t\t// Break execution if paused\r\n\t\tif( this.paused === true )\r\n\t\t\treturn;\r\n\r\n\t\t// // AJAX params\r\n\t\tlet data = {\r\n\t\t\taction: 'spbc_scanner_controller_front',\r\n\t\t\tmethod: this.state,\r\n\t\t\toffset: this.offset,\r\n\t\t};\r\n\r\n\t\tvar params = {\r\n\t\t\ttype:        'GET',\r\n\t\t\tsuccess:     this.success,\r\n\t\t\tcallback:    this.successCallback,\r\n\t\t\terror:       this.error,\r\n\t\t\terrorOutput: this.errorOutput,\r\n\t\t\tcomplete:    null,\r\n\t\t\tcontext:     this,\r\n\t\t\ttimeout:     120000\r\n\t\t};\r\n\r\n\t\tswitch (this.state) {\r\n\t\t\tcase 'get_modules_hashes':   this.amount = 2;        break;\r\n\t\t\tcase 'clear_table':          this.amount = 10000;    break;\r\n\t\t\tcase 'file_system_analysis': this.amount = 700;      break;\r\n\t\t\tcase 'auto_cure':            this.amount = 5;        break;\r\n\t        case 'outbound_links':       this.amount = 10;       break;\r\n\t        case 'frontend_analysis':    this.amount = spbcSettings.frontendAnalysisAmount; break;\r\n\t\t\tcase 'signature_analysis':   this.amount = 10; data.status = 'UNKNOWN,MODIFIED,OK,INFECTED'; break;\r\n\t\t\tcase 'heuristic_analysis':   this.amount = 4;  data.status = 'UNKNOWN,MODIFIED,OK,INFECTED'; break;\r\n\t\t\tcase 'schedule_send_heuristic_critical_files':   this.amount = 1; break;\r\n\t\t}\r\n\r\n\t\tdata.amount = Math.round(this.amount * this.amount_coefficient);\r\n\r\n\t\tspbc_sendAJAXRequest(\r\n\t\t\tdata,\r\n\t\t\tparams,\r\n\t\t\tjQuery('#spbc_scan_accordion')\r\n\t\t);\r\n\r\n\t};\r\n\r\n\tsetCoefficients( state ) {\r\n\t\tlet coefficient = this.amount_coefficient;\r\n\t\tswitch (state) {\r\n\t\t\tcase 'file_system_analysis': coefficient *= 1.5;        break;\r\n\t\t}\r\n\t\tthis.amount_coefficient = coefficient;\r\n\t};\r\n\r\n\tgetNextState( state ) {\r\n\r\n\t\tstate = state === null ? this.states[0] : this.states[ this.states.indexOf( state ) + 1 ];\r\n\r\n\t\tif (typeof this.settings[ 'scanner__' + state ] !== 'undefined' && +this.settings[ 'scanner__' + state ] === 0)\r\n\t\t\tstate = this.getNextState( state );\r\n\r\n\t\treturn state;\r\n\t};\r\n\r\n\tsetPercents( percents ){\r\n\t\tthis.percent_completed = Math.floor( percents * 100 ) / 100;\r\n\t\tthis.progressbar.progressbar( 'option', 'value', this.percent_completed );\r\n\t\tthis.progressbar_text.text( spbcScaner[ 'progressbar_' + this.state ] + ' - ' + this.percent_completed + '%' );\r\n\t};\r\n\r\n\tsuccess( response ){\r\n\r\n\t\tif( !! response.error ){\r\n\r\n\t\t\tthis.error(\r\n\t\t\t\t{status: 200, responseText: response.error},\r\n\t\t\t\tresponse.error,\r\n\t\t\t\tresponse.msg\r\n\t\t\t);\r\n\r\n\t\t}else{\r\n\t\t\tif( this.successCallback )\r\n\t\t\t\tthis.successCallback( response, this.data, this.obj );\r\n\t\t}\r\n\r\n\t};\r\n\r\n\t// Processing response from backend\r\n\tsuccessCallback( result ){\r\n\r\n\t\tconsole.log( result );\r\n\r\n\t\tif( typeof result.total !== 'undefined' )\r\n\t\t\tthis.scan_percent = 100 / result.total;\r\n\r\n\t\tif( typeof result.processed_items !== 'undefined'){\r\n\r\n\t\t\tif( this.state === 'heuristic_analysis' && typeof result.total !== 0 )\r\n\t\t\t\tthis.logRaw('<h3 class=\"spbc_log-block_header\">Heuristic Analysis</h3>');\r\n\t\t\tif( this.state === 'signature_analysis' && typeof result.total !== 0 )\r\n\t\t\t\tthis.logRaw('<h3 class=\"spbc_log-block_header\">Signature Analysis</h3>');\r\n\r\n\t\t\tthis.logFileEntry( result.processed_items );\r\n\t\t}\r\n\r\n\t\tif( typeof result.stage_data_for_logging !== 'undefined'){\r\n\t\t\tthis.logStageEntry( result.stage_data_for_logging );\r\n\t\t}\r\n\r\n\t\t// Add link on shuffle salt if cured\r\n\t\tif (result.cured !== 'undefined' && Number(result.cured) > 0) {\r\n\t\t\tthis.showLinkForShuffleSalts(result.message);\r\n\t\t}\r\n\r\n\t\tif( result.end !== true && result.end !== 1 ){\r\n\t\t\tthis.setPercents( this.percent_completed + result.processed * this.scan_percent );\r\n\t\t\tthis.offset = this.offset + result.processed;\r\n\t\t\tthis.controller( result );\r\n\t\t}else{\r\n\t\t\tconsole.log( this.state + \" stage took \" + ( Math.round(new Date().getTime() /1000) - this.state_timer ) + \" seconds to complete\" );\r\n\t\t\tthis.state_timer = Math.round(new Date().getTime()/1000);\r\n\t\t\tthis.setPercents( 100 );\r\n\t\t\tthis.scan_percent = 0;\r\n\t\t\tthis.offset = 0;\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tthis.controller( result );\r\n\t\t\t}, 300);\r\n\t\t}\r\n\t};\r\n\r\n\terror( xhr, status, error ){\r\n\r\n\t\tlet errorOutput = this.errorOutput;\r\n\r\n\t\tconsole.log( '%c APBCT_AJAX_ERROR', 'color: red;' );\r\n\t\tconsole.log( status );\r\n\t\tconsole.log( error );\r\n\t\tconsole.log( xhr );\r\n\r\n\t\tif (status == 'error' && (error == '' || error == 'Not found')) {\r\n            if (!this.tryCount) {\r\n                this.tryCount = 0;\r\n                this.retryLimit = 30;\r\n            }\r\n\t\t\tthis.tryCount++;\r\n\t\t\tconsole.log('Try #' + this.tryCount);\r\n\t\t\tthis.setCoefficients(this.state);\r\n\t\t\tif (this.tryCount <= this.retryLimit) {\r\n\t\t\t\tthis.pause();\r\n                this.resume();\r\n                this.controller();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif( xhr.status === 200 ){\r\n\t\t\tif( status === 'parsererror' ){\r\n\t\t\t\terrorOutput( 'Unexpected response from server. See console for details.', this.state );\r\n\t\t\t\tconsole.log( '%c ' + xhr.responseText, 'color: pink;' );\r\n\t\t\t}else{\r\n\t\t\t\tlet error_string = status;\r\n\t\t\t\tif( typeof error !== 'undefined' )\r\n\t\t\t\t\terror_string += ' Additional info: ' + error;\r\n\t\t\t\terrorOutput( error_string, this.state );\r\n\t\t\t}\r\n\t\t}else if(xhr.status === 500){\r\n\t\t\terrorOutput( 'Internal server error.', this.state);\r\n\t\t}else\r\n\t\t\terrorOutput('Unexpected response code: ' + xhr.status + '. Error: ' + status, this.state);\r\n\r\n\t\tif( this.progressbar )\r\n\t\t\tthis.progressbar.fadeOut('slow');\r\n\r\n\t\tthis.end();\r\n\t};\r\n\r\n\terrorOutput( error_msg, stage ){\r\n\t\tspbcModal.open().putError( error_msg + '<br>Stage: ' + stage);\r\n\t};\r\n\r\n\tlogRaw(message_to_log ){\r\n\t\tjQuery('.spbc-scan-log-title').removeClass('spbc---hidden');\r\n\t\tjQuery('.spbc_log-wrapper').removeClass('spbc---hidden');\r\n\t\tjQuery('.spbc_log-wrapper .panel-body').prepend( message_to_log );\r\n\t};\r\n\r\n\tlogFileEntry(items){\r\n\t\tfor ( var key in items ){\r\n\t\t\tthis.logRaw( '<p class=\"spbc_log-line\">' + this.getSiteUTCShiftedTimeString() + ' - ' + items[ key ].path + '<b>: ' + items[ key ].status + '</b></p>' );\r\n\t\t}\r\n\t};\r\n\r\n\tlogStageEntry(data){\r\n\t\tthis.logRaw( '<p class=\"spbc_log-line\">' + this.getSiteUTCShiftedTimeString() + ' - ' + '<b>' + data.title + '</b> ' + '<span>' + data.description + '</span></p>' );\r\n\t};\r\n\r\n\tshowLinkForShuffleSalts(message) {\r\n\t\tjQuery('#spbc_notice_about_shuffle_link').remove();\r\n\t\tjQuery(jQuery('.spbc_tab--active .spbc_wrapper_field p')[1])\r\n\t\t\t.after(\r\n\t\t\t\t'<div style=\"text-align: center;\" id=\"spbc_notice_about_shuffle_link\">' +\r\n\t\t\t\t'<a href=\"options-general.php?page=spbc&spbc_tab=settings_general#action-shuffle-salts-wrapper\">' +\r\n\t\t\t\tmessage +\r\n\t\t\t\t'</a>' +\r\n\t\t\t\t'</div>'\r\n\t\t\t);\r\n\t}\r\n\r\n\tgetSiteUTCShiftedTimeString(){\r\n\t\tvar utc_shifted_ts = false;\r\n\t\t//gettings current system/browser offset\r\n\t\tvar current_browser_offset = new Date().getTimezoneOffset();\r\n\t\tcurrent_browser_offset = current_browser_offset * -1 * 1000 * 60;\r\n\t\t//chek if global ct object is defined\r\n\t\tif (typeof spbcScaner !== \"undefined\"\r\n\t\t\t&& typeof spbcScaner.timezone_shift !== \"undefined\"\r\n\t\t\t&& spbcScaner.timezone_shift !== false){\r\n\t\t\tutc_shifted_ts = Date.now() - current_browser_offset + (spbcScaner.timezone_shift * 1000);\r\n\t\t}\r\n\t\tvar ct_date = utc_shifted_ts ? new Date(utc_shifted_ts) : new Date();\r\n\t\t//construct date string\r\n\t\tvar shortMonthName = new Intl.DateTimeFormat(\"en-US\", { month: \"short\" }).format;\r\n\t\tvar minutes = String(ct_date.getMinutes()).padStart(2, '0');\r\n\t\tvar seconds = String(ct_date.getSeconds()).padStart(2, '0');\r\n\t\treturn shortMonthName(ct_date) + ' ' + ct_date.getDate() + ' ' + ct_date.getFullYear() + ' ' + ct_date.getHours() + ':' + minutes + ':' + seconds\r\n\t}\r\n\r\n}\r\n"],"names":["spbcMalwareScanner","first_start","active","root","settings","states","state","offset","amount","amount_coefficient","total_scanned","scan_percent","percent_completed","paused","button","spinner","progress_overall","progressbar","progressbar_text","timeout","state_timer","constructor","properties","let","key","console","log","jQuery","length","removeClass","this","actionControl","start","resume","controller","pause","Math","round","Date","getTime","getNextState","setPercents","children","filter","addClass","show","html","spbcScaner","button_scan_pause","css","display","setTimeout","result","data","opt","button_scan_resume","end","reload","hide","button_scan_perform","total_links","plug","document","location","spbc_sendAJAXRequest","action","notJson","callback","params","obj","accordion","header","heightStyle","collapsible","spbc_tbl__bulk_actions__listen","spbc_tbl__row_actions__listen","spbc_tbl__pagination__listen","spbc_tbl__sort__listen","spbcStartShowHide","spbc_scanner__reload_scan_info","insertBefore","method","type","success","successCallback","error","errorOutput","complete","context","spbcSettings","frontendAnalysisAmount","status","setCoefficients","coefficient","indexOf","percents","floor","text","response","responseText","msg","total","processed_items","logRaw","logFileEntry","stage_data_for_logging","logStageEntry","cured","Number","showLinkForShuffleSalts","message","processed","xhr","tryCount","retryLimit","error_string","fadeOut","error_msg","stage","spbcModal","open","putError","message_to_log","prepend","items","getSiteUTCShiftedTimeString","path","title","description","remove","after","utc_shifted_ts","current_browser_offset","getTimezoneOffset","ct_date","timezone_shift","now","shortMonthName","Intl","DateTimeFormat","month","format","minutes","String","getMinutes","padStart","seconds","getSeconds","getDate","getFullYear","getHours"],"mappings":"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"}