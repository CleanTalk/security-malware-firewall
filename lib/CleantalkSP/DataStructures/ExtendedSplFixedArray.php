<?php


namespace CleantalkSP\DataStructures;

/**
 * Class ExtendedSplFixedArray
 *
 * Extends \SplFixedArray for purposes of heuristic scanner
 *
 * @version 1.0.0
 * @since   2.85
 */
class ExtendedSplFixedArray extends \SplFixedArray
{
	/**
     * Creates new \SplFixedArray from given \Iterable and \Countable object
     *
	 * @param array $array
	 * @param bool  $save_indexes
	 *
	 * @return ExtendedSplFixedArray
	 * @psalm-suppress MixedAssignment
	 */
	public static function fromArray(array $array, $save_indexes = true)
	{
        $self = new self(count($array));
        if($save_indexes) {
            foreach($array as $key => $value) {
                $self[(int) $key] = $value;
            }
        } else {
            $i = 0;
            foreach (array_values($array) as $value) {
                $self[$i] = $value;
                $i++;
            }
        }
        
        return $self;
    }
	
	/**
     * Implementation of native PHP array_column for \SplFixedArray
     *
	 * @param int|string $column_to_get
	 * @param int|string $index_key
	 *
	 * @return array|false
	 */
	public function getColumn( $column_to_get, $index_key = null )
	{
		$index   = -1;
		$out = array();
		
		foreach( $this as $element ){
			
			if( ! isset( $element[ $column_to_get ] ) ){
				
				if( $index_key && ! isset( $element[ $index_key] )){
					return false;
				}
				
				$out[ $index_key ?: $index ] = $element[ $column_to_get ];
			}
		}
		
		return $out;
	}
	
	/**
     * Reduce \SplFixedArray by recalculating size and reindex whole \SplFixedArray
     *
	 * @param \SplFixedArray $splFixedArray
	 *
	 * @return bool
	 */
	public static function reindex( $splFixedArray )
	{
		$new_key = 0;
		
		foreach( $splFixedArray as $key => $value ){
			
			if( $value === null ){
				continue;
			}
			
			if( $new_key !== $key ){
				$splFixedArray[ $new_key ] = $value;
				unset( $splFixedArray[ $key ] );
			}
			
			$new_key++;
		}
		
		// Set new size of \SplFixedArray
		$splFixedArray->setSize( $new_key );
		
		return true;
	}
	
	/**
     * Get slice of the current ExtendedSplFixedArray
     *
	 * @param int $start
	 * @param int $end
	 *
	 * @return array
	 */
	public function slice( $start, $end ){
		
		for(
			$out = array(), $index = $start;
			$index <= $end;
			$index++
		){
			$out[] = $this[ $index ];
		}
		
		return $out;
	}
}