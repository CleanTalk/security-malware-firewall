<?php

namespace CleantalkSP\Common\DB;

class SQLSchema
{
    
    /**
     * Schema table prefix
     */
    private static $schemaTablePrefix = 'spbc_';
    
    /**
     * Preprocess requested scheme name
     * Allows both to use prefix (spbc_) or not
     *
     * @param string $name
     *
     * @return string
     */
    protected static function processSchemaName( $name ){
        return strpos( $name, self::$schemaTablePrefix ) === 0
            ? substr( $name, 5 )
            : $name;
    }
    
    /**
     * Searches and returns schema of all types
     *
     * @param string $table Name of called table
     *
     * @return array      Array of schemas
     * @throws \Exception Throws if calling un-existed schema
     */
    public static function getByName( $table )
    {
        $schemas__all = static::getAll();
        $table        = static::processSchemaName($table);

        if( array_key_exists( $table, $schemas__all ) ) {
            return array( $schemas__all[$table] );
        }

        throw new \Exception( 'Called table scheme not exist.' );
    }


    /**
     * Searches and returns schema of common type
     *
     * @param null|string $table         Name of called table
     * @return array                     Array of schemas
     * @throws \Exception                Throws if calling un-existed schema
     */
    public static function getAllCommon( $table = null )
    {
        return static::$schemas__common;
    }

    /**
     * Searches and returns schema of blog type
     *
     * @param null|string $table         Name of called table
     * @return array                     Array of schemas
     * @throws \Exception                Throws if calling un-existed schema
     */
    public static function getAllBlog( $table = null )
    {
        return static::$schemas__blog;
    }
    
    /**
     * Returns all schemas of all types
     */
    public static function getAll()
    {
        return array_merge(static::$schemas__common, static::$schemas__blog);
    }
}