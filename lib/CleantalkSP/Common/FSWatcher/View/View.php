<?php

namespace CleantalkSP\Common\FSWatcher\View;

use CleantalkSP\Common\FSWatcher\Controller;
use CleantalkSP\Common\FSWatcher\Logger;

class View
{
    public static function renderSelectors()
    {
        $html = '<div class="fswatcher__selectors">';

        $html .= '<label for="fswatcher__first_date">First date</label>';
        $html .= '<select name="fswatcher__first_date" id="fswatcher__first_date">';
        $html .= self::renderSelectorOptions();
        $html .= '</select>';

        $html .= '<br>';
        $html .= '<br>';

        $html .= '<label for="fswatcher__second_date">Second date</label>';
        $html .= '<select name="fswatcher__second_date" id="fswatcher__second_date">';
        $html .= self::renderSelectorOptions();
        $html .= '</select>';

        $html .= '</div>';

        $html .= '<br>';
        $html .= '<br>';

        $html .= '<div class="fswatcher__buttons">';
        $html .= '<button id="fswatcher__compare" onclick="return false;">Compare</button>';
        $html .= '<button id="fswatcher__clear" onclick="return false;">Clear</button>';
        $html .= '</div>';

        $html .= '<script type="text/javascript">';
        $path = __DIR__ . DIRECTORY_SEPARATOR . '..' . DIRECTORY_SEPARATOR . 'Service.php';
        $html .= 'var fswatcherToken = "' . md5(filemtime($path)) . '";';
        $html .= file_get_contents(__DIR__ . '/../assets/fswatcher-compare.js');
        $html .= '</script>';

        return $html;
    }

    private static function renderSelectorOptions()
    {
        $dates = Controller::$repository::getAvailableJournals();

        Logger::log($dates);

        $html = '';
        foreach ($dates as $date) {
            $formated_date = date('Y-m-d H:i:s', $date);
            $html .= '<option value="' . $date . '">' . $formated_date . '</option>';
        }

        return $html;
    }
}