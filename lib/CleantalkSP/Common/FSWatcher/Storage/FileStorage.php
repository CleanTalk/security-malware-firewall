<?php

namespace CleantalkSP\Common\FSWatcher\Storage;

class FileStorage
{
    public static function makeProcessingJournal()
    {
        $journals_path = self::getJournalsPath();
        $path = $journals_path . DIRECTORY_SEPARATOR . time() . '__processing' . '.csv';

        file_put_contents($path, '');
        
        return $path;
    }

    public static function getProcessingJournal()
    {
        $is_processing = glob(self::getJournalsPath() . '*__processing.csv');
        if ( ! empty($is_processing)) {
            return $is_processing[0];
        }

        return null;
    }

    public static function getLastJournal()
    {
        $last_journal = glob(self::getJournalsPath() . '*__complited.csv');
        if ( ! empty($last_journal)) {
            return $last_journal[count($last_journal) - 1];
        }

        return null;
    }

    private static function getJournalsPath()
    {
        $dir_name = __DIR__ . DIRECTORY_SEPARATOR . 'data' . DIRECTORY_SEPARATOR;
        if ( ! is_dir($dir_name)) {
            mkdir($dir_name);
            file_put_contents($dir_name . 'index.php', '<?php' . PHP_EOL);
        }

        return $dir_name;
    }
}