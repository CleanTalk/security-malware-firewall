<?php

namespace CleantalkSP\SpbctWP\Scanner\ScanningStagesLogModule\Stages;

class GetModulesHashes
{
    const TITLE = 'Receiving plugins and themes hashes';
    const DESCRIPTION = 'Receiving plugins and themes hashes and saving to the database';

    private $title;
    private $description;
    private $count_plugins;
    private $count_themes;

//    public static function createTemplateData()
//    {
//        $obj = new self();
//        $obj->title = __($obj::TITLE, 'security-malware-firewall');
//        $obj->description = __($obj::DESCRIPTION, 'security-malware-firewall');
//        $obj->expected_count_hashes = 'ТУТ ЗАПРОС ИЗ ОБЪЕКТА СО ВСЕМИ ДАННЫМИ';
//        $obj->added_count_hashes = 'ТУТ ЗАПРОС ИЗ ОБЪЕКТА СО ВСЕМИ ДАННЫМИ';
//
//        return $obj;
//    }

//    public static function getReadyTemplate()
//    {
//        $data = self::createTemplateData();
//
//        print_r($data);
//    }

    public static function getFormatData($data, $log_data)
    {
        $count_plugins = !empty($data['count_plugins'])
            ? $data['count_plugins']
            : $log_data['get_modules_hashes']['count_plugins'];
        $count_themes = !empty($data['count_themes'])
            ? $data['count_themes']
            : $log_data['get_modules_hashes']['count_themes'];
        $count_plugins_without_hashes = !empty($log_data['get_modules_hashes']['count_plugins_without_hashes'])
            ? $log_data['get_modules_hashes']['count_plugins_without_hashes']
            : 0;
        $count_themes_without_hashes = !empty($log_data['get_modules_hashes']['count_themes_without_hashes'])
            ? $log_data['get_modules_hashes']['count_themes_without_hashes']
            : 0;

        if (!empty($data['count_plugins_without_hashes']) && $data['count_plugins_without_hashes'] !== 'RESET') {
            $count_plugins_without_hashes += $data['count_plugins_without_hashes'];
        }
        if (!empty($data['count_themes_without_hashes']) && $data['count_themes_without_hashes'] !== 'RESET') {
            $count_themes_without_hashes += $data['count_themes_without_hashes'];
        }

        if (!empty($data['count_plugins_without_hashes']) && $data['count_plugins_without_hashes'] === 'RESET') {
            $count_plugins_without_hashes = 0;
        }
        if (!empty($data['count_themes_without_hashes']) && $data['count_themes_without_hashes'] === 'RESET') {
            $count_themes_without_hashes = 0;
        }

        return array(
            'count_plugins' => $count_plugins,
            'count_themes' => $count_themes,
            'count_plugins_without_hashes' => $count_plugins_without_hashes,
            'count_themes_without_hashes' => $count_themes_without_hashes
        );
    }
}
