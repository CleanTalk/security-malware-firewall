<?php

namespace CleantalkSP\SpbctWP\Scanner\Frontend\Stages;

use CleantalkSP\SpbctWP\Scanner\Frontend\PublicPageModel;

class FindRedirectsStage implements FrontendMalwareInterface
{
    /**
     * @var PublicPageModel
     */
    private $page;
    private $exclusions;

    public function analyse()
    {
        $dom = new \DOMDocument();
        $resultDomLoading = $dom->loadHTML($this->page->getContentPage(), LIBXML_NOERROR);

        if ($resultDomLoading === false) {
            // Что то делаем если дом не прогрузился
        }

        $tagScripts = $dom->getElementsByTagName('script');
        foreach ($tagScripts as $script) {
            echo $script->nodeValue, PHP_EOL;
        }
        dd('STOP');

//        $url_exceptions = $this->except_urls
//            ? $this->home_url . '|' . implode('|', $this->except_urls)
//            : $this->home_url;
//
//        $results = $this->checkForAnything(
//            $this->js_tags,
//            '/location(?:\s*\.\s*href\s*)?\s*=\s*["\'](?:http[s]?:\/\/)(?:www\.)?(?!' . $url_exceptions . ').*/',
//            'regexp'
//        );
//
//        return $this->compileResults($results, 'redirects');
    }

    public function getResult()
    {
        // TODO: Implement getResult() method.
    }

    public  function setPage(PublicPageModel $page)
    {
        $this->page = $page;
    }

    public  function setExclusions($exclusions)
    {
        $this->exclusions = $exclusions;
    }
}