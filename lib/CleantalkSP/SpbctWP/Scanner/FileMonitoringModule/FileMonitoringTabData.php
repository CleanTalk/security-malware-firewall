<?php

namespace CleantalkSP\SpbctWP\Scanner\FileMonitoringModule;

class FileMonitoringTabData
{
    public static function getDataToAccordion()
    {
        $data_to_accordion = array();

        $files = FileMonitoringRepository::getFilesFromDb();

        if ($files) {
            foreach ($files as $file) {
                $data_to_accordion[] = (object) array(
                    'path' => $file['path'],
                    'id' => $file['id'],
                );
            }
        }

        return $data_to_accordion;
    }

    public static function prepareDataToAccordion($table)
    {
        if ($table->items_count) {
            foreach ($table->rows as $row) {
                $table->items[] = array(
                    'path'        => $row->path,
                    'uid'         => $row->id,
                    'actions'     => $row->actions,
                );
            }
        }

        return $table;
    }

    public static function showCurrentSnapshot()
    {
        if ( ! check_ajax_referer('spbc_secret_nonce', 'security', false) ) {
            wp_send_json(array('error' => 'Nonce had been changed. Please, restart the scan.'));
        }
        $output = array(
            'success'    => true,
            'file'       => $file_text,
            'file_path'  => $file_path,
            'difference' => $file_info['difference'],
            'weak_spots' => $file_info['weak_spots']
        );
        wp_send_json($output);
    }
}