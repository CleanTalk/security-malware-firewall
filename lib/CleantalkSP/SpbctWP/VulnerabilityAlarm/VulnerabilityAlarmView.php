<?php

namespace CleantalkSP\SpbctWP\VulnerabilityAlarm;

class VulnerabilityAlarmView
{
    public static function renderAlarms($case, $content)
    {
        switch ($case) {
            case VulnerabilityAlarm::INSTALLED_PLUGINS_LIST:
                return self::renderInstalledPluginsList($content);
        }

    }

    public function renderTab()
    {

    }

    /**
     * Show label for each plugin on installed plugins page
     * 
     * @param string $path
     * @return null|string
     */
    private static function renderInstalledPluginsList($path)
    {
        $vulnerabilities = VulnerabilityAlarmService::getVulnerabilitiesList();

        if (empty($vulnerabilities)) {
            return;
        }

        $plugins = $vulnerabilities['plugins'];
        $list = array_keys($plugins);
        preg_match('#^([\w\-])+#', $path, $title);
        if (in_array($title[0], $list)) {

            $label_text = __('alarm - vulnerability extension', 'security-malware-firewall');
            $label_style = "\"background: red; color: white; font-weight: bold; text-align: center; border-radius: 5px;\"";

            return '<script class="spbct_vulnerability_label_not_secure">
                let spbct_vulnerability_label = document.createElement("div");
                spbct_vulnerability_label.setAttribute("style", ' . $label_style . ');
                spbct_vulnerability_label.append("' . $label_text . '");
                let cpbct_vulnerability_title_td = document.querySelector(".spbct_vulnerability_label_not_secure")
                    .closest("td").previousSibling.prepend(spbct_vulnerability_label);
                </script>';
        }
    }
}