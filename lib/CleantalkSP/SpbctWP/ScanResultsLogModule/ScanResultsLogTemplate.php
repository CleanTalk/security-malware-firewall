<?php

namespace CleantalkSP\SpbctWP\ScanResultsLogModule;

class ScanResultsLogTemplate
{
    public function render()
    {
        echo $this->template();
    }

    public function template()
    {
        $template = '<div id="spbcscan-results-log-module">';
        $template .= '<div class="panel-heading">'; // HEADING
        $template .= '<div class="filter">';
        $template .= '<div class="col">';
        $template .= '<label for="spbcscan-results-log-filter-search">';
        $template .= __('Search by name', 'security-malware-firewall');
        $template .= '</label>';
        $template .= '<input type="text" id="spbcscan-results-log-filter-search">';
        $template .= '</div>';
        $template .= '<div class="col">';
        $template .= '<label for="spbcscan-results-log-filter-status">';
        $template .= __('Search by status', 'security-malware-firewall');
        $template .= '</label>';
        $template .= '<select id="spbcscan-results-log-filter-status">';
        $template .= '<option value="all">';
        $template .= __('All', 'security-malware-firewall');
        $template .= '</option>';
        $template .= '<option value="unknown">';
        $template .= __('UNKNOWN', 'security-malware-firewall');
        $template .= '</option>';
        $template .= '<option value="ok">';
        $template .= __('OK', 'security-malware-firewall');
        $template .= '</option>';
        $template .= '<option value="aproved">';
        $template .= __('APROVED', 'security-malware-firewall');
        $template .= '</option>';
        $template .= '<option value="approved_by_ct">';
        $template .= __('APPROVED_BY_CT', 'security-malware-firewall');
        $template .= '</option>';
        $template .= '<option value="modified">';
        $template .= __('MODIFIED', 'security-malware-firewall');
        $template .= '</option>';
        $template .= '<option value="infected">';
        $template .= __('INFECTED', 'security-malware-firewall');
        $template .= '</option>';
        $template .= '<option value="quarantined">';
        $template .= __('QUARANTINED', 'security-malware-firewall');
        $template .= '</option>';
        $template .= '</select>';
        $template .= '</div>';
        $template .= '<div class="col">';
        $template .= '<label for="spbcscan-results-log-filter-type">';
        $template .= __('Search by type', 'security-malware-firewall');
        $template .= '</label>';
        $template .= '<select id="spbcscan-results-log-filter-type">';
        $template .= '<option value="all">';
        $template .= __('All', 'security-malware-firewall');
        $template .= '</option>';
        $template .= '<option value="signature">';
        $template .= __('SIGNATURE', 'security-malware-firewall');
        $template .= '</option>';
        $template .= '<option value="heuristic">';
        $template .= __('HEURISTIC', 'security-malware-firewall');
        $template .= '</option>';
        $template .= '</select>';
        $template .= '</div>';
        $template .= '</div>';
        $template .= '<div class="pagination" data-offset="0">';
        $template .= '<p>' . __('Page ') . '<span id="spbcscan-results-log-pagination-page">1</span></p>';
        $template .= '<button id="spbcscan-results-log-pagination-prev" type="button"><</button>';
        $template .= '<button id="spbcscan-results-log-pagination-next" type="button">></button>';
        $template .= '</div>';
        $template .= '</div>';
        $template .= '<div class="panel-body">';
        $template .= $this->getLogByParams();
        $template .= '</div>';
        $template .= '</div>';

        return $template;
    }

    public function getLogByParams()
    {
        $scan_results_log_repository = new ScanResultsLogRepository();
        $rows = $scan_results_log_repository->getScanResultsLogRows();
        $template = '';

        if (count($rows) > 0) {
            foreach ($rows as $row) {
                $template .= '<p class="spbc_log-line">'
                             . gmdate('Y-m-d H:i:s', $row['checked_at'])
                             . ' - ' .$row['path'] .
                             '<b>: ' . $row['status_of_check'] . '</b>' .
                             '<i>: ' . strtolower($row['check_type']) . '</i>' .
                             '</p>';
            }
        } else {
            $template .= __('Sorry, not founded', 'security-malware-firewall');
        }

        return $template;
    }
}