<?php

namespace CleantalkSP\SpbctWP\AdjustToEnvironmentModule\AdjustToEnv;

class AdjustToEnvW3TotalCache extends AdjustToEnvAbstract
{
    /**
     * Check if need to adjust
     * @return bool
     */
    protected function isNeedToAdjust()
    {
        return apbct_is_plugin_active('w3-total-cache/w3-total-cache.php');
    }

    /**
     * Check if already adjusted
     * @return bool
     */
    protected function isAlreadyAdjusted()
    {
        return isset($this->info[static::class]['changed']) && $this->info[static::class]['changed'];
    }

    /**
     * Adjust
     * @return void
     */
    protected function adjust()
    {
    }

    /**
     * Reverse the adjustments made by the adjust() method
     * @return void
     */
    protected function reverseAdjust()
    {
    }

    /**
     * Keep info what we changed
     * @return void
     */
    protected function keepInfoWhatWeChanged($changed = true)
    {
        $comment = <<<EOD
            Disabled "Cache URIs with query string variables" option.
            Because it can break AJAX requests and there not possible to add exclusion to check that request contains query string or not.
        EOD;

        if (!$changed) {
            $comment = <<<EOD
                Enable "Cache URIs with query string variables" option back. By site admin request.
            EOD;
        }

        $this->info[static::class] = [
            'changed' => $changed,
            'last_intervention_date' => date('Y-m-d H:i:s'),
            'comment' => $comment,
        ];
    }
}
