<?php

namespace CleantalkSP\SpbctWP\AdjustToEnvironmentModule;

class AdjustToEnvironmentSettings
{
    public static function render()
    {
        $view = '';

        $view .= '<div class="spbc_wrapper_field" id="action-shuffle-salts-wrapper">';
        $view .= __('We changed some settings of third party plugins to make compatibility. ', 'security-malware-firewall');
        $view .= __('You are free to reverse it, but it may lead to incorrect operation of the software.', 'security-malware-firewall');

        $info = AdjustToEnvironmentHandler::getInfoWhatWeChanged();

        foreach ( array_values(AdjustToEnvironmentHandler::set_of_adjust) as $adjust_class ) {
            $key_of_adjust = array_search($adjust_class, AdjustToEnvironmentHandler::set_of_adjust);
            if (isset($info[$adjust_class]['changed']) && $info[$adjust_class]['changed']) {
                $view .= self::renderReverseBtn($key_of_adjust);
                continue;
            }

            $view .= self::renderChangeBtn($key_of_adjust);
        }

        $view .= '</div>';

        return $view;
    }

    private static function renderChangeBtn($key)
    {
        $btn = self::btnLayout();

        $title = '';
        $description = '';

        switch ($key) {
            case 'w3tc':
                $title = 'W3 Total Cache';
                $description = __('Next button will disable "Cache URIs with query string variables" option.', 'security-malware-firewall');
                break;
        }

        $replaces = [
            '{TITLE}' => __("Make adjust for $title", 'security-malware-firewall'),
            '{DESCRIPTION}' => $description,
            '{KEY}' => 'change-' . $key,
        ];

        foreach ( $replaces as $place_holder => $replace ) {
            $replace = is_null($replace) ? '' : $replace;
            $btn = str_replace($place_holder, $replace, $btn);
        }

        return $btn;
    }

    private static function renderReverseBtn($key)
    {
        $btn = self::btnLayout();

        $title = '';
        $description = '';

        switch ($key) {
            case 'w3tc':
                $title = 'W3 Total Cache';
                $description = __('Next button will enable "Cache URIs with query string variables" option back.', 'security-malware-firewall');
                break;
        }

        $replaces = [
            '{TITLE}' => __("Reverse adjust for $title", 'security-malware-firewall'),
            '{DESCRIPTION}' => $description,
            '{KEY}' => 'reverse-' . $key,
        ];

        foreach ( $replaces as $place_holder => $replace ) {
            $replace = is_null($replace) ? '' : $replace;
            $btn = str_replace($place_holder, $replace, $btn);
        }

        return $btn;
    }

    private static function btnLayout()
    {
        $btn = <<<EOD
            <div class="spbc_settings_description"> {DESCRIPTION} </div>
            <button type="button" id="action-adjust-{KEY}" 
                class="button button-secondary" style="margin: 5px 0 0 10px;"> 
                {TITLE}
            </button>
        EOD;

        return $btn;
    }
}
