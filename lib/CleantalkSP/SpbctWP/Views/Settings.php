<?php

namespace CleantalkSP\SpbctWP\Views;

class Settings
{
    public static function page()
    {
        global $spbc;

        if (is_network_admin()) {
            self::early_output();
            return;
        }

        $spbct_page_data = [
            // left corner section
            'brandname' => $spbc->data["wl_brandname"],
            'adminsOnlineCount' => $spbc->counter__admins_online,
            'nextScanLaunchTime' => spbc_get_next_scan_launch_time_text(), 

            // right corner section
            'supportLink' => self::support_link(),
            'supportOf' => __('Tech support of ' . $spbc->data["wl_brandname"], 'cleantalk'),
            'homepage' => self::homepage(),
            'gdprCompliance' => self::gdpr_compliance(),
            'gdprDialog' => '<div id="gdpr_dialog" class="spbc_hide" style="padding: 0 15px;">' . spbc_show_GDPR_text() . '</div>',
            'trademark' => $spbc->data["wl_brandname"] . __(' is a registered trademark. All rights reserved.', 'cleantalk'),
            'feedback' => self::feedback(),

            // buttons
            'goToCleanTalkLink' => esc_html(self::go_to_cleantalk_link()),
            'goToCleanTalkText' => __('Security Dashboard', 'security-malware-firewall'),
            'support2Link' => esc_html(self::support2_link()),
            'support2Text' => __('Support', 'security-malware-firewall'),
            'sync' => spbc_api_key__is_correct() ? __('Synchronize with Cloud', 'security-malware-firewall') : '',
            'syncProgress' => __('Synchronizing with Ð¡loud', 'security-malware-firewall'),
            'syncUrl' => SPBC_PATH . "/images/preloader2.gif",
            'syncUrlProgress' => SPBC_PATH . "/images/yes.png",
        ];
        echo '<div id="spbct-page--react" data-data=\'' . json_encode($spbct_page_data) . '\'></div>';
    }

    private static function early_output()
    {
        $link = get_site_option('siteurl') . 'wp-admin/options-general.php?page=spbc';
        $msg = sprintf("<h2>" . __("Please, enter the %splugin settings%s in main site dashboard.", 'security-malware-firewall') . "</h2>", "<a href='$link'>", "</a>");

        $spbct_page_data = [
            'isNetworkAdminDashboard' => true,
            'networkAdminDashboardMsg' => esc_html($msg),
        ];

        echo '<div id="spbct-page--react" data-data=\'' . json_encode($spbct_page_data) . '\'></div>';
    }

    private static function support_link()
    {
        global $spbc;

        $support_link = '<a target="_blank" href="https://wordpress.org/support/plugin/security-malware-firewall/">wordpress.org</a>.';
        if ($spbc->data["wl_mode_enabled"]) {
            $support_link = '<a target="_blank" href="' . $spbc->data["wl_support_url"] . '">' . $spbc->data["wl_brandname"] . '</a>.';
        }

        return $support_link;
    }

    private static function feedback()
    {
        global $spbc;

        $feedback_link = '';
        if (!$spbc->data["wl_mode_enabled"]) {
            $feedback_link = sprintf(
                __('Do you like CleanTalk? %sPost your feedback here%s%s.', 'cleantalk'),
                '<a href="https://wordpress.org/support/plugin/security-malware-firewall/reviews/#new-post" target="_blank">',
                '<i class="spbc-icon-link-ext"></i>',
                '</a>'
            );
        }

        return $feedback_link;
    }

    private static function homepage()
    {
        global $spbc;

        return __('Plugin Homepage at', 'cleantalk') 
            . ' <a href="' . $spbc->data["wl_url"] 
            . '" target="_blank">' . $spbc->data["wl_url"] . '</a>.<br/>';

    }

    private static function gdpr_compliance()
    {
        return '<span id="spbc_gdpr_open_modal" style="text-decoration: underline;">' 
            . __('GDPR compliance', 'cleantalk') 
            . '</span><br/>';
    }

    private static function go_to_cleantalk_link()
    {
        global $spbc;

        $link = '';

        if ($spbc->key_is_ok && !$spbc->data["wl_mode_enabled"]) {
            $link = "https://cleantalk.org/my?user_token=' . $spbc->user_token . '&cp_mode=security";
        }

        return $link;
    }

    private static function support2_link()
    {
        global $spbc;

        $link = '';

        if ($spbc->key_is_ok && !$spbc->data["wl_mode_enabled"]) {
            $link = $spbc->data["wl_support_url"];
        }

        return $link;
    }
}
